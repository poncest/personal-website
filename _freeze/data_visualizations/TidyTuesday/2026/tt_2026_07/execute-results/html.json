{
  "hash": "5d30a23ff12cf12cec9ef949e5f7fa97",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"What's Growing on New Zealand's Land?\"\nsubtitle: \"Planted area (hectares) for four key horticultural crops, 1982â€“2024.\"\ndescription: \"A TidyTuesday visualization exploring New Zealand's horticultural transformation using StatsNZ agricultural production data. Wine grapes surged 7Ã— to an all-time high while kiwifruit, apples, and avocados each followed distinct growth trajectories. Built with R and ggplot2.\"\ndate: \"2026-02-15\"\nauthor:\n  - name: \"Steven Ponce\"\n    url: \"https://stevenponce.netlify.app\"\ncitation:\n  url: \"https://stevenponce.netlify.app/data_visualizations/TidyTuesday/2026/tt_2026_07.html\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2026\"]\ntags: [\n  \"New Zealand Agriculture\",\n  \"Horticulture\",\n  \"Wine Grapes\",\n  \"Kiwifruit\",\n  \"Land Use Change\",\n  \"Time Series\",\n  \"Line Chart\",\n  \"StatsNZ\",\n  \"ggplot2\",\n  \"ggtext\",\n]\nimage: \"thumbnails/tt_2026_07.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                    \n  cache: true                                       \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Line chart showing planted area in hectares for four New Zealand horticultural crops from 1982 to 2024. Wine grapes grew dramatically from 5,300 to 37,600 hectares, becoming the largest planted crop. Kiwifruit peaked in the late 1980s, then declined, only partially recovering to 14,500 hectares. Apples peaked in the mid-1990s and settled around 9,500 hectares. Avocados grew steadily from near zero to 4,300 hectares.](tt_2026_07.png){#fig-1}\n\n### [**Steps to Create this Graphic**]{.mark}\n\n#### [1. Load Packages & Setup]{.smallcaps}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse, ggtext, showtext, janitor, \n    scales, glue\n)\n})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  = 10,\n  height = 7,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### [2. Read in the Data]{.smallcaps}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2026, week = 07)\ndataset_raw <- tt$dataset |> clean_names()\nrm(tt)\n```\n````\n:::\n\n\n#### [3. Examine the Data]{.smallcaps}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(dataset_raw)\n```\n````\n:::\n\n\n#### [4. Tidy Data]{.smallcaps}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n#| warning: false\n\n### |- filter horticulture crops ----\nhort_crops <- c(\"Wine grapes\", \"Kiwifruit\", \"Apples\", \"Avocados\")\n\nhort_data <- dataset_raw |>\n  filter(measure %in% hort_crops) |>\n  select(\n    year = year_ended_june,\n    crop = measure,\n    hectares = value\n  ) |>\n  arrange(crop, year) |> \n  mutate(is_focus = crop == \"Wine grapes\")\n\n### |- calculate growth metrics (robust) ----\nhort_growth <- hort_data |>\n  group_by(crop) |>\n  summarise(\n    first_year = min(year),\n    last_year = max(year),\n    first_value = hectares[year == min(year)] |> first(),\n    last_value = hectares[year == max(year)] |> first(),\n    peak_value = max(hectares, na.rm = TRUE),\n    peak_year = year[which.max(hectares)] |> first(),\n    growth_pct = (last_value - first_value) / first_value * 100,\n    .groups = \"drop\"\n  )\n\n### |- end-point labels ----\nend_labels <- hort_data |>\n  group_by(crop) |>\n  filter(year == max(year)) |>\n  ungroup()\n\n### |- crop-specific label offsets ----\nlabel_offsets <- tibble(\n  crop = hort_crops,\n  dy   = c(0, 0, -1100, 0) \n)\n\nend_labels2 <- end_labels |>\n  left_join(label_offsets, by = \"crop\") |>\n  mutate(dy = replace_na(dy, 0))\n\n### |- compute subtitle stats from data  ----\nwine_stats <- hort_growth |>\n  filter(crop == \"Wine grapes\") |>\n  mutate(\n    last_value_round = round(last_value, -2),\n    growth_x         = last_value / first_value\n  )\n\nwine_growth_x <- round(wine_stats$growth_x, 1)\nwine_last_ha <- comma(wine_stats$last_value_round)\n```\n````\n:::\n\n\n#### [5. Visualization Parameters]{.smallcaps}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\ncolors <- get_theme_colors(\n  palette = c(\n      \"Wine grapes\" = \"#722F37\",\n      \"Kiwifruit\"   = \"#5B7C34\",\n      \"Apples\"      = \"#C0392B\",\n      \"Avocados\"    = \"#1E8449\"\n    )\n)\n\n### |- titles and caption ----\ntitle_text <- str_glue(\"What's Growing on New Zealand's Land?\")\n\nsubtitle_text <- str_glue(\n    \"Planted area (hectares) for four key horticultural crops, 1982â€“2024.<br>\",\n    \"As sheep numbers fell, <b style='color:{colors$palette[\\\"Wine grapes\\\"]}'>wine grapes</b> surged \",\n    \"{wine_growth_x}Ã— to {wine_last_ha} ha â€” now NZâ€™s largest planted crop by area.\"\n)\n\ncaption_text <- create_social_caption(\n    tt_year     = 2026,\n    tt_week     = 07,\n    source_text = \"StatsNZ Agricultural Production Statistics (via Figure.NZ)\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Text styling\n    plot.title = element_text(\n      face = \"bold\", family = fonts$title, size = rel(1.3),\n      color = colors$title, margin = margin(b = 10), hjust = 0\n    ),\n    plot.subtitle = element_markdown(\n      face = \"italic\", family = fonts$subtitle, lineheight = 1.2,\n      color = colors$subtitle, size = rel(0.8), margin = margin(b = 20), hjust = 0\n    ),\n\n    # Grid\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank(),\n    panel.grid.major = element_line(color = \"gray90\", linewidth = 0.25),\n\n    # Axes\n    axis.title = element_text(size = rel(0.8), color = \"gray30\"),\n    axis.text = element_text(color = \"gray30\"),\n    axis.text.y = element_text(size = rel(0.85)),\n    axis.ticks = element_blank(),\n\n    # Facets\n    strip.background = element_rect(fill = \"gray95\", color = NA),\n    strip.text = element_text(\n      face = \"bold\",\n      color = \"gray20\",\n      size = rel(0.9),\n      margin = margin(t = 6, b = 4)\n    ),\n    panel.spacing = unit(1.5, \"lines\"),\n\n    # Legend elements\n    legend.position = \"plot\",\n    legend.title = element_text(\n      family = fonts$subtitle,\n      color = colors$text, size = rel(0.8), face = \"bold\"\n    ),\n    legend.text = element_text(\n      family = fonts$tsubtitle,\n      color = colors$text, size = rel(0.7)\n    ),\n    legend.margin = margin(t = 15),\n\n    # Plot margin\n    plot.margin = margin(10, 20, 10, 20),\n    \n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### [6. Plot]{.smallcaps}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n### |- final plot ----\np <- ggplot(hort_data, aes(x = year, y = hectares, color = crop)) +\n\n  # Geoms\n  geom_line(\n    aes(alpha = is_focus),\n    linewidth = 0.9\n  ) +\n  geom_point(\n    data = end_labels2,\n    size = 2.5, \n    alpha = 1\n  ) +\n  geom_text(\n    data = end_labels2,\n    aes(label = crop),\n    hjust = 0,\n    nudge_x = 1.2,\n    size = 3.8,\n    fontface = \"bold\",\n    family = fonts$text,\n    alpha = 1\n  ) +\n  geom_text(\n    data = end_labels,\n    aes(label = glue(\"{comma(hectares)} ha\")),\n    hjust = 0,\n    nudge_x = 1.2,\n    nudge_y = -1500,\n    size = 3.2,\n    color = \"gray45\",\n    family = fonts$text,\n    alpha = 1\n  ) +\n  # Scales\n  scale_color_manual(values = colors$palette) +\n  scale_alpha_manual(\n    values = c(`TRUE` = 0.95, `FALSE` = 0.70),\n    guide = \"none\"\n  ) +\n  scale_x_continuous(\n    breaks = seq(1985, 2025, 10),\n    limits = c(1982, 2034),\n    expand = expansion(mult = c(0.02, 0))\n  ) +\n  scale_y_continuous(\n    labels = label_comma(suffix = \" ha\"),\n    breaks = seq(0, 40000, 10000),\n    limits = c(0, 42000),\n    expand = expansion(mult = c(0, 0.02))\n  ) +\n  # Labs\n  labs(\n    title = title_text,\n    subtitle = subtitle_text,\n    x = NULL,\n    y = \"Planted area (hectares)\",\n    caption = caption_text\n  ) +\n  # Theme\n  theme(\n    axis.title.y = element_text(\n      angle = 0,\n      vjust = 1.04,\n      hjust = 0.5,\n      margin = margin(r = -100)\n    ),\n    plot.title = element_markdown(\n      size = rel(1.4),\n      family = fonts$title,\n      face = \"bold\",\n      color = colors$title,\n      lineheight = 1.15,\n      margin = margin(t = 0, b = 5)\n    ),\n    plot.subtitle = element_markdown(\n      size = rel(0.8),\n      family = fonts$subtitle,\n      color = alpha(colors$subtitle, 0.88),\n      lineheight = 1.5,\n      margin = margin(t = 5, b = 30)\n    ),\n    plot.caption = element_markdown(\n      size = rel(0.5),\n      family = fonts$subtitle,\n      color = colors$caption,\n      hjust = 0,\n      lineheight = 1.4,\n      margin = margin(t = 20, b = 5)\n    )\n  )\n```\n````\n:::\n\n\n#### [7. Save]{.smallcaps}\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot(\n  plot = p, \n  type = \"tidytuesday\", \n  year = 2026, \n  week = 07, \n  width  = 10,\n  height = 7,\n  )\n```\n````\n:::\n\n\n#### [8. Session Info]{.smallcaps}\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 26100)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] here_1.0.2      glue_1.8.0      scales_1.4.0    janitor_2.2.1  \n [5] showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9  ggtext_0.1.2   \n [9] lubridate_1.9.5 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4    \n[13] purrr_1.0.2     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n[17] ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       xfun_0.47          httr2_1.0.1        htmlwidgets_1.6.4 \n [5] gh_1.4.1           tzdb_0.5.0         vctrs_0.6.5        tools_4.4.0       \n [9] generics_0.1.3     parallel_4.4.0     curl_5.2.1         gifski_1.12.0-2   \n[13] fansi_1.0.6        pkgconfig_2.0.3    RColorBrewer_1.1-3 lifecycle_1.0.4   \n[17] compiler_4.4.0     farver_2.1.2       textshaping_0.3.7  codetools_0.2-20  \n[21] snakecase_0.11.1   htmltools_0.5.8.1  yaml_2.3.10        crayon_1.5.2      \n[25] pillar_1.9.0       camcorder_0.1.0    magick_2.8.3       commonmark_1.9.1  \n[29] tidyselect_1.2.1   digest_0.6.37      stringi_1.8.3      rsvg_2.6.0        \n[33] rprojroot_2.1.1    fastmap_1.2.0      grid_4.4.0         cli_3.6.5         \n[37] magrittr_2.0.3     utf8_1.2.4         withr_3.0.1        rappdirs_0.3.3    \n[41] bit64_4.0.5        timechange_0.4.0   rmarkdown_2.28     tidytuesdayR_1.2.1\n[45] gitcreds_0.1.2     bit_4.0.5          ragg_1.3.0         hms_1.1.3         \n[49] evaluate_1.0.0     knitr_1.48         markdown_1.12      rlang_1.1.7       \n[53] gridtext_0.1.5     Rcpp_1.0.13        xml2_1.3.6         svglite_2.1.3     \n[57] rstudioapi_0.16.0  vroom_1.6.5        jsonlite_1.8.9     R6_2.5.1          \n[61] systemfonts_1.1.0 \n```\n\n\n:::\n:::\n\n:::\n\n#### [9. GitHub Repository]{.smallcaps}\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2026_07.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2026/tt_2026_07.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### [10. References]{.smallcaps}\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n1.  **Data Source:**\n    -   TidyTuesday 2026 Week 07: [Agricultural Production Statistics in New Zealand](https://github.com/rfordatascience/tidytuesday/blob/main/data/2026/2026-02-17/readme.md)\n\n:::\n\n\n#### [11. Custom Functions Documentation]{.smallcaps}\n\n::: {.callout-note collapse=\"true\"}\n##### ðŸ“¦ Custom Helper Functions\n\nThis analysis uses custom functions from my personal module library for efficiency and consistency across projects.\n\n**Functions Used:**\n\n-   **`fonts.R`**: `setup_fonts()`, `get_font_families()` - Font management with showtext\n-   **`social_icons.R`**: `create_social_caption()` - Generates formatted social media captions\n-   **`image_utils.R`**: `save_plot()` - Consistent plot saving with naming conventions\n-   **`base_theme.R`**: `create_base_theme()`, `extend_weekly_theme()`, `get_theme_colors()` - Custom ggplot2 themes\n\n**Why custom functions?**\\\nThese utilities standardize theming, fonts, and output across all my data visualizations. The core analysis (data tidying and visualization logic) uses only standard tidyverse packages.\n\n**Source Code:**\\\nView all custom functions â†’ [GitHub: R/utils](https://github.com/poncest/personal-website/tree/master/R)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}