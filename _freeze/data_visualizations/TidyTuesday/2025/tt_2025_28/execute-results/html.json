{
  "hash": "bc89b697066175a18557fa6c29c46a8b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"The British Library Funding Crisis: A Three-Part Analysis\"\nsubtitle: \"From variable income streams through external shocks to cumulative impact\"\ndescription: \"A comprehensive analysis of British Library funding from 1998-2023 revealing a 42% decline from peak levels. Using coefficient of variation analysis, event timeline mapping, and cumulative gap visualization to explore funding reliability, external economic shocks, and the long-term impact of austerity policies on the UK's national library.\"\nauthor: \"Steven Ponce\"\ndate: \"2025-07-14\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n  \"funding-analysis\",\n  \"coefficient-of-variation\", \n  \"austerity-impact\",\n  \"institutional-decline\",\n  \"economic-policy\",\n  \"public-libraries\",\n  \"financial-crisis\",\n  \"government-spending\",\n  \"inflation-adjustment\",\n  \"data-storytelling\",\n  \"three-panel-visualization\",\n  \"timeline-analysis\",\n  \"gap-analysis\",\n  \"variability-metrics\",\n  \"british-library\"\n]\nimage: \"thumbnails/tt_2025_28.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                    \n  cache: true                                       \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Three-panel chart showing the British Library funding crisis from 1998-2023. The top panel shows total funding declining from £150M peak in 2007 to £85M by 2023, with vertical lines marking major events like the financial crisis and austerity. The bottom left shows funding source reliability with 'Other' most variable (CV=2.9) and Grant-in-Aid most stable (CV=0.1). The bottom right displays the cumulative funding gap reaching 42% below the historical peak by 2023.](tt_2025_28.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,  # Easily Install and Load the 'Tidyverse'\n    ggtext,     # Improved Text Rendering Support for 'ggplot2'\n    showtext,   # Using Fonts More Easily in R Graphs\n    janitor,    # Simple Tools for Examining and Cleaning Dirty Data\n    scales,     # Scale Functions for Visualization\n    glue,       # Interpreted String Literals\n    patchwork   # The Composer of Plots\n  )})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  = 10,\n  height = 12,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### 2. Read in the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2025, week = 28)\n\nbl_funding <- tt$bl_funding |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(bl_funding)\n```\n````\n:::\n\n\n#### 4. Tidy Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n#| warning: false\n\n# Plot 1 Data ----\ncalculate_variability <- function(data, columns, type_name) {\n  data |>\n    select(year, all_of(columns)) |>\n    pivot_longer(cols = -year, names_to = \"source\", values_to = \"amount\") |>\n    group_by(source) |>\n    summarise(\n      mean_val = mean(amount, na.rm = TRUE),\n      sd_val = sd(amount, na.rm = TRUE),\n      cv = sd_val / mean_val,\n      .groups = \"drop\"\n    ) |>\n    mutate(type = type_name) |>\n    arrange(desc(cv))\n}\n\n# Calculate variability for both nominal and inflation-adjusted\nnominal_cols <- c(\n  \"gia_gbp_millions\", \"voluntary_gbp_millions\", \"investment_gbp_millions\",\n  \"services_gbp_millions\", \"other_gbp_millions\"\n)\n\nadjusted_cols <- c(\n  \"gia_y2000_gbp_millions\", \"voluntary_y2000_gbp_millions\",\n  \"investment_y2000_gbp_millions\", \"services_y2000_gbp_millions\",\n  \"other_y2000_gbp_millions\"\n)\n\nnominal_var <- calculate_variability(bl_funding, nominal_cols, \"Nominal\")\nadjusted_var <- calculate_variability(bl_funding, adjusted_cols, \"Inflation-Adjusted\")\n\n# Plot data\nvariability_comparison <- bind_rows(nominal_var, adjusted_var) |>\n  mutate(\n    source_clean = str_remove(source, \"_gbp_millions|_y2000_gbp_millions\") |>\n      str_replace(\"gia\", \"grant-in-aid\") |>\n      str_replace_all(\"_\", \" \") |>\n      str_to_sentence()\n  ) |>\n  group_by(source_clean) |>\n  mutate(avg_cv = mean(cv)) |>\n  ungroup() |>\n  mutate(source_clean = fct_reorder(source_clean, avg_cv))\n\n# Plot 2 Data ----\n# Define key events\nevents <- tibble(\n  year = c(2001, 2007, 2008, 2010, 2013, 2016, 2020),\n  event = c(\n    \"9/11 Economic\\nUncertainty\", \"Pre-Crisis\\nPeak\",\n    \"Financial\\nCrisis\", \"Austerity\\nBegins\", \"Digital Legal\\nDeposit\",\n    \"Brexit\\nVote\", \"COVID-19\\nPandemic\"\n  ),\n  type = c(\"negative\", \"positive\", \"negative\", \"negative\", \"neutral\", \"negative\", \"negative\"),\n  label_offset = c(1.08, 1.02, 1.12, 0.98, 1.06, 1.01, 1.09)\n)\n\nmax_funding_value <- bl_funding |>\n  filter(!is.na(total_y2000_gbp_millions)) |>\n  pull(total_y2000_gbp_millions) |>\n  max()\n\nevents <- events |>\n  mutate(y_pos = max_funding_value * label_offset)\n\n# Plot 3 Data ----\ngap_analysis <- bl_funding |>\n  mutate(\n    peak_total = max(total_y2000_gbp_millions, na.rm = TRUE),\n    peak_gia = max(gia_y2000_gbp_millions, na.rm = TRUE),\n    funding_gap = peak_total - total_y2000_gbp_millions,\n    gia_gap = peak_gia - gia_y2000_gbp_millions,\n    gap_percentage = funding_gap / peak_total * 100\n  )\n\n# Plot data\ngap_data <- gap_analysis |>\n  select(year, funding_gap, gia_gap) |>\n  pivot_longer(-year, names_to = \"gap_type\", values_to = \"gap_amount\") |>\n  mutate(gap_type = factor(case_when(\n    gap_type == \"funding_gap\" ~ \"Total Funding Gap\",\n    gap_type == \"gia_gap\" ~ \"Grant-in-Aid Gap\"\n  ), levels = c(\"Grant-in-Aid Gap\", \"Total Funding Gap\")))\n\n# Key milestone annotations\nkey_years_data <- gap_analysis |>\n  filter(year %in% c(2010, 2015, 2020, 2023)) |>\n  select(year, funding_gap, gap_percentage)\n```\n````\n:::\n\n\n#### 5. Visualization Parameters\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\ncolors <- get_theme_colors(\n  palette = c(\n    primary = 'gray20',\n    secondary = \"#8B0000\",\n    accent = \"#DAA520\",\n    neutral = \"#666666\",\n    background = '#FDFDFD',\n    success = \"#2d5a27\",\n    warning = \"#d73027\"\n  )\n)\n\n### |- titles and caption ----\ntitle_text <- str_glue(\"The British Library Funding Crisis: A Three-Part Analysis\")\n\nsubtitle_text <- str_glue(\"From variable income streams through external shocks to cumulative impact\")\n\ncaption_text <- create_social_caption(\n  tt_year = 2025,\n  tt_week = 28,\n  source_text =  \"BL Funding Over Time\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Axis elements\n    axis.text = element_text(color = colors$text, size = rel(0.7)),\n    axis.title.x = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(t = 15)),\n    axis.title.y = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(r = 10)),\n\n    # Grid elements\n    panel.grid.major.y = element_line(color = \"gray50\", linewidth = 0.05),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank(),\n\n    # Legend elements\n    legend.position = \"plot\",\n    legend.title = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.8), face = \"bold\"),\n    legend.text = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.7)),\n\n    # Plot margin\n    plot.margin = margin(t = 15, r = 15, b = 15, l = 15),\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n# Plot 1: Variability Analysis ----\np1_subtitle <- str_glue(\n    \"Coefficient of variation: <span style='color:{colors$palette[\\\"accent\\\"]}'>**Nominal values**</span> vs \",\n    \"<span style='color:{colors$palette[\\\"primary\\\"]}'>**inflation<br>adjusted values**</span><br>\",\n    \"Higher values = less predictable funding\"\n)\n\np1 <- variability_comparison |>\n  ggplot(aes(x = source_clean, y = cv, fill = type)) +\n  # Geoms\n  geom_col(position = \"dodge\", alpha = 0.85, width = 0.7) +\n  geom_text(aes(label = sprintf(\"%.3f\", cv)),\n    position = position_dodge(width = 0.7),\n    vjust = -0.3, hjust = -0.25, size = 3.2,\n    color = colors$palette[\"neutral\"], fontface = \"bold\"\n  ) +\n  # Scales\n  scale_fill_manual(\n    values = setNames(\n      c(colors$palette[\"accent\"], colors$palette[\"primary\"]),\n      unique(variability_comparison$type)\n    )\n  ) +\n  scale_y_continuous(expand = expansion(mult = c(0, 0.15))) +\n  coord_flip() +\n  # Labs\n  labs(\n    title = \"Funding Source Reliability\",\n    subtitle = p1_subtitle,\n    x = NULL,\n    y = \"Coefficient of Variation\"\n  ) +\n  # Theme\n  theme(\n    plot.title = element_text(\n      size = 16, family = fonts$title,\n      face = \"bold\", color = colors$title, lineheight = 1.1,\n      margin = margin(t = 5, b = 5)\n    ),\n    plot.subtitle = element_markdown(\n      size = 11, family = fonts$subtitle,\n      color = colors$palette[\"neutral\"], lineheight = 1.1,\n      margin = margin(t = 5, b = 10)\n    ),\n    panel.grid.major.y = element_blank(),\n    panel.grid.major.x = element_line(color = \"gray90\", linewidth = 0.25)\n  )\n\n# Plot 2: Event Timeline ----\np2 <- bl_funding |>\n  ggplot(aes(x = year, y = total_y2000_gbp_millions)) +\n  # Geoms\n  geom_line(color = colors$palette[\"primary\"], linewidth = 1.5, alpha = 0.9) +\n  geom_point(color = colors$palette[\"primary\"], size = 2.8, alpha = 0.8) +\n  geom_vline(\n    data = events,\n    aes(xintercept = year, color = type),\n    linetype = \"dashed\", alpha = 0.7, linewidth = 0.6\n  ) +\n  geom_text(\n    data = events,\n    aes(x = year, y = y_pos, label = event, color = type),\n    angle = 90, hjust = 0, vjust = -0.2, size = 2.9, fontface = \"bold\",\n    lineheight = 0.9\n  ) +\n  # Scales\n    scale_color_manual(\n        values = setNames(\n            c(colors$palette[\"success\"], colors$palette[\"warning\"], colors$palette[\"neutral\"]),\n            c(\"positive\", \"negative\", \"neutral\")\n        )\n    ) +\n  scale_y_continuous(\n    labels = label_dollar(prefix = \"£\", suffix = \"M\"),\n    expand = expansion(mult = c(0.02, 0.28))\n  ) +\n  scale_x_continuous(\n    breaks = seq(1998, 2023, 5),\n    limits = c(1997, 2024)\n  ) +\n  # Labs\n  labs(\n    title = \"External Shocks Shape Funding Trajectory\",\n    subtitle = \"Major economic and political events coincide with funding changes\",\n    x = \"Year\",\n    y = \"Total Funding (2000 GBP)\"\n  ) +\n  # Theme\n  theme(\n      plot.title = element_text(\n          size = 16, family = fonts$title,\n          face = \"bold\", color = colors$title, lineheight = 1.1,\n          margin = margin(t = 5, b = 5)\n      ),\n      plot.subtitle = element_markdown(\n          size = 11, family = fonts$subtitle,\n          color = colors$palette[\"neutral\"], lineheight = 1.1,\n          margin = margin(t = 5, b = 10)\n      ),\n    panel.grid.major.y = element_line(color = \"gray90\", linewidth = 0.25),\n    panel.grid.major.x = element_blank()\n  )\n\n# Plot 3: Funding Gap ----\np3_subtitle <- str_glue(\n  \"<span style='color:{colors$palette[\\\"warning\\\"]}'>**Total funding gap**</span> and \",\n  \"<span style='color:{colors$palette[\\\"secondary\\\"]}'>**Grant-in-Aid gap**</span> from historical peak<br>\",\n  \"Dotted line shows trend • Percentages show scale of loss\"\n)\n\np3 <- gap_data |>\n  ggplot(aes(x = year, y = gap_amount, fill = gap_type)) +\n  # Geoms\n  geom_area(alpha = 0.75, position = \"identity\") +\n  geom_smooth(\n    data = gap_analysis, aes(x = year, y = funding_gap),\n    inherit.aes = FALSE, method = \"loess\", se = FALSE,\n    color = \"darkred\", linetype = \"dotted\", linewidth = 1.2, alpha = 0.8\n  ) +\n  geom_text(\n    data = key_years_data,\n    aes(x = year, y = funding_gap, label = paste0(round(gap_percentage, 0), \"%\")),\n    inherit.aes = FALSE, vjust = -0.5, size = 3.3,\n    color = colors$palette[\"secondary\"], fontface = \"bold\"\n  ) +\n  # Scales\n  scale_fill_manual(\n        values = setNames(\n            c(colors$palette[\"secondary\"], colors$palette[\"warning\"]),\n            unique(gap_data$gap_type)\n        )\n    ) +\n  scale_y_continuous(\n    labels = label_dollar(prefix = \"£\", suffix = \"M\"),\n    expand = expansion(mult = c(0, 0.15))\n  ) +\n  scale_x_continuous(\n    breaks = seq(1998, 2023, 5),\n    limits = c(1997, 2024)\n  ) +\n  # Labs\n  labs(\n    title = \"The Cumulative Cost of Underfunding\",\n    subtitle = p3_subtitle,\n    x = \"Year\",\n    y = \"Funding Gap from Peak (2000 GBP)\"\n  ) +\n  # Theme\n  theme(plot.title = element_text(\n      size = 16, family = fonts$title,\n      face = \"bold\", color = colors$title, lineheight = 1.1,\n      margin = margin(t = 5, b = 5)\n  ),\n  plot.subtitle = element_markdown(\n      size = 11, family = fonts$subtitle,\n      color = colors$palette[\"neutral\"], lineheight = 1.1,\n      margin = margin(t = 5, b = 10)\n  ),\n    panel.grid.major.y = element_line(color = \"gray90\", linewidth = 0.25),\n    panel.grid.major.x = element_blank()\n  )\n\n# Plot 3: Funding Gap ----\ncombined_plot <- p2 / (p1 + p3) +\n  plot_layout(heights = c(1.1, 1)) +\n  plot_annotation(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    theme = theme(\n      plot.title = element_text(\n        size = 24, face = \"bold\", color = colors$palette[\"primary\"],\n        hjust = 0, margin = margin(b = 8), family = fonts$title,\n      ),\n      plot.subtitle = element_text(\n        size = 14, color = colors$palette[\"neutral\"],\n        hjust = 0, margin = margin(b = 10), family = fonts$subtitle\n      ),\n      plot.caption = element_markdown(\n        size = 9, color = colors$palette[\"neutral\"],\n        hjust = 0.5, margin = margin(t = 15), family = fonts$caption,\n      ),\n      plot.background = element_rect(fill = colors$palette[\"background\"], color = NA),\n      plot.margin = margin(20, 20, 20, 20)\n    )\n  )\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot_patchwork(\n  plot = combined_plot, \n  type = \"tidytuesday\", \n  year = 2025, \n  week = 28, \n  width  = 10,\n  height = 12\n)\n```\n````\n:::\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      patchwork_1.3.0 glue_1.8.0      scales_1.3.0   \n [5] janitor_2.2.0   showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9 \n [9] ggtext_0.1.2    lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  \n[13] dplyr_1.1.4     purrr_1.0.2     readr_2.1.5     tidyr_1.3.1    \n[17] tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] tidyselect_1.2.1   farver_2.1.2       fastmap_1.2.0      gh_1.4.1          \n [5] digest_0.6.37      timechange_0.3.0   lifecycle_1.0.4    rsvg_2.6.1        \n [9] magrittr_2.0.3     compiler_4.4.0     rlang_1.1.6        tools_4.4.0       \n[13] utf8_1.2.4         yaml_2.3.10        knitr_1.49         labeling_0.4.3    \n[17] htmlwidgets_1.6.4  bit_4.5.0          curl_6.0.0         xml2_1.3.6        \n[21] camcorder_0.1.0    tidytuesdayR_1.1.2 withr_3.0.2        grid_4.4.0        \n[25] fansi_1.0.6        colorspace_2.1-1   gitcreds_0.1.2     cli_3.6.4         \n[29] rmarkdown_2.29     crayon_1.5.3       generics_0.1.3     rstudioapi_0.17.1 \n[33] tzdb_0.5.0         commonmark_1.9.2   splines_4.4.0      parallel_4.4.0    \n[37] ggplotify_0.1.2    vctrs_0.6.5        yulab.utils_0.1.8  Matrix_1.7-0      \n[41] jsonlite_1.8.9     gridGraphics_0.5-1 hms_1.1.3          bit64_4.5.2       \n[45] systemfonts_1.1.0  magick_2.8.5       gifski_1.32.0-1    codetools_0.2-20  \n[49] stringi_1.8.4      gtable_0.3.6       munsell_0.5.1      pillar_1.9.0      \n[53] rappdirs_0.3.3     htmltools_0.5.8.1  R6_2.5.1           httr2_1.0.6       \n[57] rprojroot_2.0.4    lattice_0.22-6     vroom_1.6.5        evaluate_1.0.1    \n[61] markdown_1.13      gridtext_0.1.5     snakecase_0.11.1   renv_1.0.3        \n[65] Rcpp_1.0.13-1      svglite_2.1.3      nlme_3.1-164       mgcv_1.9-1        \n[69] xfun_0.49          fs_1.6.5           pkgconfig_2.0.3   \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_28.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_28.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  Data Sources:\n\n-   TidyTuesday 2025 Week 28: \\[British Library Funding\\](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-07-15)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}