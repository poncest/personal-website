{
  "hash": "15cf0e590da4cbc446e3661df1e8a1ea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Height Distribution: Scottish Munros vs. Munro Tops\"\nsubtitle: \"Peak-count pyramid by elevation band (2021)\"\ndescription: \"Population pyramid showing height distribution of Scottish Munros vs Munro Tops (2021). Munros dominate higher elevations (1100m+) while Munro Tops are more common in lower ranges, with peak distribution at 950-1000m. \"\nauthor: \"Steven Ponce\"\ndate: \"2025-08-12\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n  \"scottish-mountains\",\n  \"munros\", \n  \"elevation-analysis\",\n  \"population-pyramid\",\n  \"ggplot2\",\n  \"height-distribution\",\n  \"geographic-data\",\n  \"mountain-classification\",\n  \"database-british-irish-hills\",\n  \"pyramid-chart\",\n  \"data-exploration\",\n  \"scotland\"\n]\nimage: \"thumbnails/tt_2025_33.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                    \n  cache: true                                       \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Population pyramid showing height distribution of Scottish Munros vs Munro Tops in 2021. Green bars (right) represent 282 Munros, brown bars (left) represent 226 Munro Tops. The chart reveals that Munros dominate higher elevations above 1100m, while Munro Tops are more prevalent in lower ranges. The largest groups are found at elevations of 950-1000m (78 Munros, 73 Munro Tops) and 900-950m (68 Munros, 71 Munro Tops), indicating a relatively even distribution at lower elevations.)](tt_2025_33.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,   # Easily Install and Load the 'Tidyverse'\n    ggtext,      # Improved Text Rendering Support for 'ggplot2'\n    showtext,    # Using Fonts More Easily in R Graphs\n    janitor,     # Simple Tools for Examining and Cleaning Dirty Data\n    scales,      # Scale Functions for Visualization\n    glue         # Interpreted String Literals\n  )})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  = 8,\n  height = 8,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### 2. Read in the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2025, week = 33)\n\nmunros <- tt$scottish_munros |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(munros)\n```\n````\n:::\n\n\n#### 4. Tidy Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n#| warning: false\n\nbreaks <- seq(900, 1350, 50)\nlabels <- paste0(seq(900, 1300, 50), \"–\", seq(950, 1350, 50), \" m\")\n\npyramid_data <- munros |>\n  filter(!is.na(height_m), !is.na(x2021)) |>\n  mutate(\n      # Bins cut\n    height_bin = cut(height_m,\n      breaks = breaks, labels = labels,\n      include.lowest = TRUE, right = FALSE\n    ),\n    x2021 = factor(x2021, levels = c(\"Munro\", \"Munro Top\"))\n  ) |>\n  filter(!is.na(height_bin)) |>\n  count(height_bin, x2021, name = \"n\") |>\n  # Complete the data to show all combinations, filling with 0\n  complete(height_bin, x2021, fill = list(n = 0)) |>\n  # Label placement\n  mutate(\n    n_signed = if_else(x2021 == \"Munro\", n, -n),\n    big_bar = abs(n_signed) >= 8,\n    tiny_bar = abs(n_signed) <= 3,\n    label_pos = case_when(\n      big_bar ~ n_signed / 2,\n      n_signed > 0 & tiny_bar ~ n_signed + 4.5,\n      n_signed > 0 ~ n_signed + 3,\n      n_signed < 0 & tiny_bar ~ n_signed - 4.5,\n      TRUE ~ n_signed - 3\n    ),\n    label_hjust = if_else(big_bar, 0.5, if_else(n_signed > 0, 0, 1)),\n    label_text = if_else(n > 0, as.character(abs(n_signed)), \"\"),\n    label_col = if_else(big_bar, \"white\", \"gray20\")\n  )\n\n# symmetric limits (nice round)\nlim <- ceiling((max(pyramid_data$n) + 2) / 10) * 10\n\n# totals for subtitle \ntotals <- pyramid_data |>\n  group_by(x2021) |>\n  summarise(N = sum(n), .groups = \"drop\") |>\n  pivot_wider(names_from = x2021, values_from = N)\n```\n````\n:::\n\n\n#### 5. Visualization Parameters\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\ncolors <- get_theme_colors(\n    palette = c(\"Munro\" = \"#4B5945\", \"Munro Top\" = \"#9A7E6F\")\n    )\n\n### |- titles and caption ----\ntitle_text <- str_glue(\"Height Distribution: Scottish Munros vs. Munro Tops\")\n\nsubtitle_text <- str_glue(\n    \"Peak-count pyramid by elevation band (2021) — \",\n    \"<span style='color:{colors$palette['Munro']}'><b>Munros</b></span> (n = {totals$Munro}) vs \",\n    \"<span style='color:{colors$palette['Munro Top']}'><b>Munro Tops</b></span> (n = {totals$`Munro Top`})\"\n)\n\ncaption_text <- create_social_caption(\n    tt_year = 2025,\n    tt_week = 33,\n    source_text = \"Database of British and Irish hills\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n    base_theme,\n    theme(\n        # Text styling\n        plot.title = element_text(face = \"bold\", family = fonts$title, size = rel(1.2), color  = colors$title, margin = margin(b = 10)),\n        plot.subtitle = element_text(family = fonts$subtitle, lineheight = 1.2, color = colors$subtitle, size = rel(0.78), margin = margin(b = 20)),\n        \n        # Axis elements\n        axis.line = element_blank(), \n        axis.ticks = element_blank(), \n        \n        # Grid elements\n        panel.grid.major.x = element_line(color = \"gray90\",linetype = \"solid\", linewidth = 0.3),\n        panel.grid.major.y = element_blank(),\n        panel.grid.minor.x = element_blank(),\n        panel.grid.minor.y = element_blank(),\n        \n        # Axis elements\n        axis.text = element_text(color = colors$text, size = rel(0.7)),\n        axis.title.x = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(t = 15)),\n        axis.title.y = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(r = 10)),\n        \n        # Legend elements\n        legend.position = \"plot\",\n        legend.title = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.8), face = \"bold\"),\n        legend.text = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.7)),\n        legend.margin = margin(t = 15),\n        \n        # Plot margin\n        plot.margin = margin(t = 15, r = 15, b = 15, l = 15),\n    )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n### |-  final plot ----\np <- ggplot(pyramid_data, aes(x = height_bin, y = n_signed, fill = x2021)) +\n  # Geoms\n  geom_col(width = 0.78, color = \"white\", linewidth = 0.3, alpha = 0.92) +\n  geom_hline(yintercept = 0, color = \"#5f6b73\", linewidth = 0.6) +\n  geom_text(\n    aes(y = label_pos, label = label_text, hjust = label_hjust, color = label_col),\n    fontface = \"bold\", size = 3.2\n  ) +\n  # Scales\n  scale_color_identity() +\n  scale_fill_manual(values = colors$palette, guide = \"none\") +\n  scale_y_continuous(\n    limits = c(-lim, lim),\n    breaks = seq(-lim, lim, 20),\n    labels = function(x) abs(x),\n    expand = expansion(mult = c(0.02, 0.02))\n  ) +\n  coord_flip() +\n  # Labs\n  labs(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    x = \"Height range (m)\",\n    y = \"Number of peaks\"\n  ) +\n  # Theme\n  theme(\n    plot.title = element_text(\n      size = rel(1.65),\n      family = fonts$title,\n      face = \"bold\",\n      color = colors$title,\n      lineheight = 1.1,\n      margin = margin(t = 5, b = 10)\n    ),\n    plot.subtitle = element_markdown(\n      size = rel(0.85),\n      family = fonts$subtitle,\n      color = alpha(colors$subtitle, 0.9),\n      lineheight = 1.2,\n      margin = margin(t = 0, b = 20)\n    ),\n    plot.caption = element_markdown(\n      size = rel(0.55),\n      family = fonts$caption,\n      color = colors$caption,\n      hjust = 1,\n      margin = margin(t = 10)\n    )\n  )\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot(\n  plot = p, \n  type = \"tidytuesday\", \n  year = 2025, \n  week = 33, \n  width  = 8,\n  height = 8\n  )\n```\n````\n:::\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      glue_1.8.0      scales_1.3.0    janitor_2.2.0  \n [5] showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9  ggtext_0.1.2   \n [9] lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4    \n[13] purrr_1.0.2     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n[17] ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       xfun_0.49          httr2_1.0.6        htmlwidgets_1.6.4 \n [5] gh_1.4.1           tzdb_0.5.0         vctrs_0.6.5        tools_4.4.0       \n [9] generics_0.1.3     parallel_4.4.0     curl_6.0.0         gifski_1.32.0-1   \n[13] fansi_1.0.6        pkgconfig_2.0.3    lifecycle_1.0.4    farver_2.1.2      \n[17] compiler_4.4.0     textshaping_0.4.0  munsell_0.5.1      codetools_0.2-20  \n[21] snakecase_0.11.1   htmltools_0.5.8.1  yaml_2.3.10        crayon_1.5.3      \n[25] pillar_1.9.0       camcorder_0.1.0    magick_2.8.5       commonmark_1.9.2  \n[29] tidyselect_1.2.1   digest_0.6.37      stringi_1.8.4      rsvg_2.6.1        \n[33] rprojroot_2.0.4    fastmap_1.2.0      grid_4.4.0         colorspace_2.1-1  \n[37] cli_3.6.4          magrittr_2.0.3     utf8_1.2.4         withr_3.0.2       \n[41] rappdirs_0.3.3     bit64_4.5.2        timechange_0.3.0   rmarkdown_2.29    \n[45] tidytuesdayR_1.1.2 gitcreds_0.1.2     bit_4.5.0          ragg_1.3.3        \n[49] hms_1.1.3          evaluate_1.0.1     knitr_1.49         markdown_1.13     \n[53] rlang_1.1.6        gridtext_0.1.5     Rcpp_1.0.13-1      xml2_1.3.6        \n[57] renv_1.0.3         vroom_1.6.5        svglite_2.1.3      rstudioapi_0.17.1 \n[61] jsonlite_1.8.9     R6_2.5.1           systemfonts_1.1.0 \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_33.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_33.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  Data Sources:\n\n-   TidyTuesday 2025 Week 33: \\[Scottish Munros\\](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-08-19)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}