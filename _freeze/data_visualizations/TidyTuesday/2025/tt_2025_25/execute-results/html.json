{
  "hash": "8c1bd885c6f79919f05a034258b49192",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Global Measles Surveillance: Quality vs Disease Burden\"\nsubtitle: \"Analysis of 151 countries reveals surveillance systems under pressure\"\ndescription: \"Multi-dimensional scaling analysis of WHO measles surveillance data reveals global patterns in disease burden and healthcare monitoring capabilities. Using data from 151 countries, this visualization identifies 'crisis zones' where high measles incidence coincides with poor laboratory confirmation rates, highlighting critical gaps in public health infrastructure and surveillance systems worldwide.\"\nauthor: \"Steven Ponce\"\ndate: \"2025-06-24\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n  \"measles\", \"surveillance\", \"public health\", \"WHO data\", \"multi-dimensional scaling\", \n  \"MDS\", \"disease burden\", \"laboratory confirmation\", \"healthcare systems\", \n  \"global health\", \"outbreak analysis\", \"epidemiology\", \"health monitoring\", \n  \"data analysis\", \"ggplot2\", \"scico\"\n]\nimage: \"thumbnails/tt_2025_25.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                                  \n  cache: true                                                   \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Scatter plot showing measles surveillance quality versus disease burden across 151 countries. Countries are positioned by disease burden (x-axis) and outbreak variability (y-axis). Points are colored by lab confirmation rates and sized by average measles incidence. A 'Crisis Zone' in the upper left shows countries with high measles burden and poor surveillance, while a 'Success Zone' in the lower right shows countries with low measles burden and good surveillance. Most countries cluster in the middle, with a clear pattern indicating that better measles surveillance correlates with a lower disease burden.](tt_2025_25.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n  tidyverse,  # Easily Install and Load the 'Tidyverse'\n  ggtext,     # Improved Text Rendering Support for 'ggplot2'\n  showtext,   # Using Fonts More Easily in R Graphs\n  janitor,    # Simple Tools for Examining and Cleaning Dirty Data\n  scales,     # Scale Functions for Visualization\n  glue,       # Interpreted String Literals\n  patchwork,  # The Composer of Plots\n  scico,      # Colour Palettes Based on the Scientific Colour-Maps \n  ggrepel     # Automatically Position Non-Overlapping Text Labels with 'ggplot2'\n  )})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n   width  =  10,\n  height =  8,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### 2. Read in the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2025, week = 25)\n\ncases_year <- tt$cases_year |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n\n#' Note: The number of cases of measles and rubella officially reported by a\n#' WHO Member State is only available by July of each year. If any numbers from\n#' this provisional data are quoted, they should be properly sourced with a date\n#' (i.e. \"provisional data based on monthly data reported to WHO (Geneva) as\n#' of June 2025\"\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(cases_year)\n```\n````\n:::\n\n\n#### 4. Tidy Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n#| warning: false\n\n# Data Preparation\n\ncountry_profiles <- cases_year |>\n  group_by(country) |>\n  filter(\n    n() >= 5, # At least 5 years of data\n    sum(measles_total, na.rm = TRUE) >= 10 # Meaningful case numbers\n  ) |>\n  summarise(\n    # Core metrics for MDS\n    avg_incidence = mean(measles_incidence_rate_per_1000000_total_population, na.rm = TRUE),\n    max_incidence = max(measles_incidence_rate_per_1000000_total_population, na.rm = TRUE),\n    cv_incidence = sd(measles_incidence_rate_per_1000000_total_population, na.rm = TRUE) /\n      (mean(measles_incidence_rate_per_1000000_total_population, na.rm = TRUE) + 0.001),\n    lab_confirmation_rate = mean(measles_lab_confirmed / (measles_total + 0.001), na.rm = TRUE),\n    years_with_cases = n(),\n    .groups = \"drop\"\n  ) |>\n  mutate(\n    cv_incidence = pmin(cv_incidence, 5), # Cap CV at reasonable level\n    lab_confirmation_rate = pmin(lab_confirmation_rate, 1) # Cap at 100%\n  ) |>\n  filter(complete.cases(across(avg_incidence:years_with_cases)))\n\n\n# MDS Analysis\n\n# Prepare MDS matrix with log transformation and scaling\nmds_matrix <- country_profiles |>\n  transmute(\n    log_avg_incidence = log10(avg_incidence + 1),\n    log_max_incidence = log10(max_incidence + 1),\n    log_cv_incidence = log10(cv_incidence + 1),\n    lab_confirmation_rate,\n    years_with_cases\n  ) |>\n  scale() |>\n  as.matrix()\n\nrownames(mds_matrix) <- country_profiles$country\n\n# Perform MDS and calculate quality metrics\nmds_result <- cmdscale(dist(mds_matrix), k = 2, eig = TRUE)\nvariance_explained <- sum(mds_result$eig[1:2]) / sum(abs(mds_result$eig))\nstress <- sum((dist(mds_matrix) - dist(mds_result$points))^2) / sum(dist(mds_matrix)^2)\n\n\n# Plot Data\nplot_data <- tibble(\n  country = country_profiles$country,\n  MDS1 = mds_result$points[, 1],\n  MDS2 = mds_result$points[, 2],\n  avg_incidence = country_profiles$avg_incidence,\n  lab_confirmation_rate = country_profiles$lab_confirmation_rate\n)\n\n# Outliers Data\noutlier_datasets <- list(\n  top_left = plot_data |> filter(MDS1 <= -3 & MDS2 > 1),\n  bottom_right = plot_data |> filter(MDS1 > 2.8 & MDS2 > -1)\n)\n\n# Shared Plot Styling & Annotations\nbase_label_style <- list(\n  size = 3.2,\n  fontface = \"bold\",\n  color = \"black\",\n  bg.color = \"white\",\n  bg.r = 0.12,\n  box.padding = 0.6,\n  point.padding = 0.4,\n  segment.color = \"grey50\",\n  segment.size = 0.3,\n  segment.alpha = 0.8,\n  max.overlaps = 12,\n  seed = 42,\n  min.segment.length = 0.2\n)\n\n# Annotation tibble ----\nzone_annotations <- tibble(\n  zone = c(\"crisis\", \"success\"),\n  xmin = c(-3.1, 0.9),\n  xmax = c(-1.9, 2.1),\n  ymin = c(1.8, -1.7),\n  ymax = c(3.2, -0.7),\n  x_text = c(-2.5, 1.5),\n  y_text = c(2.5, -1.2),\n  label = c(\n    \"CRISIS ZONE\\nHigh burden +\\nPoor surveillance\",\n    \"SUCCESS ZONE\\nLow burden +\\nGood surveillance\"\n  ),\n  color = c(\"darkred\", \"darkgreen\")\n)\n```\n````\n:::\n\n\n#### 5. Visualization Parameters\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\ncolors <- get_theme_colors(\n  palette = NULL\n)\n\n### |-  titles and caption ----\ntitle_text <- str_glue(\"Global Measles Surveillance: Quality vs Disease Burden\")\n\nsubtitle_text <- str_glue(\n  \"Analysis of {nrow(plot_data)} countries reveals surveillance systems under pressure. WHO Provisional Measles Data (as of June 2025)\\n\",\n  \"Countries cluster by outbreak characteristics and surveillance capabilities\\n\\n\",\n  \"Note: Countries positioned closer together have similar outbreak patterns and surveillance capabilities\\n\",\n  \"All data is provisional - official annual figures available July 2025\\n\",\n  \"Model quality: {round(variance_explained * 100, 1)}% variance explained, Stress = {round(stress, 3)}\"\n)\n\ncaption_text <- create_social_caption(\n  tt_year = 2025,\n  tt_week = 25,\n  source_text =  \"WHO Provisional monthly measles and rubella data\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Axis elements\n    axis.text = element_text(color = colors$text, size = rel(0.7)),\n    axis.title.x = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(t = 15)),\n    axis.title.y = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(r = 10)),\n\n    # Grid elements\n    panel.grid.major.y = element_line(color = \"gray50\", linewidth = 0.05),\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank(),\n\n    # Legend elements\n    legend.position = \"plot\",\n    legend.title = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.8), face = \"bold\"),\n    legend.text = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.7)),\n\n    # Plot margins\n    plot.margin = margin(t = 15, r = 15, b = 15, l = 15),\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n# Initial Plot ----\np <- ggplot(plot_data, aes(x = MDS1, y = MDS2)) +\n\n  # Geoms\n  geom_hline(yintercept = 0, color = \"grey90\", linewidth = 0.25) +\n  geom_vline(xintercept = 0, color = \"grey90\", linewidth = 0.25) +\n  geom_point(aes(color = lab_confirmation_rate, size = avg_incidence),\n    alpha = 0.85, stroke = 0.2\n  ) +\n  # Scales\n  scale_color_scico(\n    name = \"Lab Confirmation\\nRate\",\n    labels = scales::percent_format(accuracy = 1),\n    palette = \"vik\",\n    direction = -1,\n    trans = \"identity\",\n    breaks = c(0, 0.25, 0.50, 0.75, 1.0),\n    guide = guide_colorbar(\n      title.position = \"top\",\n      title.hjust = 0.5,\n      barwidth = 10,\n      barheight = 1,\n      nbin = 100\n    )\n  ) +\n  scale_size_continuous(\n    range = c(1.5, 10),\n    name = \"Average Incidence (per million)\",\n    trans = \"sqrt\",\n    breaks = c(1, 10, 100, 500, 2000),\n    labels = c(\"1\", \"10\", \"100\", \"500\", \"2,000+\"),\n    guide = guide_legend(\n      title.position = \"top\",\n      title.hjust = 0.5,\n      override.aes = list(alpha = 0.8, shape = 21),\n      direction = \"horizontal\",\n      nrow = 1\n    )\n  ) +\n  # Labs\n  labs(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    x = \"MDS Dimension 1 →\\n(Higher values = Lower disease burden)\",\n    y = \"MDS Dimension 2 →\\n(Higher values = More outbreak variability)\",\n  ) +\n  # Theme\n  theme(\n    plot.title = element_text(\n      size = rel(1.8),\n      family = fonts$title,\n      face = \"bold\",\n      color = colors$title,\n      lineheight = 1.1,\n      margin = margin(t = 5, b = 10)\n    ),\n    plot.subtitle = element_text(\n      size = rel(0.72),\n      family = fonts$subtitle,\n      color = alpha(colors$subtitle, 0.9),\n      lineheight = 1.2,\n      margin = margin(t = 5, b = 20)\n    ),\n    plot.caption = element_markdown(\n      size = rel(0.55),\n      family = fonts$caption,\n      color = colors$caption,\n      hjust = 0.5,\n      margin = margin(t = 10)\n    ),\n    # Legend styling\n    legend.position = \"top\",\n    legend.box = \"horizontal\",\n    legend.margin = margin(b = 10),\n    legend.title = element_text(size = 11, face = \"bold\"),\n    legend.text = element_text(size = 10),\n    legend.spacing.x = unit(1, \"cm\"),\n    legend.box.spacing = unit(0.5, \"cm\"),\n\n    # Grid and axes\n    panel.grid.minor = element_blank(),\n    panel.grid.major = element_line(color = \"grey95\", linewidth = 0.3),\n    axis.title = element_text(size = 12, face = \"bold\"),\n    axis.text = element_text(size = 10),\n  )\n\n# Final Plot ----\np <- p +\n  # top-left outliers  \n  exec(geom_text_repel,\n    data = outlier_datasets$top_left,\n    mapping = aes(label = country),\n    nudge_x = -0.5,\n    nudge_y = -0.4,\n    direction = \"x\",\n    !!!base_label_style\n  ) +\n\n  # bottom-right outliers \n  exec(geom_text_repel,\n    data = outlier_datasets$bottom_right,\n    mapping = aes(label = country),\n    !!!base_label_style\n  ) +\n\n  # zone rectangles\n  pmap(zone_annotations, ~ annotate(\"rect\",\n    xmin = ..2, xmax = ..3,\n    ymin = ..4, ymax = ..5,\n    fill = colors$background,\n    alpha = 0.7\n  )) +\n\n  # zone text labels\n  pmap(zone_annotations, ~ annotate(\"text\",\n    x = ..6, y = ..7,\n    label = ..8,\n    hjust = 0.5, vjust = 0.5,\n    size = 3.5, fontface = \"bold\",\n    color = ..9\n  ))\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot(\n  plot = p, \n  type = \"tidytuesday\", \n  year = 2025, \n  week = 25, \n  width  = 10,\n  height = 8\n)\n```\n````\n:::\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      ggrepel_0.9.6   scico_1.5.0     patchwork_1.3.0\n [5] glue_1.8.0      scales_1.3.0    janitor_2.2.0   showtext_0.9-7 \n [9] showtextdb_3.0  sysfonts_0.8.9  ggtext_0.1.2    lubridate_1.9.3\n[13] forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4     purrr_1.0.2    \n[17] readr_2.1.5     tidyr_1.3.1     tibble_3.2.1    ggplot2_3.5.1  \n[21] tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       httr2_1.0.6        xfun_0.49          htmlwidgets_1.6.4 \n [5] gh_1.4.1           tzdb_0.5.0         vctrs_0.6.5        tools_4.4.0       \n [9] generics_0.1.3     parallel_4.4.0     curl_6.0.0         gifski_1.32.0-1   \n[13] fansi_1.0.6        pkgconfig_2.0.3    lifecycle_1.0.4    compiler_4.4.0    \n[17] farver_2.1.2       textshaping_0.4.0  munsell_0.5.1      codetools_0.2-20  \n[21] snakecase_0.11.1   htmltools_0.5.8.1  yaml_2.3.10        crayon_1.5.3      \n[25] pillar_1.9.0       camcorder_0.1.0    magick_2.8.5       commonmark_1.9.2  \n[29] tidyselect_1.2.1   digest_0.6.37      stringi_1.8.4      labeling_0.4.3    \n[33] rsvg_2.6.1         rprojroot_2.0.4    fastmap_1.2.0      grid_4.4.0        \n[37] colorspace_2.1-1   cli_3.6.4          magrittr_2.0.3     utf8_1.2.4        \n[41] withr_3.0.2        rappdirs_0.3.3     bit64_4.5.2        timechange_0.3.0  \n[45] rmarkdown_2.29     tidytuesdayR_1.1.2 gitcreds_0.1.2     bit_4.5.0         \n[49] ragg_1.3.3         hms_1.1.3          evaluate_1.0.1     knitr_1.49        \n[53] markdown_1.13      rlang_1.1.6        gridtext_0.1.5     Rcpp_1.0.13-1     \n[57] xml2_1.3.6         renv_1.0.3         vroom_1.6.5        svglite_2.1.3     \n[61] rstudioapi_0.17.1  jsonlite_1.8.9     R6_2.5.1           systemfonts_1.1.0 \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_25.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_25.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  Data Sources:\n\n-   TidyTuesday 2025 Week 25: \\[Measles cases across the world\\](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-06-24\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}