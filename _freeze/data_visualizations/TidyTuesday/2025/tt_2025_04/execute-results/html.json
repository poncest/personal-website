{
  "hash": "cc536c973beb4307ee95064f9004193c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Nearly Half of U.S. Counties Face Increased Water Insecurity\"\nsubtitle: \"46% of counties reported more households without basic plumbing, affecting over 800 counties (2022-2023)\"\ndescription: \"Analysis of water insecurity trends across U.S. counties reveals concerning patterns: while 44% of counties showed improvement in household plumbing access, 46% experienced deteriorating conditions, highlighting growing infrastructure challenges in basic water access.\"\nauthor: \"Steven Ponce\"\ndate: \"2025-01-25\" \ncategories: [TidyTuesday, Data Visualization, R Programming]  \ntags: [\n   tidytuesday, \n    ggplot2,\n    water-insecurity,\n    public-health,\n    infrastructure,\n    census-data,\n    data-analysis,\n    data-visualization,\n    r-programming,\n    data-journalism \n]\nimage: \"thumbnails/tt_2025_04.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                                  \n  cache: true                                                   \n  error: false\n  message: false\n  warning: false\n  eval: true\nfilters:\n  - social-share\nshare:\n  permalink: \"https://stevenponce.netlify.app/data_visualizations/TidyTuesday/2025/tt_2025_04.html\"\n  description: \"Analysis shows 46% of U.S. counties reported increased water insecurity, with more households lacking basic plumbing in 2023 compared to 2022. #TidyTuesday #DataViz\"\n\n  twitter: true\n  linkedin: true\n  email: true\n  facebook: false\n  reddit: false\n  stumble: false\n  tumblr: false\n  mastodon: true\n  bsky: true\n---\n\n\n\n![Bar chart showing changes in U.S. county-level water insecurity from 2022 to 2023. The chart reveals that 46% of counties saw increased water insecurity, with 35.5% experiencing a major increase (>50%). 27.6% saw a major decrease, while 16.4% had a moderate decrease, and 10.4% experienced a moderate increase. 10.1% of counties had stable conditions. Annotations highlight that 44% fewer counties were affected by major decreases and 46% more counties became vulnerable to water insecurity.](tt_2025_04.png){#fig-1}\n\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,      # Easily Install and Load the 'Tidyverse'\n    ggtext,         # Improved Text Rendering Support for 'ggplot2'\n    showtext,       # Using Fonts More Easily in R Graphs\n    janitor,        # Simple Tools for Examining and Cleaning Dirty Data\n    skimr,          # Compact and Flexible Summaries of Data\n    scales,         # Scale Functions for Visualization\n    glue,           # Interpreted String Literals\n    here            # A Simpler Way to Find Your Files\n    )\n})\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n:::\n\n\n\n#### 2. Read in the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntt <- tidytuesdayR::tt_load(2025, week = 04) \n\nwater_insecurity_2022 <- tt$water_insecurity_2022 |> clean_names()\nwater_insecurity_2023 <- tt$water_insecurity_2023 |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n:::\n\n\n\n#### 3. Examine the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(water_insecurity_2022)\nskim(water_insecurity_2022)\n\nglimpse(water_insecurity_2023)\nskim(water_insecurity_2023)\n```\n:::\n\n\n\n#### 4. Tidy Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwater_change_clean <- water_insecurity_2022 |>\n    # Join both datasets\n    inner_join(water_insecurity_2023, by = \"geoid\", suffix = c(\"_2022\", \"_2023\")) |>\n    \n    # Remove rows with NA in plumbing for 2022 or 2023 \n    filter(!is.na(plumbing_2022), !is.na(plumbing_2023)) |>\n    \n    # Perform calculations and categorization in a single mutate\n    mutate(\n        # Calculate pct_change based on the percent_lacking_plumbing for 2022 and 2023\n        pct_change = case_when(\n            percent_lacking_plumbing_2022 == 0 & percent_lacking_plumbing_2023 > 0 ~ 100,\n            percent_lacking_plumbing_2022 == 0 & percent_lacking_plumbing_2023 == 0 ~ 0,\n            TRUE ~ ((percent_lacking_plumbing_2023 - percent_lacking_plumbing_2022) / \n                        percent_lacking_plumbing_2022) * 100\n        ),\n        \n        # Replace any NA values in pct_change with 0\n        pct_change = replace_na(pct_change, 0),\n        \n        # Categorize the pct_change into different categories \n        change_category = factor(case_when(\n            pct_change < -50 ~ \"Major Decrease (>50%)\",\n            pct_change < -10 ~ \"Moderate Decrease (10-50%)\",\n            pct_change >= -10 & pct_change <= 10 ~ \"Stable (±10%)\",\n            pct_change > 10 & pct_change <= 50 ~ \"Moderate Increase (10-50%)\",\n            pct_change > 50 ~ \"Major Increase (>50%)\"\n        ), levels = c(\n            \"Major Increase (>50%)\",\n            \"Moderate Increase (10-50%)\", \n            \"Stable (±10%)\",\n            \"Moderate Decrease (10-50%)\",\n            \"Major Decrease (>50%)\"\n        )),\n        \n        # Add the 'impact' category in the same mutate call\n        impact = case_when(\n            str_detect(change_category, \"Increase\") ~ \"Worsening\",\n            str_detect(change_category, \"Decrease\") ~ \"Improving\",\n            TRUE ~ \"No Change\"\n        )\n    )\n\n# Housekeeping\nrm(water_insecurity_2022, water_insecurity_2023)\n\n### |-  plot data ----\ndata_plot <- water_change_clean |>\n    count(change_category) |>\n    mutate(\n        pct = n / sum(n) * 100,\n        category_label = recode(change_category,\n                                \"Major Increase (>50%)\" = \"Major Increase\\n(>50%)\",\n                                \"Moderate Increase (10-50%)\" = \"Moderate Increase\\n(10-50%)\",\n                                \"Stable (±10%)\" = \"Stable\\n(±10%)\",\n                                \"Moderate Decrease (10-50%)\" = \"Moderate Decrease\\n(10-50%)\",\n                                \"Major Decrease (>50%)\" = \"Major Decrease\\n(>50%)\"\n        ),\n        impact = case_when(\n            str_detect(change_category, \"Increase\") ~ \"Worsening\",\n            str_detect(change_category, \"Decrease\") ~ \"Improving\",\n            TRUE ~ \"No Change\"\n        )\n    ) \n```\n:::\n\n\n\n#### 5. Visualization Parameters\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  plot aesthetics ----\n# Get base colors with custom palette\ncolors <- get_theme_colors(palette = c(\n    \"Improving\" = \"#4575b4\",   # Blue for improving\n    \"No Change\" = \"#808080\",   # Gray for no change\n    \"Worsening\" = \"#d73027\"    # Red for worsening\n    )\n)\n\n### |-  titles and caption ----\ntitle_text <- str_glue(\"Nearly Half of U.S. Counties Face Increased Water Insecurity\")\n\nsubtitle_text <- str_glue(\"46% of counties reported more households without basic plumbing,\\naffecting over 800 counties (2022-2023)\")\n\n# Create caption\ncaption_text <- create_social_caption(\n    tt_year = 2025,\n    tt_week = 04,\n    source_text = \"US Census Data from tidycensus\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n    base_theme,\n    theme(\n        # Text styling \n        plot.title = element_text(face = \"bold\", size = rel(1.14), margin = margin(b = 10)),\n        plot.subtitle = element_text(color = colors$text, size = rel(0.78), margin = margin(b = 20)),\n        \n        # Axis formatting\n        axis.title = element_text(color = colors$text, size = 10),\n        axis.text = element_text(color = colors$text, size = 9),\n        \n        # Grid customization\n        panel.grid.minor = element_blank(),\n        panel.grid.major.y = element_blank(),\n        \n        # Plot margins \n        plot.margin = margin(t = 20, r = 20, b = 20, l = 20),\n\n    )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n:::\n\n\n\n#### 6. Plot \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  Plot ----\np <- data_plot |> \n    ggplot(aes(x = category_label, y = pct, fill = impact)) +\n    \n    # Geoms\n    geom_col(width = 0.85) +\n    geom_text(aes(label = sprintf(\"%.1f%%\\n(n=%d)\", pct, n)), hjust = -0.1, color = colors$text) +\n    # Worsening bracket annotation\n    annotate(\"segment\", x = 1, xend = 2, y = 42, yend = 42, linewidth = 0.5, color = colors$palette[3]) +\n    annotate(\"segment\", x = 1, xend = 1, y = 35, yend = 42, linewidth = 0.5, color = colors$palette[3]) +\n    annotate(\"segment\", x = 2, xend = 2, y = 35, yend = 42, linewidth = 0.5, color = colors$palette[3]) +\n    annotate(\"text\", x = 1.5, y = 48, label = \"46%\\nMore Vulnerable\", fontface = \"bold\", color = colors$palette[3]) +\n    # Improving bracket annotation\n    annotate(\"segment\", x = 4, xend = 5, y = 42, yend = 42, linewidth = 0.5, color = colors$palette[1]) +\n    annotate(\"segment\", x = 4, xend = 4, y = 35, yend = 42, linewidth = 0.5, color = colors$palette[1]) +\n    annotate(\"segment\", x = 5, xend = 5, y = 35, yend = 42, linewidth = 0.5, color = colors$palette[1]) +\n    annotate(\"text\", x = 4.5, y = 48, label = \"44%\\nFewer Affected\", fontface = \"bold\", color = colors$palette[1]) +\n    \n    # Scales\n    scale_x_discrete() +\n    scale_y_continuous(limits = c(0, 50)) +\n    scale_fill_manual(values = colors$palette) +    \n    coord_flip(clip = 'off') +\n    \n    # Labs\n    labs(\n        x = NULL,\n        y = \"Percent of Counties\",\n        title    = title_text,\n        subtitle = subtitle_text,\n        caption  = caption_text,\n    ) + \n    \n    # Theme\n   theme(\n       plot.title = element_text(\n            size   = rel(1.5),\n            family = fonts$title,\n            face   = \"bold\",\n            color  = colors$title,\n            lineheight = 1.1,\n            margin = margin(t = 5, b = 5)\n        ),\n        plot.subtitle = element_text(\n            size   = rel(1.1),\n            family = fonts$subtitle,\n            color  = colors$subtitle,\n            lineheight = 1.2,\n            margin = margin(t = 5, b = 15)\n        ),\n        plot.caption = element_markdown(\n            size   = rel(0.6),\n            family = fonts$caption,\n            color  = colors$caption,\n            hjust  = 0.5,\n            margin = margin(t = 10)\n        )\n    )\n```\n:::\n\n\n\n#### 7. Save\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  plot image ----  \n\nsave_plot(p, type = \"tidytuesday\", \n          year = 2025, week = 04, width = 8, height = 8)\n```\n:::\n\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      glue_1.8.0      scales_1.3.0    skimr_2.1.5    \n [5] janitor_2.2.0   showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9 \n [9] ggtext_0.1.2    lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  \n[13] dplyr_1.1.4     purrr_1.0.2     readr_2.1.5     tidyr_1.3.1    \n[17] tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       xfun_0.49          httr2_1.0.6        htmlwidgets_1.6.4 \n [5] gh_1.4.1           tzdb_0.4.0         vctrs_0.6.5        tools_4.4.0       \n [9] generics_0.1.3     parallel_4.4.0     curl_6.0.0         fansi_1.0.6       \n[13] pkgconfig_2.0.3    lifecycle_1.0.4    farver_2.1.2       compiler_4.4.0    \n[17] textshaping_0.4.0  munsell_0.5.1      repr_1.1.7         codetools_0.2-20  \n[21] snakecase_0.11.1   htmltools_0.5.8.1  yaml_2.3.10        crayon_1.5.3      \n[25] pillar_1.9.0       magick_2.8.5       commonmark_1.9.2   tidyselect_1.2.1  \n[29] digest_0.6.37      stringi_1.8.4      labeling_0.4.3     rprojroot_2.0.4   \n[33] fastmap_1.2.0      grid_4.4.0         colorspace_2.1-1   cli_3.6.3         \n[37] magrittr_2.0.3     base64enc_0.1-3    utf8_1.2.4         withr_3.0.2       \n[41] rappdirs_0.3.3     bit64_4.5.2        timechange_0.3.0   rmarkdown_2.29    \n[45] tidytuesdayR_1.1.2 gitcreds_0.1.2     bit_4.5.0          ragg_1.3.3        \n[49] hms_1.1.3          evaluate_1.0.1     knitr_1.49         markdown_1.13     \n[53] rlang_1.1.4        gridtext_0.1.5     Rcpp_1.0.13-1      xml2_1.3.6        \n[57] renv_1.0.3         rstudioapi_0.17.1  vroom_1.6.5        jsonlite_1.8.9    \n[61] R6_2.5.1           systemfonts_1.1.0 \n```\n\n\n:::\n:::\n\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_04.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_04.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n\n#### 10. References\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1. Data Sources:\n   - TidyTuesday 2025 Week 04: [Water Insecurity](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-01-28)\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}