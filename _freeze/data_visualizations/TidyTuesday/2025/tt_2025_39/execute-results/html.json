{
  "hash": "da11904e35da9284729db1d137b4ca86",
  "result": {
    "engine": "knitr",
    "markdown": "---\nitle: \"Lake Hornborgasjön cranes: seasonal peaks and long-term growth\"\nsubtitle: \"Spring migration dominates the daily peaks; annual totals are much higher today than in the 1990s\"\ndescription: \"Analyzing 30 years of crane observations at Sweden's Lake Hornborgasjön reveals dramatic population growth and distinct seasonal patterns, with spring migration attracting 3x more cranes than in the 1990s.\"\ndate: \"2025-09-21\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n  \"ggplot2\",\n  \"wildlife\",\n  \"migration\",\n  \"time-series\",\n  \"ecological-data\",\n  \"Sweden\",\n  \"conservation\",\n  \"seasonal-patterns\",\n  \"population-trends\",\n  \"environmental-science\"\n]\nimage: \"thumbnails/tt_2025_39.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                    \n  cache: true                                       \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Two-panel chart showing Lake Hornborgasjön crane observations from 1994 to 2024. The top panel displays seasonal patterns with spring migration (blue, peaking around 10,000 cranes in April) significantly higher than fall migration (orange, peaking around 9,000 in October). The bottom panel shows cumulative annual observations, colored from purple (1990s) to orange (2020s), demonstrating population growth from approximately 77,000 cranes in 1994 to over 427,000 in 2024, a more than threefold increase over 30 years.](tt_2025_39.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n  tidyverse,   # Easily Install and Load the 'Tidyverse'\n  ggtext,      # Improved Text Rendering Support for 'ggplot2'\n  showtext,    # Using Fonts More Easily in R Graphs\n  janitor,     # Simple Tools for Examining and Cleaning Dirty Data\n  scales,      # Scale Functions for Visualization\n  glue,        # Interpreted String Literals,\n  ggrepel,     # Automatically Position Non-Overlapping Text Labels with'ggplot2'\n  patchwork    # The Composer of Plots\n  )})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  = 12,\n  height = 12,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### 2. Read in the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2025, week = 39)\n\ncranes_raw <- tt$cranes |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(cranes_raw)\n```\n````\n:::\n\n\n#### 4. Tidy Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n#| warning: false\n\n# Clean & tag season\ncranes <- cranes_raw |>\n  mutate(\n    year = year(date),\n    month = month(date, label = TRUE, abbr = TRUE),\n    day_of_year = yday(date),\n    season = case_when(\n      month(date) %in% 3:5 ~ \"Spring\",\n      month(date) %in% 9:11 ~ \"Fall\",\n      TRUE ~ \"Other\"\n    )\n  ) |>\n  filter(!is.na(observations)) |>\n  mutate(season = factor(season, levels = c(\"Spring\", \"Fall\", \"Other\")))\n\n# P1: Seasonal slice (Spring & Fall only)\nseason_df <- cranes |> filter(season %in% c(\"Spring\", \"Fall\"))\n\n# P1 labels: find peak (median across days) per season for direct labeling\nlabs_df <- season_df |>\n  group_by(season, day_of_year) |>\n  summarise(obs = median(observations), .groups = \"drop\") |>\n  group_by(season) |>\n  slice_max(obs, n = 1, with_ties = FALSE)\n\n# P2: Choose highlight years (earliest, midpoint actual year, latest)\nyrs <- sort(unique(cranes$year))\nmid_year <- yrs[ceiling(length(yrs) / 2)]\nhighlight_years <- c(first(yrs), mid_year, last(yrs))\n\n# P2: Build cumulative-by-year data and flag highlighted years\ncum_df <- cranes |>\n  arrange(year, date) |>\n  group_by(year) |>\n  mutate(cumulative = cumsum(observations)) |>\n  ungroup() |>\n  mutate(is_hi = year %in% highlight_years)\n```\n````\n:::\n\n\n#### 5. Visualization Parameters\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\n# Get basic theme colors\ncolors <- get_theme_colors(\n  palette = c(\n      Spring = \"#0072B2\", Fall = \"#E69F00\",\n      \"1994\" = \"#6A51A3\", \"2009\" = \"#1F78B4\", \"2024\" = \"#FDB863\"\n      )\n)\n\n### |- titles and caption ----\ntitle_text <- str_glue(\"Lake Hornborgasjön cranes: seasonal peaks and long-term growth\")\n\nsubtitle_text <- str_glue(\n  \"Spring migration dominates the daily peaks; annual totals are much higher today than in the 1990s\"\n)\n\ncaption_text <- create_social_caption(\n  tt_year = 2025,\n  tt_week = 39,\n  source_text = \"Hornborgasjön Field Station\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Text styling\n    plot.title = element_text(face = \"bold\", family = fonts$title, size = rel(1.4), color = colors$title, margin = margin(b = 10)),\n    plot.subtitle = element_text(family = fonts$subtitle, lineheight = 1.2, color = colors$subtitle, size = rel(0.9), margin = margin(b = 20)),\n\n    # Axis elements\n    axis.line = element_blank(),\n    axis.ticks = element_blank(),\n\n    # Grid elements\n    panel.grid.major = element_line(color = \"gray90\", linetype = \"solid\", linewidth = 0.3),\n    # panel.grid.major.y = element_blank(),\n    panel.grid.minor.x = element_blank(),\n    panel.grid.minor.y = element_blank(),\n\n    # Axis elements\n    axis.text = element_text(color = colors$text, size = rel(0.7)),\n    axis.title.x = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(t = 15)),\n    axis.title.y = element_text(color = colors$text, face = \"bold\", size = rel(0.8), margin = margin(r = 10)),\n\n    # Legend elements\n    legend.position = \"plot\",\n    legend.title = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.8), face = \"bold\"),\n    legend.text = element_text(family = fonts$tsubtitle, color = colors$text, size = rel(0.7)),\n    legend.margin = margin(t = 15),\n\n    # Plot margin\n    plot.margin = margin(t = 15, r = 15, b = 15, l = 15),\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n### |-  P1: season plot ----\np1 <-\n  ggplot(season_df, aes(day_of_year, observations, color = season)) +\n  # Geoms\n  geom_point(alpha = 0.18, size = 1) +\n  geom_smooth(\n    method = \"gam\",\n    formula = y ~ s(x, bs = \"cs\", k = 20),\n    se = TRUE, alpha = 0.12, linewidth = 1.6\n  ) +\n  geom_label_repel(\n    data = labs_df,\n    aes(day_of_year, obs, label = paste0(season, \" migration\")),\n    nudge_y = 2000,\n    direction = \"y\",\n    seed = 42,\n    size = 3.8,\n    fill = \"white\",\n    label.size = 0,\n    segment.color = \"grey60\"\n  ) +\n  # Scales\n  scale_color_manual(values = colors$palette) +\n  scale_y_continuous(labels = label_number(big.mark = \",\")) +\n  scale_x_continuous(\n    breaks = c(60, 91, 121, 244, 274, 305),\n    labels = c(\"Mar\", \"Apr\", \"May\", \"Sep\", \"Oct\", \"Nov\"),\n    limits = c(55, 310) # trims dead space\n  ) +\n  # Labs\n  labs(\n    title = \"Spring migration attracts the largest flocks\",\n    subtitle = \"Daily counts (1994–2024) show spring peaks are earlier and consistently higher than fall\",\n    x = NULL, y = \"Number of cranes observed\",\n  ) +\n  # Theme\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank(),\n  )\n\n\n### |-  P2: Cumulative line chart ----\np2 <-\n  ggplot(cum_df, aes(day_of_year, cumulative, group = year)) +\n  # Geoms\n  geom_line(\n    data = ~ filter(.x, !is_hi),\n    color = \"grey85\", linewidth = 0.7, alpha = 0.9\n  ) +\n  geom_line(\n    data = ~ filter(.x, is_hi),\n    aes(color = factor(year)), linewidth = 1.4\n  ) +\n  geom_text(\n    data = cum_df |>\n      filter(is_hi) |>\n      group_by(year) |>\n      slice_max(day_of_year, n = 1, with_ties = FALSE),\n    aes(label = paste0(year, \": \", scales::label_number(big.mark = \",\")(cumulative))),\n    hjust = -0.05, vjust = 0.5, size = 3.4\n  ) +\n  # Scales\n  scale_color_manual(values = colors$palette) +\n  scale_y_continuous(labels = label_number(scale_cut = cut_short_scale())) +\n  scale_x_continuous(\n    breaks = c(60, 121, 182, 244, 305, 365),\n    labels = c(\"Mar\", \"May\", \"Jul\", \"Sep\", \"Nov\", \"Dec\"), limits = c(55, 365)\n  ) +\n  coord_cartesian(clip = \"off\") +\n  # Labs\n  labs(\n    title = \"Annual crane observations have more than tripled since the 1990s\",\n    subtitle = \"Recent years now exceed 400K cranes compared with ~75K in the mid-1990s\",\n    x = NULL, y = \"Cumulative number of cranes\",\n  ) +\n  # Theme\n  theme(\n    panel.grid.minor = element_blank(),\n    plot.margin = margin(10, 40, 10, 10),\n  )\n\n### |-  Combined plots ----\ncombined_plots <- (p1 / p2) +\n  plot_layout(heights = c(1.1, 1.3))\n\ncombined_plots <- combined_plots +\n  plot_annotation(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    theme = theme(\n      plot.title = element_text(\n        size = rel(1.8),\n        family = fonts$title,\n        face = \"bold\",\n        color = colors$title,\n        lineheight = 1.1,\n        margin = margin(t = 5, b = 5)\n      ),\n      plot.subtitle = element_markdown(\n        size = rel(0.95),\n        family = fonts$subtitle,\n        color = alpha(colors$subtitle, 0.9),\n        lineheight = 1.2,\n        margin = margin(t = 5, b = 10)\n      ),\n      plot.caption = element_markdown(\n        size = rel(0.65),\n        family = fonts$caption,\n        color = colors$caption,\n        hjust = 0.5,\n        margin = margin(t = 10)\n      )\n    )\n  )\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot_patchwork(\n  plot = combined_plots, \n  type = \"tidytuesday\", \n  year = 2025, \n  week = 39, \n  width  = 12,\n  height = 12\n  )\n```\n````\n:::\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      patchwork_1.3.0 ggrepel_0.9.6   glue_1.8.0     \n [5] scales_1.3.0    janitor_2.2.0   showtext_0.9-7  showtextdb_3.0 \n [9] sysfonts_0.8.9  ggtext_0.1.2    lubridate_1.9.3 forcats_1.0.0  \n[13] stringr_1.5.1   dplyr_1.1.4     purrr_1.0.2     readr_2.1.5    \n[17] tidyr_1.3.1     tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0\n[21] pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] tidyselect_1.2.1   farver_2.1.2       fastmap_1.2.0      gh_1.4.1          \n [5] digest_0.6.37      timechange_0.3.0   lifecycle_1.0.4    rsvg_2.6.1        \n [9] magrittr_2.0.3     compiler_4.4.0     rlang_1.1.6        tools_4.4.0       \n[13] utf8_1.2.4         yaml_2.3.10        knitr_1.49         labeling_0.4.3    \n[17] htmlwidgets_1.6.4  bit_4.5.0          curl_6.0.0         xml2_1.3.6        \n[21] camcorder_0.1.0    tidytuesdayR_1.1.2 withr_3.0.2        grid_4.4.0        \n[25] fansi_1.0.6        colorspace_2.1-1   gitcreds_0.1.2     cli_3.6.4         \n[29] rmarkdown_2.29     crayon_1.5.3       generics_0.1.3     rstudioapi_0.17.1 \n[33] tzdb_0.5.0         commonmark_1.9.2   splines_4.4.0      parallel_4.4.0    \n[37] ggplotify_0.1.2    vctrs_0.6.5        yulab.utils_0.1.8  Matrix_1.7-0      \n[41] jsonlite_1.8.9     gridGraphics_0.5-1 hms_1.1.3          bit64_4.5.2       \n[45] systemfonts_1.1.0  magick_2.8.5       gifski_1.32.0-1    codetools_0.2-20  \n[49] stringi_1.8.4      gtable_0.3.6       munsell_0.5.1      pillar_1.9.0      \n[53] rappdirs_0.3.3     htmltools_0.5.8.1  R6_2.5.1           httr2_1.0.6       \n[57] rprojroot_2.0.4    vroom_1.6.5        evaluate_1.0.1     lattice_0.22-6    \n[61] markdown_1.13      gridtext_0.1.5     snakecase_0.11.1   renv_1.0.3        \n[65] Rcpp_1.0.13-1      svglite_2.1.3      nlme_3.1-164       mgcv_1.9-1        \n[69] xfun_0.49          fs_1.6.5           pkgconfig_2.0.3   \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_39.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_39.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  Data Sources:\n\n-   TidyTuesday 2025 Week 39: \\[Crane Observations at Lake Hornborgasjön, Sweden (1994–2024)\\](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-09-30\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}