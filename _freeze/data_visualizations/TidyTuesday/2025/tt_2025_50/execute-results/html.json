{
  "hash": "673febaf8fd04d9ef22e73632f589577",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Small Nations Lead in Roundabout Adoption\"\nsubtitle: \"Per capita analysis of countries with 10+ roundabouts shows New Zealand and Sweden clearly leading. Despite having 12,952 roundabouts, the USA sits near the median of these countries once population is accounted for (39 per million people).\" \ndescription: \"Analyzing global roundabout adoption patterns through population-adjusted metrics reveals an unexpected story: small nations dominate per capita rankings while the USA's massive infrastructure count becomes average when normalized.\"\ndate: \"2025-12-14\"\nauthor:\n  - name: \"Steven Ponce\"\n    url: \"https://stevenponce.netlify.app\"\ncitation:\n  url: \"https://stevenponce.netlify.app/data_visualizations/TidyTuesday/2025/tt_2025_50.html\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n  \"Roundabouts\",\n  \"Infrastructure\",\n  \"Per Capita Analysis\",\n  \"Population Normalization\",\n  \"Comparative Statistics\",\n  \"Scatter Plot\",\n  \"Log Scale\",\n  \"Global Comparison\",\n  \"New Zealand\",\n  \"Sweden\",\n  \"USA\",\n  \"ggplot2\",\n  \"ggrepel\",\n  \"World Bank Data\"\n]\nimage: \"thumbnails/tt_2025_50.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                    \n  cache: true                                       \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Scatter plot showing roundabouts per million people versus population (log scale) for 13 countries. New Zealand leads at ~165 per million, followed by Sweden (~147) and Australia (~137). Although the USA has the highest total number of roundabouts at 12,952 (represented by the largest bubble on the plot), it ranks near the median with only 39 roundabouts per million residents due to its large population. In contrast, smaller nations consistently demonstrate higher per capita adoption rates of roundabouts.](tt_2025_50.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,     # Easily Install and Load the 'Tidyverse'\n    ggtext,        # Improved Text Rendering Support for 'ggplot2'\n    showtext,      # Using Fonts More Easily in R Graphs\n    janitor,       # Simple Tools for Examining and Cleaning Dirty Data\n    scales,        # Scale Functions for Visualization\n    glue,          # Interpreted String Literals\n    ggrepel        # Automatically Position Non-Overlapping Text Labels\n)\n})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  = 12,\n  height = 10,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### 2. Read in the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2025, week = 50)\n\nroundabouts <- tt$roundabouts_clean |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(roundabouts)\nskimr::skim(roundabouts) |> summary()\n```\n````\n:::\n\n\n#### 4. Tidy Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy-fixed\n#| warning: false\n\n### |-  Clean roundabouts data ----\nroundabouts_clean <- roundabouts |>\n  clean_names() |>\n  mutate(\n    # Standardize country names\n    country = case_when(\n      country == \"United States\" ~ \"USA\",\n      country == \"United Kingdom\" ~ \"UK\",\n      TRUE ~ country\n    )\n  )\n\n### |-  Population data for normalization ----\n# Source: World Bank Open Data (data.worldbank.org/indicator/SP.POP.TOTL)\n# 2024 estimates - Selected countries with 10+ roundabouts for meaningful comparison\ncountry_populations <- tibble(\n  country = c(\n    \"USA\", \"Australia\", \"UK\", \"Sweden\", \"Canada\",\n    \"New Zealand\", \"Netherlands\", \"Norway\", \"France\",\n    \"Russia\", \"Japan\", \"Poland\", \"Croatia\"\n  ),\n  population_millions = c(\n    336.7, 27.0, 68.3, 10.6, 39.7,\n    5.3, 18.0, 5.6, 68.2,\n    143.5, 123.3, 36.6, 3.9\n  )\n)\n\n### |-  Calculate per capita rates ----\nper_capita_analysis <- roundabouts_clean |>\n  count(country, name = \"total_roundabouts\") |>\n  inner_join(country_populations, by = \"country\") |>\n  mutate(\n    per_million = total_roundabouts / population_millions,\n    # Categorize for emphasis\n    highlight = case_when(\n      per_million > 100 ~ \"High adopters\",\n      per_million > 30 ~ \"Moderate adopters\",\n      TRUE ~ \"Lower adopters\"\n    ),\n    highlight = factor(\n      highlight,\n      levels = c(\"High adopters\", \"Moderate adopters\", \"Lower adopters\")\n    )\n  ) |>\n  arrange(desc(per_million))\n\n# Median reference\nmedian_per_million <- median(per_capita_analysis$per_million)\n\nmedian_label <- glue(\n  \"Median among\\nshown countries â‰ˆ {round(median_per_million, 1)}\\nroundabouts per million\"\n)\n```\n````\n:::\n\n\n#### 5. Visualization Parameters\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\ncolors <- get_theme_colors(\n    palette = list(\n        high  = \"#004F6E\",\n        moderate = \"#2A7F9E\", \n        lower  = \"#C4CBD3\"\n    )\n)\n\n### |- titles and caption ----\ntitle_text <- \"Small Nations Lead in Roundabout Adoption\"\n\nsubtitle_text <- glue(\n    \"Per capita analysis of countries with 10+ roundabouts shows \",\n    \"**New Zealand** and **Sweden** clearly leading, and circle size represents<br>\",\n    \"the total number of roundabouts. Despite having 12,952 roundabouts, the **USA** sits near the median \",\n    \"of these countries once population<br>\",\n    \"is accounted for (39 per million people).\"\n)\n\ncaption_text <- create_social_caption(\n    tt_year = 2025,\n    tt_week = 50,\n    source_text = paste(\n        \"Roundabout counts: Kittelson & Associates via { roundabouts } package.<br>\",\n        \"Population: World Bank Open Data (2024 estimates).\"\n    )\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Text styling\n    plot.title = element_markdown(\n      face = \"bold\", family = fonts$title, size = rel(1.4),\n      color = colors$title, margin = margin(b = 10), hjust = 0\n    ),\n    plot.subtitle = element_markdown(\n      face = \"italic\", family = fonts$subtitle, lineheight = 1.2,\n      color = colors$subtitle, size = rel(0.9), margin = margin(b = 20), hjust = 0\n    ),\n\n    # Grid\n    panel.grid.minor = element_blank(),\n    panel.grid.major.x = element_blank(),\n    panel.grid.major = element_line(color = \"gray90\", linewidth = 0.25),\n\n    # Axes\n    axis.title = element_text(size = rel(0.8), color = \"gray30\"),\n    axis.text = element_text(color = \"gray30\"),\n    axis.text.y = element_text(size = rel(0.85)),\n    axis.ticks = element_blank(),\n\n    # Facets\n    strip.background = element_rect(fill = \"gray95\", color = NA),\n    strip.text = element_text(\n      face = \"bold\",\n      color = \"gray20\",\n      size = rel(0.9),\n      margin = margin(t = 6, b = 4)\n    ),\n    panel.spacing = unit(1.5, \"lines\"),\n\n    # Legend elements\n    legend.position = \"plot\",\n    legend.title = element_text(\n      family = fonts$subtitle,\n      color = colors$text, size = rel(0.8), face = \"bold\"\n    ),\n    legend.text = element_text(\n      family = fonts$tsubtitle,\n      color = colors$text, size = rel(0.7)\n    ),\n    legend.margin = margin(t = 15),\n\n    # Plot margin\n    plot.margin = margin(20, 20, 20, 20)\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n### |-  main plot ----\np <- ggplot() +\n  # Geoms\n  geom_hline(\n    yintercept = median_per_million,\n    linetype = \"dashed\",\n    color = \"gray55\",\n    linewidth = 0.4\n  ) +\n  geom_point(\n    data = per_capita_analysis |> filter(highlight == \"Lower adopters\"),\n    aes(\n      x = population_millions, y = per_million,\n      size = total_roundabouts, fill = highlight\n    ),\n    shape = 21, color = \"white\", alpha = 0.75, stroke = 0.5\n  ) +\n  geom_point(\n    data = per_capita_analysis |> filter(highlight == \"Moderate adopters\"),\n    aes(\n      x = population_millions, y = per_million,\n      size = total_roundabouts, fill = highlight\n    ),\n    shape = 21, color = \"white\", alpha = 0.9, stroke = 0.6\n  ) +\n  geom_point(\n    data = per_capita_analysis |> filter(highlight == \"High adopters\"),\n    aes(\n      x = population_millions, y = per_million,\n      size = total_roundabouts, fill = highlight\n    ),\n    shape = 21, color = \"white\", alpha = 1, stroke = 0.7\n  ) +\n  geom_text_repel(\n    data = per_capita_analysis,\n    aes(\n      x = population_millions,\n      y = per_million,\n      label = country,\n      color = highlight\n    ),\n    size = 3.2,\n    family = fonts$text,\n    fontface = \"bold\",\n    max.overlaps = 20,\n    min.segment.length = 0,\n    box.padding = 0.5,\n    point.padding = 16.45,\n    nudge_x = 0.02,\n    force = 0.2,\n    seed = 123\n  ) +\n  # Annotate\n  annotate(\n    \"text\",\n    x = 6, y = median_per_million + 5,\n    label = median_label,\n    family = fonts$text,\n    size = 3,\n    hjust = 0,\n    vjust = 0,\n    color = \"gray40\"\n  ) +\n  # Scales\n  scale_fill_manual(\n    name = \"Adoption\\nlevel\",\n    values = c(\n      \"High adopters\" = colors$palette$high,\n      \"Moderate adopters\" = colors$palette$moderate,\n      \"Lower adopters\" = colors$palette$lower\n    )\n  ) +\n  scale_color_manual(\n    name = \"Adoption\\nlevel\",\n    values = c(\n      \"High adopters\" = colors$palette$high,\n      \"Moderate adopters\" = colors$palette$moderate,\n      \"Lower adopters\" = colors$palette$lower\n    )\n  ) +\n  scale_size_continuous(\n    name = \"Total\\nroundabouts\",\n    range = c(2.5, 14),\n    breaks = c(500, 2500, 5000, 10000),\n    labels = label_comma()\n  ) +\n  scale_x_log10(\n    labels = label_comma(),\n    breaks = c(5, 10, 25, 50, 100, 200, 300)\n  ) +\n  scale_y_continuous(\n    labels = label_number(accuracy = 1),\n    breaks = seq(0, 200, 50),\n    limits = c(0, 175),\n    expand = expansion(mult = c(0.05, 0.1))\n  ) +\n  # Labs\n  labs(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    x = \"Population (millions, log scale)\",\n    y = \"Roundabouts per million people\"\n  ) +\n  # Guides\n  guides(\n    fill = guide_legend(\n      order = 1,\n      nrow = 1,\n      title.vjust = 0.8,\n      override.aes = list(\n        shape = 21,\n        size = 5,\n        stroke = 0.7,\n        color = \"grey40\"\n      )\n    ),\n    size = guide_legend(\n      order = 2,\n      nrow = 1,\n      title.vjust = 0.8,\n      override.aes = list(\n        shape = 21,\n        color = \"grey40\",\n        fill  = \"white\",\n        alpha = 1\n      )\n    ),\n    color = \"none\"\n  ) +\n  # Theme\n  theme(\n    plot.title = element_markdown(\n      size = rel(2.3),\n      family = fonts$title,\n      face = \"bold\",\n      color = colors$title,\n      lineheight = 1.15,\n      margin = margin(t = 8, b = 5)\n    ),\n    plot.subtitle = element_markdown(\n      size = rel(0.9),\n      family = fonts$subtitle,\n      color = alpha(colors$subtitle, 0.88),\n      lineheight = 1.5,\n      margin = margin(t = 5, b = 20)\n    ),\n    plot.caption = element_markdown(\n      size = rel(0.65),\n      family = fonts$subtitle,\n      color = colors$caption,\n      hjust = 0,\n      lineheight = 1.4,\n      margin = margin(t = 20, b = 5)\n    ),\n    panel.grid.minor.x = element_blank(),\n    panel.grid.major.x = element_blank(),\n    legend.position = \"bottom\",\n    legend.box = \"horizontal\",\n    legend.spacing.x = unit(3.5, \"lines\"),\n    legend.box.spacing = unit(0.5, \"lines\"),\n    legend.title = element_text(\n      family = fonts$text, size = 9, hjust = 0,\n      face = \"bold\", margin = margin(r = 8)\n    ),\n    legend.text = element_text(family = fonts$text, size = 9)\n  )\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot(\n  plot = p, \n  type = \"tidytuesday\", \n  year = 2025, \n  week = 50, \n  width  = 12,\n  height = 10,\n  )\n```\n````\n:::\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 26100)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      ggrepel_0.9.6   glue_1.8.0      scales_1.3.0   \n [5] janitor_2.2.0   showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9 \n [9] ggtext_0.1.2    lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  \n[13] dplyr_1.1.4     purrr_1.0.2     readr_2.1.5     tidyr_1.3.1    \n[17] tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       xfun_0.49          httr2_1.0.6        htmlwidgets_1.6.4 \n [5] gh_1.4.1           tzdb_0.5.0         vctrs_0.6.5        tools_4.4.0       \n [9] generics_0.1.3     parallel_4.4.0     curl_6.0.0         gifski_1.32.0-1   \n[13] fansi_1.0.6        pkgconfig_2.0.3    skimr_2.1.5        lifecycle_1.0.4   \n[17] farver_2.1.2       compiler_4.4.0     textshaping_0.4.0  munsell_0.5.1     \n[21] repr_1.1.7         codetools_0.2-20   snakecase_0.11.1   htmltools_0.5.8.1 \n[25] yaml_2.3.10        crayon_1.5.3       pillar_1.9.0       camcorder_0.1.0   \n[29] magick_2.8.5       commonmark_1.9.2   tidyselect_1.2.1   digest_0.6.37     \n[33] stringi_1.8.4      rsvg_2.6.1         rprojroot_2.0.4    fastmap_1.2.0     \n[37] grid_4.4.0         colorspace_2.1-1   cli_3.6.4          magrittr_2.0.3    \n[41] base64enc_0.1-3    utf8_1.2.4         withr_3.0.2        rappdirs_0.3.3    \n[45] bit64_4.5.2        timechange_0.3.0   rmarkdown_2.29     tidytuesdayR_1.1.2\n[49] gitcreds_0.1.2     bit_4.5.0          ragg_1.3.3         hms_1.1.3         \n[53] evaluate_1.0.1     knitr_1.49         markdown_1.13      rlang_1.1.6       \n[57] gridtext_0.1.5     Rcpp_1.0.13-1      xml2_1.3.6         renv_1.0.3        \n[61] vroom_1.6.5        svglite_2.1.3      rstudioapi_0.17.1  jsonlite_1.8.9    \n[65] R6_2.5.1           systemfonts_1.1.0 \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_50.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_50.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  **Data Source:**\n    -   TidyTuesday 2025 Week 50: [Roundabouts across the world](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-12-16/readme.md)\n:::\n\n#### 11. Custom Functions Documentation\n\n::: {.callout-note collapse=\"true\"}\n##### ðŸ“¦ Custom Helper Functions\n\nThis analysis uses custom functions from my personal module library for efficiency and consistency across projects.\n\n**Functions Used:**\n\n-   **`fonts.R`**: `setup_fonts()`, `get_font_families()` - Font management with showtext\n-   **`social_icons.R`**: `create_social_caption()` - Generates formatted social media captions\n-   **`image_utils.R`**: `save_plot()` - Consistent plot saving with naming conventions\n-   **`base_theme.R`**: `create_base_theme()`, `extend_weekly_theme()`, `get_theme_colors()` - Custom ggplot2 themes\n\n**Why custom functions?**\\\nThese utilities standardize theming, fonts, and output across all my data visualizations. The core analysis (data tidying and visualization logic) uses only standard tidyverse packages.\n\n**Source Code:**\\\nView all custom functions â†’ [GitHub: R/utils](https://github.com/poncest/personal-website/tree/master/R)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}