{
  "hash": "5a529585a899ca5e0850656c4e81efd7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"The Sherlock Holmes Canon Thematic Word Networks\"\nsubtitle: \"Each of the 15 most-discussed stories is linked to its five most distinctive dialogue words. Cluster size reflects vocabulary uniqueness. Purple cluster highlights Sign of the Four's distinctive vocabulary.\"\ndescription: \"Network analysis of Sherlock Holmes stories using TF-IDF to identify distinctive dialogue vocabulary. Built with R, tidytext, and ggraph to visualize thematic word relationships across 15 stories from the Holmes canon.\"\ndate: \"2025-11-16\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n  \"Network Analysis\",\n  \"Text Mining\",\n  \"TF-IDF\",\n  \"Natural Language Processing\",\n  \"Literary Analysis\",\n  \"Sherlock Holmes\",\n  \"ggraph\",\n  \"tidytext\",\n  \"igraph\",\n  \"tidygraph\",\n  \"Network Visualization\",\n  \"Word Networks\",\n  \"Dialogue Analysis\",\n  \"Arthur Conan Doyle\",\n  \"ggplot2\"\n]\nimage: \"thumbnails/tt_2025_46.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                    \n  cache: true                                       \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n![Network graph showing 15 Sherlock Holmes stories (teal nodes) connected to their five most distinctive dialogue words (small grey nodes). The Sign of the Four stands out with a large purple cluster of connected words, indicating it has the most unique vocabulary among the stories. Other stories like Hound of the Baskervilles, Study in Scarlet, and Valley of Fear show smaller, more dispersed word clusters.](tt_2025_46.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,     # Easily Install and Load the 'Tidyverse'\n    ggtext,        # Improved Text Rendering Support for 'ggplot2'\n    showtext,      # Using Fonts More Easily in R Graphs\n    janitor,       # Simple Tools for Examining and Cleaning Dirty Data\n    scales,        # Scale Functions for Visualization\n    tidygraph,     # A Tidy API for Graph Manipulation\n    igraph,        # Network Analysis and Visualization\n    ggraph,        # An Implementation of Grammar of Graphics for Graphs and Networks\n    ggrepel,       # Automatically Position Non-Overlapping Text Labels with 'ggplot2'\n    tidytext       # Text Mining using 'dplyr', 'ggplot2', and Other Tidy Tools\n)\n})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  = 10,\n  height = 8,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### 2. Read in the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2025, week = 46)\n\nholmes <- tt$holmes |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(holmes)\nskimr::skim(holmes) |> summary()\n```\n````\n:::\n\n\n#### 4. Tidy Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy-fixed\n#| warning: false\n\nholmes_clean <- holmes |>\n  filter(!is.na(text), nchar(text) > 5) |>\n  filter(\n    !str_detect(text, \"^[A-Z ]+$\"),\n    !str_detect(text, \"^(Table of|CHAPTER|Part [IVX]+|\\\\d+$)\")\n  ) |>\n  mutate(\n    has_quotes = str_detect(text, '\"'),\n    speaker = case_when(\n      str_detect(text, \"(?i)said Holmes|Holmes said|Holmes replied|Holmes answered|Holmes asked\") ~ \"Holmes\",\n      str_detect(text, \"(?i)said I|I said|I replied|I answered|I asked\") ~ \"Watson\",\n      str_detect(text, \"(?i)he said|she said|he replied|she replied\") ~ \"Other\",\n      has_quotes ~ \"Unknown\",\n      TRUE ~ \"Narrative\"\n    ),\n    dialogue_text = str_extract_all(text, '\"([^\"]*)\"') |>\n      map_chr(~ {\n        if (length(.x) > 0) {\n          str_remove_all(.x, '\"') |>\n            str_trim() |>\n            str_c(collapse = \" \")\n        } else {\n          NA_character_\n        }\n      })\n  )\n\n# Word counts & TFâ€“IDF\nbook_words <- holmes_clean |>\n  filter(speaker %in% c(\"Holmes\", \"Watson\")) |>\n  filter(!is.na(dialogue_text)) |>\n  select(book, dialogue_text) |>\n  unnest_tokens(word, dialogue_text) |>\n  anti_join(stop_words, by = \"word\") |>\n  filter(nchar(word) >= 4) |>\n  count(book, word, sort = TRUE)\n\nbook_tfidf <- book_words |>\n  bind_tf_idf(word, book, n) |>\n  arrange(desc(tf_idf))\n\ntop_books <- book_words |>\n  count(book, sort = TRUE) |>\n  slice_head(n = 15) |>\n  pull(book)\n\ndistinctive_words <- book_tfidf |>\n  filter(book %in% top_books) |>\n  group_by(book) |>\n  slice_max(tf_idf, n = 5) |>\n  ungroup()\n\nedges <- distinctive_words |>\n  select(from = word, to = book, weight = tf_idf)\n\ngraph <- graph_from_data_frame(edges, directed = FALSE)\nV(graph)$degree <- degree(graph)\n\ntbl_graph <- as_tbl_graph(graph)\n\n# Short book labels and node attributes\nbook_labels <- tibble(book = unique(distinctive_words$book)) |>\n  mutate(\n    book_label = book |>\n      str_remove(\"^The Adventure of the \") |>\n      str_remove(\"^The Adventure of \") |>\n      str_remove(\"^The \") |>\n      str_remove(\"^A \")\n  )\n\ntbl_graph <- tbl_graph |>\n  activate(nodes) |>\n  left_join(book_labels, by = c(\"name\" = \"book\")) |>\n  mutate(\n    node_type = if_else(name %in% top_books, \"Book\", \"Word\"),\n    size_metric = if_else(node_type == \"Book\", degree, 1),\n    node_type_fct = factor(node_type, levels = c(\"Book\", \"Word\")),\n    display_label = if_else(node_type == \"Book\", book_label, NA_character_),\n    # Highlight Sign of the Four cluster\n    is_sign_cluster = name == \"The Sign of the Four\" |\n      str_detect(name, \"Sign of the Four\")\n  )\n\n# Mark edges connected to \"Sign of the Four\"\ntbl_graph <- tbl_graph |>\n  activate(edges) |>\n  mutate(\n    from_node = .N()$name[from],\n    to_node = .N()$name[to],\n    is_sign_edge = from_node == \"The Sign of the Four\" |\n      to_node == \"The Sign of the Four\"\n  )\n\n# Create layout\nset.seed(221)\nlayout_tbl <- ggraph::create_layout(tbl_graph, layout = \"fr\")\n\n# Position for \"Sign of the Four\"\nsign_pos <- layout_tbl |>\n  as_tibble() |>\n  filter(node_type == \"Book\", str_detect(name, \"Sign of the Four\")) |>\n  slice(1)\n\nannotation_df <- tibble(\n  x = sign_pos$x + 0.5,\n  y = sign_pos$y + 3,\n  xend = sign_pos$x,\n  yend = sign_pos$y,\n  label = \"'Sign of the Four' features<br>the most distinctive vocabulary.\"\n)\n```\n````\n:::\n\n\n#### 5. Visualization Parameters\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\ncolors <- get_theme_colors(\n    palette = list(\n        book_col = \"#0f9a8a\",      \n        word_col = \"#b5beca\",      \n        highlight_col = \"#9b59b6\"  \n    )\n)\n\n### |- titles and caption ----\ntitle_text <- str_glue(\"The Sherlock Holmes Canon<br>Thematic Word Networks\")\n\nsubtitle_text <- str_glue(\n    \"Each of the 15 most-discussed stories is linked to its five most distinctive dialogue words.<br>\",\n    \"Cluster size reflects vocabulary uniqueness. Purple cluster highlights Sign of the Four's distinctive vocabulary.\"\n)\n\ncaption_text <- create_social_caption(\n    tt_year = 2025,\n    tt_week = 46,\n    source_text = \"{ sherlock R package }\"\n    )\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Text styling\n    plot.title = element_markdown(\n      face = \"bold\", family = fonts$title, size = rel(1.4),\n      color = colors$title, margin = margin(b = 10), hjust = 0\n    ),\n    plot.subtitle = element_text(\n      face = \"italic\", family = fonts$subtitle, lineheight = 1.2,\n      color = colors$subtitle, size = rel(0.9), margin = margin(b = 20), hjust = 0\n    ),\n\n    ## Grid\n    # panel.grid.major.y = element_blank(),\n    # panel.grid.minor = element_blank(),\n    # panel.grid.major.x = element_line(color = \"gray90\", linewidth = 0.3),\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid = element_blank(),\n\n    # Axes\n    axis.title = element_text(size = rel(0.8), color = \"gray30\"),\n    axis.text = element_text(color = \"gray30\"),\n    axis.text.y = element_text(size = rel(0.85)),\n    axis.ticks = element_blank(),\n\n    # Facets\n    strip.background = element_rect(fill = \"gray95\", color = NA),\n    strip.text = element_text(\n      face = \"bold\",\n      color = \"gray20\",\n      size = rel(1),\n      margin = margin(t = 8, b = 8)\n    ),\n    panel.spacing = unit(2, \"lines\"),\n\n    # Legend elements\n    legend.position = \"plot\",\n    legend.title = element_text(\n      family = fonts$tsubtitle,\n      color = colors$text, size = rel(0.8), face = \"bold\"\n    ),\n    legend.text = element_text(\n      family = fonts$tsubtitle,\n      color = colors$text, size = rel(0.7)\n    ),\n    legend.margin = margin(t = 15),\n\n    # Plot margin\n    plot.margin = margin(20, 20, 20, 20)\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n### |-  main plot ----\np <- \n  ggraph(layout_tbl) +\n\n  # Geoms\n  geom_edge_link(\n    aes(\n      color = is_sign_edge,\n      alpha = is_sign_edge,\n      # width = is_sign_edge\n    )\n  ) +\n  scale_edge_color_manual(\n    values = c(\"TRUE\" = colors$palette$highlight_col, \"FALSE\" = \"grey70\"),\n    guide = \"none\"\n  ) +\n  scale_edge_alpha_manual(\n    values = c(\"TRUE\" = 0.28, \"FALSE\" = 0.25),\n    guide = \"none\"\n  ) +\n  scale_edge_width_manual(\n    values = c(\"TRUE\" = 0.28, \"FALSE\" = 0.30),\n    guide = \"none\"\n  ) +\n  geom_node_point(\n    data = ~ filter(., node_type == \"Book\"),\n    aes(size = size_metric * 1.35),\n    color = if_else(\n      layout_tbl |> filter(node_type == \"Book\") |> pull(is_sign_cluster),\n      colors$palette$highlight_col,\n      colors$palette$book_col\n    ),\n    alpha = 0.25,\n    show.legend = FALSE\n  ) +\n  geom_node_point(\n    aes(size = size_metric),\n    shape = 21,\n    fill = case_when(\n      layout_tbl$is_sign_cluster & layout_tbl$node_type == \"Book\" ~ colors$palette$highlight_col, # Purple Sign book\n      layout_tbl$node_type == \"Book\" ~ colors$palette$book_col,\n      layout_tbl$is_sign_cluster & layout_tbl$node_type == \"Word\" ~ colors$palette$highlight_col, # Purple Sign words\n      TRUE ~ colors$palette$word_col\n    ),\n    color = if_else(\n      layout_tbl$is_sign_cluster,\n      colors$palette$highlight_col,\n      colors$background\n    ),\n    stroke = if_else(layout_tbl$is_sign_cluster, 0.8, 0.30),\n    alpha = 0.70,\n    show.legend = FALSE\n  ) +\n  geom_node_text(\n    data = ~ filter(., node_type == \"Book\"),\n    aes(label = display_label),\n    repel = TRUE,\n    size = 3.0,\n    fontface = \"bold\",\n    family = \"text\",\n    color = \"grey10\",\n    box.padding = unit(0.3, \"lines\"),\n    point.padding = unit(0.3, \"lines\"),\n    segment.size = 0.25,\n    segment.color = \"grey65\"\n  ) +\n  geom_richtext(\n    data = annotation_df,\n    aes(x = x, y = y, label = label),\n    family = \"text\",\n    size = 3.0,\n    color = \"grey20\",\n    fill = alpha(colors$background, 0.5),\n    label.colour = NA,\n    lineheight = 1.05,\n    label.padding = unit(0.1, \"lines\")\n  ) +\n  # Scales\n  scale_size_continuous(range = c(2.4, 10), guide = \"none\") +\n  # Labs\n  labs(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text\n  ) +\n  # Theme\n  theme(\n    plot.title = element_markdown(\n      size = rel(1.85),\n      family = fonts$title,\n      face = \"bold\",\n      color = colors$title,\n      lineheight = 1.15,\n      margin = margin(t = 8, b = 5)\n    ),\n    plot.subtitle = element_markdown(\n      size = rel(0.85),\n      family = fonts$subtitle,\n      color = alpha(colors$subtitle, 0.88),\n      lineheight = 1.2,\n      margin = margin(t = 2, b = 15)\n    ),\n    plot.caption = element_markdown(\n      size = rel(0.55),\n      family = \"Arial\",\n      color = colors$caption,\n      hjust = 0,\n      lineheight = 1.3,\n      margin = margin(t = 12, b = 5)\n    ),\n    axis.text.y = element_blank(),\n    panel.grid.major = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid = element_blank()\n  )\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot(\n  plot = p, \n  type = \"tidytuesday\", \n  year = 2025, \n  week = 46, \n  width  = 10,\n  height = 8,\n  )\n```\n````\n:::\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 26100)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      tidytext_0.4.2  ggrepel_0.9.6   ggraph_2.2.1   \n [5] igraph_2.1.1    tidygraph_1.3.1 scales_1.3.0    janitor_2.2.0  \n [9] showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9  ggtext_0.1.2   \n[13] lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4    \n[17] purrr_1.0.2     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n[21] ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gridExtra_2.3      httr2_1.0.6        rlang_1.1.6        magrittr_2.0.3    \n [5] snakecase_0.11.1   compiler_4.4.0     systemfonts_1.1.0  vctrs_0.6.5       \n [9] pkgconfig_2.0.3    crayon_1.5.3       fastmap_1.2.0      magick_2.8.5      \n[13] labeling_0.4.3     utf8_1.2.4         rmarkdown_2.29     markdown_1.13     \n[17] tzdb_0.5.0         ragg_1.3.3         camcorder_0.1.0    bit_4.5.0         \n[21] xfun_0.49          cachem_1.1.0       jsonlite_1.8.9     SnowballC_0.7.1   \n[25] tweenr_2.0.3       parallel_4.4.0     R6_2.5.1           stringi_1.8.4     \n[29] Rcpp_1.0.13-1      knitr_1.49         base64enc_0.1-3    gitcreds_0.1.2    \n[33] Matrix_1.7-0       timechange_0.3.0   tidyselect_1.2.1   rstudioapi_0.17.1 \n[37] yaml_2.3.10        viridis_0.6.5      codetools_0.2-20   curl_6.0.0        \n[41] lattice_0.22-6     withr_3.0.2        evaluate_1.0.1     polyclip_1.10-7   \n[45] xml2_1.3.6         pillar_1.9.0       janeaustenr_1.0.0  renv_1.0.3        \n[49] generics_0.1.3     vroom_1.6.5        rprojroot_2.0.4    hms_1.1.3         \n[53] commonmark_1.9.2   munsell_0.5.1      glue_1.8.0         tools_4.4.0       \n[57] tokenizers_0.3.0   graphlayouts_1.2.0 grid_4.4.0         gh_1.4.1          \n[61] colorspace_2.1-1   repr_1.1.7         ggforce_0.4.2      cli_3.6.4         \n[65] rappdirs_0.3.3     textshaping_0.4.0  rsvg_2.6.1         fansi_1.0.6       \n[69] viridisLite_0.4.2  svglite_2.1.3      gtable_0.3.6       digest_0.6.37     \n[73] tidytuesdayR_1.1.2 gifski_1.32.0-1    htmlwidgets_1.6.4  skimr_2.1.5       \n[77] farver_2.1.2       memoise_2.0.1      htmltools_0.5.8.1  lifecycle_1.0.4   \n[81] gridtext_0.1.5     bit64_4.5.2        MASS_7.3-60.2     \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_46.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_46.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  **Data Source:**\n    -   TidyTuesday 2025 Week 46: [The Complete Sherlock Holmes](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-11-18/readme.md)\n:::\n\n#### 11. Custom Functions Documentation\n\n::: {.callout-note collapse=\"true\"}\n##### ðŸ“¦ Custom Helper Functions\n\nThis analysis uses custom functions from my personal module library for efficiency and consistency across projects.\n\n**Functions Used:**\n\n-   **`fonts.R`**: `setup_fonts()`, `get_font_families()` - Font management with showtext\n-   **`social_icons.R`**: `create_social_caption()` - Generates formatted social media captions\n-   **`image_utils.R`**: `save_plot()` - Consistent plot saving with naming conventions\n-   **`base_theme.R`**: `create_base_theme()`, `extend_weekly_theme()`, `get_theme_colors()` - Custom ggplot2 themes\n\n**Why custom functions?**\\\nThese utilities standardize theming, fonts, and output across all my data visualizations. The core analysis (data tidying and visualization logic) uses only standard tidyverse packages.\n\n**Source Code:**\\\nView all custom functions â†’ [GitHub: R/utils](https://github.com/poncest/personal-website/tree/master/R)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}