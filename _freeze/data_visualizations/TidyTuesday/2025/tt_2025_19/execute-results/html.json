{
  "hash": "107aa0ffb10a7d667638c3d1245a5630",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Volatility and Change Patterns in Mount Vesuvius Seismic Activity (2011-2023)\"\nsubtitle: \"Analysis reveals dynamic behavior with high variability across different time scales\"\ndescription: \"This visualization examines seismic activity at Mount Vesuvius (2011-2023) using data from Italy's INGV. The analysis reveals a multi-layered temporal story: consecutive earthquakes follow a clustered timing pattern with a median 2.6-hour waiting time; monthly activity shows balanced volatility with nearly equal periods of increase and decrease; and beneath this short-term variability lies distinct multi-year cycles. By analyzing patterns across different time scales, we gain insight into how this famous volcano—currently in a quiescent state—displays both ordered and chaotic behavior simultaneously. This approach demonstrates how temporal volatility analysis can enhance our understanding of complex volcanic systems and potentially improve monitoring strategies.\"\nauthor: \"Steven Ponce\"\ndate: \"2025-05-11\" \ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n\"geology\", \"volcanology\", \"seismology\", \"time-series\", \"volcanic-activity\", \n\"mount-vesuvius\", \"italy\", \"natural-hazards\", \"geophysics\", \"temporal-patterns\",\n\"data-visualization\", \"tidytuesday\", \"earthquake-analysis\", \"cyclical-patterns\", \n\"volatility-analysis\" \n]\nimage: \"thumbnails/tt_2025_19.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                                  \n  cache: true                                                   \n  error: false\n  message: false\n  warning: false\n  eval: true\nfilters:\n  - social-share\nshare:\n  permalink: \"https://stevenponce.netlify.app/data_visualizations/TidyTuesday/2025/tt_2025_19.html\"\n  description: \"#TidyTuesday week 19: Mount Vesuvius seismic analysis reveals multi-scale patterns - clustered earthquake timing, balanced monthly volatility, and clear multi-year cycles beneath short-term chaos.\"\n\n  twitter: true\n  linkedin: true\n  email: true\n  facebook: false\n  reddit: false\n  stumble: false\n  tumblr: false\n  mastodon: true\n  bsky: true\n---\n\n\n\n![This visualization shows volatility and change patterns in Mount Vesuvius seismic activity from 2011 to 2023 through three related charts. The top chart displays waiting times between consecutive earthquakes on a logarithmic scale, showing that most events occur within 2-20 hours of each other, with a median of 2.6 hours. The middle chart shows month-to-month percentage changes in seismic activity, with nearly balanced increases (72 months, 50%) and decreases (73 months, 50%), suggesting a dynamic but stable volcanic system. The bottom chart presents long-term patterns with monthly counts, a 6-month moving average, and a trend line, revealing multi-year cycles despite short-term volatility. ](tt_2025_19.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n  tidyverse,     # Easily Install and Load the 'Tidyverse'\n  ggtext,        # Improved Text Rendering Support for 'ggplot2'\n  showtext,      # Using Fonts More Easily in R Graphs\n  janitor,       # Simple Tools for Examining and Cleaning Dirty Data\n  scales,        # Scale Functions for Visualization\n  glue,          # Interpreted String Literals\n  patchwork      # The Composer of Plots\n  )\n})\n\n### |- figure size ----\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  =  10,\n  height =  12,\n  units  = \"in\",\n  dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n\n#### 2. Read in the Data\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n\ntt <- tidytuesdayR::tt_load(2025, week = 19)\n\nvesuvius_raw <- tt$vesuvius |> clean_names()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n````\n:::\n\n\n\n#### 3. Examine the Data\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(vesuvius_raw)\nskimr::skim(vesuvius_raw)\n```\n````\n:::\n\n\n\n#### 4. Tidy Data\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n#| warning: false\n\n### |-  tidy data ----\nvesuvius <- vesuvius_raw |>\n  mutate(\n    date = as.Date(time),\n    year = year(time),\n    month = month(time),\n    day = day(time),\n    hour = hour(time),\n    weekday = wday(time, label = TRUE),\n    # Create a month-year for time series\n    month_year = floor_date(time, \"month\"),\n  )\n\n# P1: Monthly event counts with  trend decomposition -----\nmonthly_counts <- vesuvius |>\n  count(year, month) |>\n  mutate(date = make_date(year, month, 1))\n\n# Calculate a 6-month moving average\nmonthly_counts <- monthly_counts |>\n  arrange(date) |>\n  mutate(moving_avg = zoo::rollmean(n, k = 6, fill = NA, align = \"right\"))\n\n# P2: Time-to-next events analysis -----\nevents_ordered <- vesuvius |>\n  arrange(time) |>\n  mutate(\n    next_event_time = lead(time),\n    hours_to_next = as.numeric(difftime(next_event_time, time, units = \"hours\"))\n  ) |>\n  filter(!is.na(hours_to_next))\n\n# Calculate statistics\nmedian_time <- median(events_ordered$hours_to_next, na.rm = TRUE)\nmean_time <- mean(events_ordered$hours_to_next, na.rm = TRUE)\ncv <- sd(events_ordered$hours_to_next, na.rm = TRUE) / mean_time\n\n# P3: Event rate change analysis ----\nevents_per_month <- vesuvius |>\n  count(year, month) |>\n  mutate(date = make_date(year, month, 1)) |>\n  arrange(date) |>\n  mutate(\n    prev_month = lag(n),\n    pct_change = (n - prev_month) / prev_month * 100,\n    change_type = ifelse(pct_change > 0, \"Increase\", \"Decrease\")\n  ) |>\n  filter(!is.na(pct_change)) |>\n  # Limit extreme values for better visualization (cap at ±200%)\n  mutate(pct_change = pmin(pmax(pct_change, -200), 200))\n\n# Calculate statistics\nincrease_count <- sum(events_per_month$change_type == \"Increase\")\ndecrease_count <- sum(events_per_month$change_type == \"Decrease\")\ntotal_months <- nrow(events_per_month)\n```\n````\n:::\n\n\n\n#### 5. Visualization Parameters\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\ncolors <- get_theme_colors(\n    palette = c(\n        \"gray_line\" = \"#808080\",\n        \"moving_avg\" = \"#21908C\", \n        \"trend_line\" = \"#440154\",\n        \"confidence\" = \"#440154\",\n        \"positive_change\" = \"#3B528B\",\n        \"negative_change\" = \"#5DC863\",\n        \"median_line\" = \"#FDE725\",\n        \"hist_bar\" = \"#21908CFF\", \n        \"Decrease\" = \"#21908CFF\", \n        \"Increase\" = \"#3B528B\"\n    )\n)\n\n### |-  titles and caption ----\ntitle_text <- str_glue(\"Volatility and Change Patterns in Mount Vesuvius Seismic Activity (2011-2023)\")\n\nsubtitle_text <- str_glue(\"Analysis reveals dynamic behavior with high variability across different time scales\")\n\n# Create caption\ncaption_text <- create_social_caption(\n  tt_year = 2025,\n  tt_week = 19,\n  source_text =  \"Italian Istituto Nazionale di Geofisica e Vulcanologia (INGV)\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Text styling\n    plot.title = element_text(face = \"bold\", family = fonts$title, size = rel(1.14), color  = colors$title, margin = margin(b = 10)),\n    plot.subtitle = element_text(family = fonts$subtitle, color = colors$subtitle, size = rel(0.78), margin = margin(b = 20)),\n\n    # Axis elements\n    axis.title = element_text(color = colors$text, face = \"bold\", size = rel(0.8)),\n    axis.text = element_text(color = colors$text, size = rel(0.7)),\n\n    # Grid elements\n    panel.grid.minor = element_line(color = \"gray80\", linewidth = 0.05),\n    panel.grid.major = element_line(color = \"gray80\", linewidth = 0.05),\n\n    # Legend elements\n    legend.position = \"top\",\n    legend.direction = \"horizontal\",\n    legend.title = element_text(family = fonts$text, size = rel(0.8), face = \"bold\"),\n    legend.text = element_text(family = fonts$text, size = rel(0.7)),\n\n    # Style facet labels\n    strip.text = element_text(size = rel(0.75), face = \"bold\",\n                              color = colors$title, margin = margin(b = 8, t = 8)\n    ),\n\n    # Add spacing\n    panel.spacing = unit(1.1, \"lines\"),\n    strip.background = element_rect(fill = \"#e0e0e0\", color = NA),\n\n    # Plot margins\n    plot.margin = margin(t = 15, r = 15, b = 15, l = 15),\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n\n#### 6. Plot\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n### |-  Plot  ----\n# P1: Monthly event counts with  trend decomposition -----\np1 <- ggplot(monthly_counts, aes(x = date)) +\n  # Geoms\n  geom_hline(yintercept = seq(0, 200, by = 50), color = \"gray90\", linewidth = 0.3) +\n  geom_line(aes(y = n), color = colors$palette[\"gray_line\"], linewidth = 0.5) +\n  geom_line(aes(y = moving_avg), color = colors$palette[\"moving_avg\"], linewidth = 1.2) +\n  geom_smooth(aes(y = n),\n    method = \"loess\", span = 0.3, color = colors$palette[\"trend_line\"],\n    se = TRUE, fill = colors$palette[\"confidence\"], alpha = 0.15\n  ) +\n  # Annotate\n  annotate(\"rect\", \n    xmin = as.Date(\"2011-12-01\"), xmax = as.Date(\"2014-01-01\"), \n    ymin = 100, ymax = 210, \n    fill = \"white\", color = \"gray80\", alpha = 0.8\n    ) +\n  annotate(\"text\",\n    x = as.Date(\"2012-01-01\"), y = 190,\n    label = \"Monthly counts\", color = colors$palette[\"gray_line\"], hjust = 0, size = 3.5, fontface = \"plain\"\n  ) +\n  annotate(\"text\",\n    x = as.Date(\"2012-01-01\"), y = 155,\n    label = \"6-month average\", color = colors$palette[\"moving_avg\"], hjust = 0, size = 3.5, fontface = \"plain\"\n  ) +\n  annotate(\"text\",\n    x = as.Date(\"2012-01-01\"), y = 120,\n    label = \"Long-term trend\", color = colors$palette[\"trend_line\"], hjust = 0, size = 3.5, fontface = \"plain\"\n  ) +\n  annotate(\"text\",\n    x = as.Date(\"2023-01-01\"), y = 20,\n    label = \"Purple band shows 95% confidence interval\", color = colors$palette[\"confidence\"],\n    hjust = 0.5, size = 3, fontface = \"italic\"\n  ) +\n  # Scales\n  scale_x_date(date_breaks = \"1 year\", date_labels = \"%Y\") +\n  scale_y_continuous(breaks = seq(0, 200, by = 50)) +\n  # Labs\n  labs(\n    title = \"Long-term Patterns in Seismic Activity\",\n    subtitle = \"Monthly event counts with smoothing reveal cyclical patterns.\\nDespite short-term volatility, seismic activity follows multi-year cycles\",\n    x = NULL,\n    y = \"Number of Events\"\n  )\n\n# P2: Time-to-next events analysis -----\np2 <- ggplot(events_ordered, aes(x = hours_to_next)) +\n  # Geoms\n  geom_histogram(\n    aes(y = after_stat(count)),\n    breaks = c(0.05, 0.1, 0.2, 0.5, 1, 2, 5, 10, 20, 50, 100, 200, 500, 1000, 2000),\n    fill = colors$palette[\"hist_bar\"], color = \"#333333\", alpha = 0.9\n  ) +\n  geom_vline(\n    xintercept = median_time,\n    linetype = \"dashed\",\n    color = colors$palette[\"median_line\"], \n    linewidth = 1\n  ) +\n  # Annotate\n  annotate(\"label\",\n    x = 200, y = 1000,\n    label = paste0(\n      \"Median: \", round(median_time, 1), \" hours\\n\",\n      \"Mean: \", round(mean_time, 1), \" hours\\n\",\n      \"Coef. of Variation: \", round(cv, 2)\n    ),\n    color = \"black\", fill = \"white\", alpha = 0.8, size = 3.5, fontface = \"plain\"\n  ) +\n  # Scales\n  scale_x_log10(\n    breaks = c(0.1, 0.2, 0.5, 1, 2, 5, 10, 20, 50, 100, 200, 500, 1000),\n    labels = c(\"0.1\", \"0.2\", \"0.5\", \"1\", \"2\", \"5\", \"10\", \"20\", \"50\", \"100\", \"200\", \"500\", \"1000\"),\n    limits = c(0.05, 2000)\n  ) +\n  # Labs\n  labs(\n    title = \"Waiting Times Between Consecutive Events\",\n    subtitle = \"Distribution reveals characteristic timing between earthquakes.\\nHigh CoV indicates clustered, non-random earthquake timing\",\n    x = \"Hours to Next Event (log scale)\",\n    y = \"Frequency\"\n  )\n\n# P3: Event rate change analysis ----\np3 <- ggplot(events_per_month, aes(x = date, y = pct_change, fill = change_type)) +\n  # Geoms\n  geom_hline(yintercept = 0, linetype = \"solid\", color = \"black\", linewidth = 0.7) +\n  geom_hline(yintercept = c(-50, 50, 100, -100), linetype = \"dotted\", color = \"gray70\") +\n  geom_col(width = 25) +\n\n  # Annotate \n  annotate(\"rect\",\n    xmin = as.Date(\"2022-04-01\"), xmax = as.Date(\"2022-07-01\"),\n    ymin = 175, ymax = 190,\n    fill = colors$palette[\"Increase\"], \n  ) +\n  annotate(\"text\",\n    x = as.Date(\"2022-08-01\"), y = 180,\n    label = paste0(\"Increases: \", increase_count, \" months (\", round(increase_count / total_months * 100), \"%)\"),\n    color = \"black\", hjust = 0, size = 3.5, fontface = \"plain\"\n  ) +\n  annotate(\"rect\",\n    xmin = as.Date(\"2022-04-01\"), xmax = as.Date(\"2022-07-01\"),\n    ymin = -100, ymax = -85,\n    fill = colors$palette[\"Decrease\"]\n  ) +\n  annotate(\"text\",\n    x = as.Date(\"2022-08-01\"), y = -95,\n    label = paste0(\"Decreases: \", decrease_count, \" months (\", round(decrease_count / total_months * 100), \"%)\"),\n    color = \"black\", hjust = 0, size = 3.5, fontface = \"plain\"\n  ) +\n  annotate(\"text\",\n    x = median(events_per_month$date), y = -95,     \n    label = \"Values capped at ±200% for visualization clarity\",\n    color = \"gray30\", size = 3, fontface = \"italic\"\n ) +\n  # Scales \n  scale_fill_manual(\n    values = colors$palette,\n    name = \"Change\"\n  ) +\n  scale_x_date(\n    date_breaks = \"2 year\",\n    date_labels = \"%Y\",\n    limits = c(min(events_per_month$date), max(events_per_month$date))\n  ) +\n  scale_y_continuous(\n    breaks = c(-200, -100, -50, 0, 50, 100, 200),\n    labels = c(\"-200%\", \"-100%\", \"-50%\", \"0%\", \"+50%\", \"+100%\", \"+200%\")\n  ) +\n  # Labs \n  labs(\n    title = \"Month-to-Month Volatility in Seismic Activity\",\n    subtitle = \"Percentage change shows high variability between consecutive months.\\nNearly balanced increases/decreases suggest a dynamic but stable volcanic system\",\n    x = NULL,\n    y = \"Percent Change\"\n  ) +\n  # Theme\n  theme(\n    plot.subtitle = element_text(lineheight = 1.2),\n    legend.position = \"none\"\n  )\n  \n# Combined Plot ----\ncombined_plot <- (p2 / p3 / p1) +\n    plot_layout(\n        heights = c(0.9, 0.9, 1.3),  \n        ) \n\ncombined_plot <- combined_plot +    \n    plot_annotation(\n        title = title_text,\n        subtitle = subtitle_text,\n        caption = caption_text,\n        theme = theme(\n            plot.title = element_text(\n                size = rel(1.4),\n                family = fonts$title,\n                face = \"bold\",\n                color = colors$title,\n                lineheight = 1.1,\n                margin = margin(t = 5, b = 5)\n            ),\n            plot.subtitle = element_text(\n                size = rel(0.95),\n                family = fonts$subtitle,\n                color = alpha(colors$subtitle, 0.9),\n                lineheight = 1.2,\n                margin = margin(t = 5, b = 10)\n            ),\n            plot.caption = element_markdown(\n                size = rel(0.6),\n                family = fonts$caption,\n                color = colors$caption,\n                hjust = 0.5,\n                margin = margin(t = 10)\n            )\n        )\n    )\n```\n````\n:::\n\n\n\n#### 7. Save\n\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot_patchwork(\n  plot = combined_plot, \n  type = \"tidytuesday\", \n  year = 2025, \n  week = 19, \n  width = 10,\n  height = 12\n)\n```\n````\n:::\n\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      patchwork_1.3.0 glue_1.8.0      scales_1.3.0   \n [5] janitor_2.2.0   showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9 \n [9] ggtext_0.1.2    lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1  \n[13] dplyr_1.1.4     purrr_1.0.2     readr_2.1.5     tidyr_1.3.1    \n[17] tibble_3.2.1    ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] tidyselect_1.2.1   farver_2.1.2       fastmap_1.2.0      gh_1.4.1          \n [5] digest_0.6.37      timechange_0.3.0   lifecycle_1.0.4    rsvg_2.6.1        \n [9] magrittr_2.0.3     compiler_4.4.0     rlang_1.1.6        tools_4.4.0       \n[13] utf8_1.2.4         yaml_2.3.10        knitr_1.49         skimr_2.1.5       \n[17] labeling_0.4.3     htmlwidgets_1.6.4  bit_4.5.0          curl_6.0.0        \n[21] xml2_1.3.6         camcorder_0.1.0    repr_1.1.7         tidytuesdayR_1.1.2\n[25] withr_3.0.2        grid_4.4.0         fansi_1.0.6        colorspace_2.1-1  \n[29] gitcreds_0.1.2     cli_3.6.4          rmarkdown_2.29     crayon_1.5.3      \n[33] generics_0.1.3     rstudioapi_0.17.1  tzdb_0.5.0         commonmark_1.9.2  \n[37] splines_4.4.0      parallel_4.4.0     ggplotify_0.1.2    base64enc_0.1-3   \n[41] vctrs_0.6.5        yulab.utils_0.1.8  Matrix_1.7-0       jsonlite_1.8.9    \n[45] gridGraphics_0.5-1 hms_1.1.3          bit64_4.5.2        systemfonts_1.1.0 \n[49] magick_2.8.5       gifski_1.32.0-1    codetools_0.2-20   stringi_1.8.4     \n[53] gtable_0.3.6       munsell_0.5.1      pillar_1.9.0       rappdirs_0.3.3    \n[57] htmltools_0.5.8.1  R6_2.5.1           httr2_1.0.6        rprojroot_2.0.4   \n[61] vroom_1.6.5        evaluate_1.0.1     lattice_0.22-6     markdown_1.13     \n[65] gridtext_0.1.5     snakecase_0.11.1   renv_1.0.3         Rcpp_1.0.13-1     \n[69] nlme_3.1-164       svglite_2.1.3      mgcv_1.9-1         xfun_0.49         \n[73] fs_1.6.5           zoo_1.8-12         pkgconfig_2.0.3   \n```\n\n\n:::\n:::\n\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [`tt_2025_19.qmd`](https://github.com/poncest/personal-website/blob/master/data_visualizations/TidyTuesday/2025/tt_2025_19.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  Data Sources:\n\n  -   TidyTuesday 2025 Week 19: [Seismic Events at Mount Vesuvius](https://github.com/rfordatascience/tidytuesday/blob/main/data/2025/2025-05-13)\n    \n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}