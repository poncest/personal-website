{
  "hash": "938df0378f961f5e4b9849f9d9ab3d37",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Age at Marriage of Kings and Consorts\"\nsubtitle: \"A comparison of ages at marriage among monarchs and their consorts across history\"\nauthor: \"Steven Ponce\"\ndate: \"2024-08-19\"\ncategories:\n  - \"#TidyTuesday\"\nimage: \"thumbnails/tt_2024_34.png\"\nformat:\n  html:\n    code-fold: true\neditor_options: \n  chunk_output_type: console\nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: false\n\nfilters:\n  - social-share\nshare:\n  permalink: \"https://stevenponce.netlify.app/data_visualizations.html\"\n  linkedin: true\n  twitter: true\n  email: true\n---\n\n\n![The Dumbell chart compares monarchs' ages and consorts' ages at the time of marriage. The x-axis shows ages from 0 to 80 years, with green dots representing consorts' ages and brown dots representing kings' ages. Dotted lines connect each pair, indicating the age difference. The chart is organized by consorts' ages, from the youngest at the bottom to the oldest at the top.](tt_2024_34.png){#fig-1}\n\n### <mark> __Steps to Create this Graphic__ </mark>\n\n#### 1. Load Packages & Setup \n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\n  tidyverse,     # Easily Install and Load the 'Tidyverse'\n  ggtext,        # Improved Text Rendering Support for 'ggplot2'\n  showtext,      # Using Fonts More Easily in R Graphs\n  janitor,       # Simple Tools for Examining and Cleaning Dirty Data\n  skimr,         # Compact and Flexible Summaries of Data\n  scales,        # Scale Functions for Visualization\n  lubridate,     # Make Dealing with Dates a Little Easier\n  MetBrewer,     # Color Palettes Inspired by Works at the Metropolitan Museum of Art\n  ggalt          # Extra Coordinate Systems, 'Geoms', Statistical Transformations, Scales and Fonts for 'ggplot2'\n )   \n\ncamcorder::gg_record(\n  dir    = here::here(\"temp_plots\"),\n  device = \"png\",\n  width  =  8,\n  height =  12,\n  units  = \"in\",\n  dpi    = 320\n)\n\n### |- resolution ----\nshowtext_opts(dpi = 320, regular.wt = 300, bold.wt = 800)\n```\n:::\n\n\n#### 2. Read in the Data \n\n\n::: {.cell}\n\n```{.r .cell-code}\ntt <-tidytuesdayR::tt_load(2024, week = 34) \n\nmonarchs_marriages <- tt$english_monarchs_marriages_df |> clean_names() |> glimpse()\n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n:::\n\n\n#### 3. Examing the Data \n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(monarchs_marriages)\nskim(monarchs_marriages)\n```\n:::\n\n\n#### 4. Tidy Data \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Tidy\ncleaned_monarchs_marriages <- monarchs_marriages |>\n    mutate(\n        across(everything(), ~na_if(., \"-\")),\n        across(everything(), ~na_if(., \"NA\")),\n        across(everything(), ~na_if(., \"?\")),\n        across(everything(), ~na_if(., \"â€“\")),\n        across(where(is.character), str_trim),\n        across(c(king_age, consort_age, year_of_marriage), ~str_replace_all(., \"\\\\(\\\\?\\\\)\", \"\")),\n        across(c(king_age, consort_age, year_of_marriage), as.numeric),\n        pair_name = paste(king_name, \"-\", consort_name)\n    )\n\n# Filter out rows with NA values in king_age or consort_age, and calculate the age gap\nfiltered_monarchs_marriages <- cleaned_monarchs_marriages |>\n    filter(!is.na(king_age) & !is.na(consort_age)) |>\n    mutate(\n        age_gap = abs(king_age - consort_age),\n        pair_name = paste(king_name, \"-\", consort_name),\n        pair_name = fct_reorder(pair_name, -consort_age, .desc = TRUE)\n    ) \n\n# Subset for kings labels\nkings_data <- filtered_monarchs_marriages |>\n    select(pair_name, king_name,king_age, consort_age) |>\n    mutate(hjust = case_when(\n        king_age < consort_age ~ 1,  \n        king_age > consort_age ~ -0.5,  \n        TRUE ~ -1                  \n    ))\n\n# Subset for consorts labels\nconsorts_data <- filtered_monarchs_marriages|>\n    select(pair_name, consort_name, consort_age, king_age) |>\n    mutate(hjust = case_when(\n        consort_age < king_age ~ 1,\n        consort_age > king_age ~ -0.4,\n        TRUE ~ 1\n    ))\n```\n:::\n\n\n\n#### 5. Visualization Parameters \n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |- plot aesthetics ----\nbkg_col      <- colorspace::lighten('#f7f5e9', 0.05)    \ntitle_col    <- \"gray20\"           \nsubtitle_col <- \"gray20\"     \ncaption_col  <- \"gray30\"   \ntext_col     <- \"gray20\"    \ncol_palette  <- col_palette  <- MetBrewer::met.brewer(\"Degas\")[c(6, 2)]  \n\n### |-  titles and caption ----\n# icons\ntt <- str_glue(\"#TidyTuesday: { 2024 } Week { 34 } &bull; Source: List of Monarchs by marriage (.ianvisits.co.uk)<br>\")\nli <- str_glue(\"<span style='font-family:fa6-brands'>&#xf08c;</span>\")\ngh <- str_glue(\"<span style='font-family:fa6-brands'>&#xf09b;</span>\")\nmn <- str_glue(\"<span style='font-family:fa6-brands'>&#xf4f6;</span>\")\n\n# text\ntitle_text    <- str_glue(\"Age at Marriage of Kings and Consorts\")\nsubtitle_text <- str_glue(\"A comparison of ages at marriage among monarchs and their consorts across history.\")\ncaption_text  <- str_glue(\"{tt} {li} stevenponce &bull; {mn} @sponce1(graphic.social) {gh} poncest &bull; #rstats #ggplot2\")\n\n### |-  fonts ----\nfont_add(\"fa6-brands\", \"fonts/6.4.2/Font Awesome 6 Brands-Regular-400.otf\")\nfont_add_google(\"Oswald\", regular.wt = 400, family = \"title\")\nfont_add_google(\"Merriweather Sans\", regular.wt = 400, family = \"subtitle\")\nfont_add_google(\"Merriweather Sans\", regular.wt = 400, family = \"text\")\nfont_add_google(\"Noto Sans\", regular.wt = 400, family = \"caption\")\nshowtext_auto(enable = TRUE)\n\n### |-  plot theme ----\ntheme_set(theme_minimal(base_size = 12, base_family = \"text\"))                \n\ntheme_update(\n    plot.title.position   = \"plot\",\n    plot.caption.position = \"plot\",\n    legend.position       = \"top\",\n    \n    plot.background       = element_rect(fill = bkg_col, color = bkg_col),\n    panel.background      = element_rect(fill = bkg_col, color = bkg_col),\n    plot.margin           = margin(t = 20, r = 25, b = 20, l = 25),\n    axis.title.x          = element_text(margin = margin(10, 0, 0, 0), size = rel(1.2), color = text_col,\n                                         family = \"text\", face = \"bold\", hjust = 0.5),\n    axis.title.y          = element_blank(),                                                                # Hide y-axis title\n    axis.text.y           = element_blank(),                                                                # Hide y-axis labels\n    axis.text.x           = element_text(size = rel(0.95), color = text_col, family = \"text\"),\n    axis.line.x           = element_line(color = \"gray40\", linewidth = 0.12),\n    panel.grid.minor.x    = element_blank(),\n    panel.grid.major.x    = element_blank(),\n    panel.grid.major.y    = element_blank(),  \n    panel.grid.minor.y    = element_blank(),\n    \n    axis.text.x.top       = ggtext::element_markdown(),\n)   \n```\n:::\n\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  final plot ----  \np <- ggplot() +\n    geom_dumbbell(\n        data = filtered_monarchs_marriages,\n        aes(x = king_age, xend = consort_age, y = pair_name),\n        size = 0.25, \n        color = 'gray50', \n        size_x = 3, \n        size_xend = 3, \n        dot_guide = FALSE\n    ) +\n    \n    # Plot kings' data\n    geom_point(\n        data = kings_data,\n        aes(x = king_age, y = pair_name, color = \"King's Age\"), \n        size = 3\n    ) +\n    geom_text(\n        data = kings_data,\n        aes(x = king_age, y = pair_name, label = king_name, hjust = hjust),\n        size = 2.8,\n        color = col_palette[2],                \n        fontface = 'bold',\n        nudge_x = -2  \n    ) +\n    \n    # Plot consorts' data\n    geom_point(\n        data = consorts_data,\n        aes(x = consort_age, y = pair_name, color = \"Consort's Age\"), \n        size = 3\n    ) +\n    geom_text(\n        data = consorts_data,\n        aes(x = consort_age, y = pair_name, label = consort_name, hjust = hjust),\n        size = 2.8,\n        color = col_palette[1],               \n        fontface = 'bold',\n        nudge_x = -2  \n    ) +\n    \n    # Scales\n    scale_x_continuous(\n        limits = c(-15,80),\n        labels = scales::label_number(suffix = \" yrs\"),\n        position = \"top\"\n    ) +\n    scale_y_discrete() +\n    scale_color_manual(\n        name = \"Legend:\",\n        values = col_palette                \n    ) +\n    coord_cartesian(clip = 'off') +\n    \n    # Labs\n    labs(\n        x = element_blank(),\n        y = element_blank(),\n        title = title_text,\n        subtitle = subtitle_text,\n        caption = caption_text\n    ) +\n    \n    # Theme\n    theme(\n        plot.title = element_markdown(\n            size = rel(2),\n            family = \"title\",\n            color = title_col,\n            face = \"bold\",\n            lineheight = 0.85,\n            margin = margin(t = 5, b = 5)\n        ),\n        plot.subtitle = element_markdown(\n            size = rel(1.1),\n            family = \"subtitle\",\n            color = title_col,\n            lineheight = 1,\n            margin = margin(t = 5, b = 15)\n        ),\n        plot.caption = element_markdown(\n            size = rel(.65),\n            family = \"caption\",\n            color = caption_col,\n            lineheight = 0.6,\n            hjust = 0,\n            halign = 0,\n            margin = margin(t = 10, b = 0)\n        )\n    ) \n```\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  plot image ----  \nggsave(\n  filename = here::here(\"data_visualizations/TidyTuesday/2024/tt_2024_34.png\"),\n  plot = p,\n  width  =  8,\n  height =  12,\n  units  = \"in\",\n  dpi    = 320\n)\n\n### |-  plot thumbnail----  \nmagick::image_read(here::here(\"data_visualizations/TidyTuesday/2024/tt_2024_34.png\")) |> \n  magick::image_resize(geometry = \"400\") |> \n  magick::image_write(here::here(\"data_visualizations/thumbnails/tt_2024_34.png\"))\n```\n:::\n\n\n\n#### 8. Session Info\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsessionInfo()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 10 x64 (build 19045)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.4.0    fastmap_1.2.0     cli_3.6.3        \n [5] htmltools_0.5.8.1 tools_4.4.0       rstudioapi_0.16.0 yaml_2.3.10      \n [9] rmarkdown_2.28    knitr_1.48        jsonlite_1.8.8    xfun_0.47        \n[13] digest_0.6.37     rlang_1.1.4       renv_1.0.3        evaluate_0.24.0  \n```\n\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}