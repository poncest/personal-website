{
  "hash": "1582d7e64e6e75e4723694e2a8b5c347",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exploring Relationships Among CIA Factbook Variables\"\nsubtitle: \"This figure shows correlations between various CIA Factbook variables.\\nLarge circles indicate strong correlations, with positive values in teal and negative values in orange.\"\nauthor: \"Steven Ponce\"\ndate: \"2024-10-21\"\ncategories: [\"TidyTuesday\", \"Data Visualization\", \"R Programming\", \"2024\"]\nimage: \"thumbnails/tt_2024_43.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\neditor_options: \n  \n  chunk_output_type: inline\nexecute: \n  \n  error: false\n  message: false\n  warning: false\n  eval: true\nshare:\n  permalink: \"https://stevenponce.netlify.app/data_visualizations.png\"\n  linkedin: true\n  twitter: true\n  email: true\n---\n\n\n\n![Correlation heatmap of CIA Factbook variables. It shows correlations between birth rate, death rate, and life expectancy. Larger circles indicate stronger correlations, with positive correlations in teal and negative correlations in orange.](tt_2024_43.png){#fig-1}\n\n\n### <mark> __Steps to Create this Graphic__ </mark>\n\n#### 1. Load Packages & Setup \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## 1. LOAD PACKAGES & SETUP ----\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n    tidyverse,         # Easily Install and Load the 'Tidyverse'\n    ggtext,            # Improved Text Rendering Support for 'ggplot2'\n    showtext,          # Using Fonts More Easily in R Graphs\n    janitor,           # Simple Tools for Examining and Cleaning Dirty Data\n    skimr,             # Compact and Flexible Summaries of Data\n    scales,            # Scale Functions for Visualization\n    lubridate,         # Make Dealing with Dates a Little Easier\n    glue,              # Interpreted String Literals\n    patchwork,         # The Composer of Plots\n    here,              # A Simpler Way to Find Your Files\n    ggcorrplot,        # Correlogram\n    camcorder          # Record plots\n)  \n\n### |- figure size ----\ncamcorder::gg_record(\n    dir    = here::here(\"temp_plots\"),\n    device = \"png\",\n    width  =  10,\n    height =  10,\n    units  = \"in\",\n    dpi    = 320\n)\n\n### |- resolution ----\nshowtext_opts(dpi = 320, regular.wt = 300, bold.wt = 800)\n```\n:::\n\n\n\n#### 2. Read in the Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntt <-tidytuesdayR::tt_load(2024, week = 06) \ntt <-tidytuesdayR::tt_load(2024, week = 43) \n\ncia_factbook <- tt$cia_factbook |> clean_names() \n\ntidytuesdayR::readme(tt)\nrm(tt)\n```\n:::\n\n\n\n#### 3. Examine the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(cia_factbook)\nskim(cia_factbook)\n```\n:::\n\n\n\n#### 4. Tidy Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |- tidy data ----\n# Select numeric variables and compute correlation matrix\ncor_matrix <- cia_factbook |>\n    select(where(is.numeric)) |>\n    cor(use = \"complete.obs\")\n\n# Clean column names for better readability in plots\ncolnames(cor_matrix) <- gsub(\"_\", \" \", colnames(cor_matrix)) |> str_to_title()\nrownames(cor_matrix) <- gsub(\"_\", \" \", rownames(cor_matrix)) |> str_to_title()\n\n# Convert correlation matrix to a long format for plotting labels\ncor_df <- as.data.frame(as.table(cor_matrix)) |>\n    rename(Var1 = Var1, Var2 = Var2, Correlation = Freq) |>\n    filter(!is.na(Correlation)) \n```\n:::\n\n\n\n\n#### 5. Visualization Parameters \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |- plot aesthetics ----\nbkg_col      <- colorspace::lighten('#f7f5e9', 0.05)    \ntitle_col    <- \"gray20\"           \nsubtitle_col <- \"gray20\"     \ncaption_col  <- \"gray30\"   \ntext_col     <- \"gray20\"    \ncol_palette  <- paletteer::paletteer_d(\"NineteenEightyR::miami1\")[c(1,3,5)] \n# show_col(col_palette)\n\n### |-  titles and caption ----\n# icons\ntt <- str_glue(\"#TidyTuesday: { 2024 } Week { 43 } &bull; Source: usdatasets R package<br>\")\nli <- str_glue(\"<span style='font-family:fa6-brands'>&#xf08c;</span>\")\ngh <- str_glue(\"<span style='font-family:fa6-brands'>&#xf09b;</span>\")\nmn <- str_glue(\"<span style='font-family:fa6-brands'>&#xf4f6;</span>\")\n\n# text\ntitle_text    <- str_glue(\"Exploring Relationships Among CIA Factbook Variables\")\nsubtitle_text <- str_glue(\"This figure shows correlations between various CIA Factbook variables.\\nLarge circles indicate strong correlations, with positive values in teal and negative values in orange.\")\ncaption_text  <- str_glue(\"{tt} {li} stevenponce &bull; {mn} @sponce1(graphic.social) {gh} poncest &bull; #rstats #ggplot2\")\n\n### |-  fonts ----\nfont_add(\"fa6-brands\", here::here(\"fonts/6.4.2/Font Awesome 6 Brands-Regular-400.otf\"))\nfont_add_google(\"Oswald\", regular.wt = 400, family = \"title\")\nfont_add_google(\"Merriweather Sans\", regular.wt = 400, family = \"subtitle\")\nfont_add_google(\"Merriweather Sans\", regular.wt = 400, family = \"text\")\nfont_add_google(\"Noto Sans\", regular.wt = 400, family = \"caption\")\nfont_add_google(\"Shadows Into Light\", regular.wt = 400, family = \"anotation\")\nshowtext_auto(enable = TRUE)\n\n### |-  plot theme ----\ntheme_set(theme_minimal(base_size = 14, base_family = \"text\"))                \n\ncor_theme <- function() {\n    theme(\n        plot.title.position   = \"plot\",\n        plot.caption.position = \"plot\",\n        plot.background       = element_rect(fill = bkg_col, color = bkg_col),\n        panel.background      = element_rect(fill = bkg_col, color = bkg_col),\n        plot.margin           = margin(t = 20, r = 20, b = 20, l = 20),\n        panel.grid.minor      = element_blank(),\n        panel.grid.major      = element_line(color = \"gray80\", size = 0.4, linetype = 'dotted'),\n        axis.title            = element_blank(),\n        axis.text.y           = element_text(color = text_col, family = \"text\", size = rel(1)),\n        axis.text.x           = element_text(color = text_col, family = \"text\", size = rel(1), angle = 30, hjust = 1),\n        axis.ticks.x          = element_line(color = text_col),\n        axis.line.x           = element_line(color = \"#252525\", linewidth = .2)\n    )\n}\n```\n:::\n\n\n\n\n#### 6. Plot \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |- initial plot ----\n\n# Create correlation heatmap with annotations\np <- cor_matrix |>\n    \n    # Geoms\n    ggcorrplot(\n        method = \"circle\", type = \"lower\",\n        hc.order = TRUE, lab = FALSE, show.legend = TRUE,\n        colors = col_palette, outline.color = \"black\",\n        ggtheme = cor_theme()\n    ) +\n    \n    # Scales\n    scale_x_discrete() +\n    scale_y_discrete() +\n    scale_fill_stepsn(\n        colors = col_palette,\n        transform = \"identity\",\n        guide = guide_colorsteps(\n            barheight = unit(16, \"lines\"),\n            barwidth = unit(.5, \"lines\")\n        )\n    ) +\n    \n    # Labs\n    labs(\n        x = NULL,\n        y = NULL,\n        title = title_text,\n        subtitle = subtitle_text,\n        caption = caption_text\n    ) +\n    \n    # Theme\n    theme(\n        plot.title = element_text(\n            size = rel(2),\n            family = \"title\",\n            face = \"bold\",\n            color = title_col,\n            lineheight = 1.1,\n            margin = margin(t = 5, b = 5)\n        ),\n        plot.subtitle = element_text(\n            size = rel(1),\n            family = \"subtitle\",\n            color = subtitle_col,\n            lineheight = 1.1,\n            margin = margin(t = 5, b = 5)\n        ),\n        plot.caption = element_markdown(\n            size = rel(0.75),\n            family = \"caption\",\n            color = caption_col,\n            lineheight = 1.1,\n            hjust = 0.5,\n            halign = 1,\n            margin = margin(t = 15, b = 5)\n        )\n    )\n\n### |- Annotated plot ----\n\n# Add annotation text\nannotation_text <- str_glue(\n    \"Variables like birth rate and infant mortality rate\n    show a strong positive correlation, whereas others, \n    such as life expectancy at birth and infant mortality rate, \n    exhibit a strong negative correlation.\n    \n    These relationships suggest that countries \n    with higher birth rates also tend to have \n    higher infant mortality, indicating possible \n    healthcare challenges.\"\n)\n\np <- p +\n    # text\n    annotate(\n        \"text\",\n        x = 1, y = 7.3, label = annotation_text,\n        family = \"anotation\",\n        colour = text_col,\n        size = 5,\n        lineheight = 1.2,\n        hjust = 0\n    ) \n```\n:::\n\n\n\n\n\n#### 7. Save\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  plot image ----  \n\n# Save the plot as PNG\nggsave(\n  filename = here::here(\"data_visualizations/TidyTuesday/2024/tt_2024_43.png\"), \n  plot = p,\n  width = 10, height = 10, units = \"in\", dpi = 320\n)\n\n### |-  plot thumbnail----  \nmagick::image_read(here::here(\"data_visualizations/TidyTuesday/2024/tt_2024_43.png\")) |> \n  magick::image_resize(geometry = \"400\") |> \n  magick::image_write(here::here(\"data_visualizations/TidyTuesday/2024/thumbnails/tt_2024_43.png\"))\n```\n:::\n\n\n\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] camcorder_0.1.0    ggcorrplot_0.1.4.1 here_1.0.1         patchwork_1.3.0   \n [5] glue_1.8.0         scales_1.3.0       skimr_2.1.5        janitor_2.2.0     \n [9] showtext_0.9-7     showtextdb_3.0     sysfonts_0.8.9     ggtext_0.1.2      \n[13] lubridate_1.9.3    forcats_1.0.0      stringr_1.5.1      dplyr_1.1.4       \n[17] purrr_1.0.2        readr_2.1.5        tidyr_1.3.1        tibble_3.2.1      \n[21] ggplot2_3.5.1      tidyverse_2.0.0    pacman_0.5.1      \n\nloaded via a namespace (and not attached):\n [1] tidyselect_1.2.1   farver_2.1.2       fastmap_1.2.0      gh_1.4.1          \n [5] digest_0.6.37      timechange_0.3.0   lifecycle_1.0.4    rsvg_2.6.1        \n [9] magrittr_2.0.3     compiler_4.4.0     rlang_1.1.4        tools_4.4.0       \n[13] utf8_1.2.4         yaml_2.3.10        knitr_1.49         labeling_0.4.3    \n[17] htmlwidgets_1.6.4  bit_4.5.0          curl_6.0.0         plyr_1.8.9        \n[21] xml2_1.3.6         repr_1.1.7         tidytuesdayR_1.1.2 withr_3.0.2       \n[25] grid_4.4.0         fansi_1.0.6        colorspace_2.1-1   paletteer_1.6.0   \n[29] gitcreds_0.1.2     cli_3.6.3          rmarkdown_2.29     crayon_1.5.3      \n[33] ragg_1.3.3         generics_0.1.3     rstudioapi_0.17.1  reshape2_1.4.4    \n[37] tzdb_0.4.0         commonmark_1.9.2   parallel_4.4.0     base64enc_0.1-3   \n[41] vctrs_0.6.5        jsonlite_1.8.9     hms_1.1.3          bit64_4.5.2       \n[45] systemfonts_1.1.0  magick_2.8.5       gifski_1.32.0-1    rematch2_2.1.2    \n[49] stringi_1.8.4      gtable_0.3.6       prismatic_1.1.2    munsell_0.5.1     \n[53] pillar_1.9.0       rappdirs_0.3.3     htmltools_0.5.8.1  R6_2.5.1          \n[57] httr2_1.0.6        textshaping_0.4.0  rprojroot_2.0.4    vroom_1.6.5       \n[61] evaluate_1.0.1     markdown_1.13      gridtext_0.1.5     snakecase_0.11.1  \n[65] renv_1.0.3         Rcpp_1.0.13-1      svglite_2.1.3      xfun_0.49         \n[69] pkgconfig_2.0.3   \n```\n\n\n:::\n:::\n\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/poncest/personal-website/)\n:::\n\n",
    "supporting": [
      "tt_2024_43_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}