{
  "hash": "8d67b4af1a9fbf3c8010b20171af3790",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Ranking Drug Harms in the UK\"\nsubtitle: \"Harm to others vs harm to users • weighted scores • UK, 2010 • small panel shows total harm\"\ndescription: \"Analysis of the groundbreaking 2010 Lancet study that challenged conventional drug policy by ranking 20 drugs based on evidence rather than legal status. Using multicriteria decision analysis across 16 harm factors, researchers found alcohol causes the most overall harm despite being legal, while many criminalized substances show relatively low harm scores.\"\ndate: \"2025-09-02\" \ncategories: [\"MakeoverMonday\", \"Data Visualization\", \"R Programming\", \"2025\"]   \ntags: [\n\"drug policy\", \"public health\", \"evidence-based policy\", \"diverging bars\", \"Lancet study\", \"MCDA\", \"harm reduction\", \"alcohol harm\", \"David Nutt\", \"UK drug classification\", \"social harm\", \"individual harm\", \"policy disconnect\", \"scientific evidence\", \"health visualization\"\n]\nimage: \"thumbnails/mm_2025_36.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\n    theme: \n      light: [flatly, assets/styling/custom_styles.scss]\n      dark: [darkly, assets/styling/custom_styles_dark.scss]\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                      \n  cache: true                                       \n  error: false\n  message: false\n  warning: false\n  eval: true\n---\n\n\n\n### Original\n\nThe original visualization **Global meat production, 1961 to 2023** comes from [Food and Agriculture Organization of the United Nations (2025)](https://data.world/makeovermonday/2025w36-drug-harms-in-the-uk)\n\n<!-- ![Original visualization](https://raw.githubusercontent.com/poncest/MakeoverMonday/refs/heads/master/2025/Week_36/original_chart.png) -->\n\n![Original visualization](https://raw.githubusercontent.com/poncest/MakeoverMonday/refs/heads/master/2025/Week_36/original_chart.png)\n\n### Makeover\n\n![Horizontal diverging bar chart ranking UK drug harms. Alcohol leads with the highest total harm (72 points), showing massive social harm (46.1) but moderate user harm (25.8). Heroin and crack cocaine follow, with higher user harm but lower social impact. Chart reveals disconnect between legal status and evidence-based harm - legal drugs, alcohol, and tobacco rank high, while many illegal drugs like LSD and mushrooms show minimal harm scores. Based on a 2010 Lancet study using multicriteria analysis of 16 harm factors.](mm_2025_36.png){#fig-1}\n\n### <mark> **Steps to Create this Graphic** </mark>\n\n#### 1. Load Packages & Setup\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n#| warning: false\n#| message: false\n#| results: \"hide\"\n\n## 1. LOAD PACKAGES & SETUP ----\nsuppressPackageStartupMessages({\n  if (!require(\"pacman\")) install.packages(\"pacman\")\n  pacman::p_load(\n  tidyverse,  # Easily Install and Load the 'Tidyverse'\n  ggtext,     # Improved Text Rendering Support for 'ggplot2'\n  showtext,   # Using Fonts More Easily in R Graphs\n  scales,     # Scale Functions for Visualization\n  glue,       # Interpreted String Literals\n  patchwork   # The Composer of Plots \n  )\n})\n\n### |- figure size ----\ncamcorder::gg_record(\n    dir    = here::here(\"temp_plots\"),\n    device = \"png\",\n    width  = 10,\n    height = 8,\n    units  = \"in\",\n    dpi    = 320\n)\n\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n````\n:::\n\n\n#### 2. Read in the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n#| include: true\n#| eval: true\n#| warning: false\n#|\ndrug_harm_raw <- read_csv(\n  here::here('data/MakeoverMonday/2025/Drug Harm MCDA - drug_harms_mcda.csv')) |> \n  janitor::clean_names()\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n#| include: true\n#| eval: true\n#| results: 'hide'\n#| warning: false\n\nglimpse(drug_harm_raw)\nskimr::skim_without_charts(drug_harm_raw)\n```\n````\n:::\n\n\n#### 4. Tidy Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n#| warning: false\n\ndrug_totals_actual <- drug_harm_raw |>\n  filter(group %in% c(\"Harm to users\", \"Harm to others\")) |>\n  select(-c(category, criteria)) |>\n  pivot_longer(cols = -group, names_to = \"drug\", values_to = \"harm_score\") |>\n  group_by(drug, group) |>\n  summarise(harm = sum(harm_score, na.rm = TRUE), .groups = \"drop\") |>\n  pivot_wider(names_from = group, values_from = harm) |>\n  janitor::clean_names() |>\n  mutate(total_harm = harm_to_users + harm_to_others) |>\n  arrange(desc(total_harm))\n\n# Prepare data for diverging bars\ndiverging_data <- drug_totals_actual |>\n  mutate(\n    drug_clean = case_when(\n      drug == \"crack\" ~ \"Crack cocaine\",\n      drug == \"methylamphet\" ~ \"Methamphetamine\",\n      drug == \"ghb\" ~ \"GHB\",\n      drug == \"anabolic_steroids\" ~ \"Anabolic steroids\",\n      drug == \"lsd\" ~ \"LSD\",\n      TRUE ~ str_to_title(drug)\n    ),\n    harm_to_others_neg = -harm_to_others,\n    drug_clean = fct_reorder(drug_clean, total_harm)\n  ) |>\n  select(drug_clean, harm_to_users, harm_to_others_neg) |>\n  pivot_longer(\n    cols = c(harm_to_users, harm_to_others_neg),\n    names_to = \"harm_type\", values_to = \"harm_value\"\n  ) |>\n  mutate(\n    harm_type = case_when(\n      harm_type == \"harm_to_users\" ~ \"Harm to users\",\n      harm_type == \"harm_to_others_neg\" ~ \"Harm to others\"\n    )\n  )\n```\n````\n:::\n\n\n#### 5. Visualization Parameters\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n#| include: true\n#| warning: false\n\n### |-  plot aesthetics ----\n# Get base colors with custom palette\ncolors <- get_theme_colors(palette = c(\n  \"Harm to users\" = \"#2E6F77\",      \n  \"Harm to others\" = \"#D97B66\"     \n))   \n\n### |-  titles and caption ----\ntitle_text <- str_glue(\"Ranking Drug Harms in the UK\")\n\nsubtitle_text <- str_glue(\n  \"**Harm scores** based on a multi-criteria decision analysis by a panel of experts,<br>\",\n  \"ranking drugs from 0 to 100 on **16 distinct criteria**.<br><br>\",\n  \"Harm to others (left) vs harm to users (right) • weighted scores • UK, 2010 • small panel shows total harm\"\n)\n\n# Create caption\ncaption_text <- create_mm_caption(\n  mm_year = current_year,\n  mm_week = current_week,\n  source_text = paste0(\"Nutt et al. (2010),<br>The Lancet – Drug harms in the UK: a multicriteria decision analysis\")\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    plot.title = element_text(\n      size = rel(1.4), family = fonts$title, face = \"bold\",\n      color = colors$title, lineheight = 1.1, hjust = 0,\n      margin = margin(t = 5, b = 10)\n    ),\n    plot.subtitle = element_markdown(\n      size = rel(0.9), family = fonts$subtitle, face = \"italic\",\n      color = alpha(colors$subtitle, 0.9), lineheight = 1.1,\n      margin = margin(t = 0, b = 20)\n    ),\n\n    # Legend formatting\n    legend.position = \"plot\",\n    legend.justification = \"top\",\n    legend.margin = margin(l = 12, b = 5),\n    legend.key.size = unit(0.8, \"cm\"),\n    legend.box.margin = margin(b = 10),\n    legend.title = element_text(face = \"bold\"),\n\n    # Axis formatting\n    axis.ticks.y = element_blank(),\n    axis.ticks.x = element_line(color = \"gray\", linewidth = 0.5),\n    # axis.ticks.length = unit(0.2, \"cm\"),\n    axis.title.x = element_text(\n      face = \"bold\", size = rel(0.85),\n      margin = margin(t = 10)\n    ),\n    axis.title.y = element_text(\n      face = \"bold\", size = rel(0.85),\n      margin = margin(r = 10)\n    ),\n    axis.text.x = element_text(\n      size = rel(0.85), family = fonts$subtitle,\n      color = colors$text\n    ),\n    axis.text.y = element_text(\n      size = rel(0.85), family = fonts$subtitle,\n      color = colors$text\n    ),\n\n    # Grid lines\n    panel.grid.minor = element_line(color = \"#ecf0f1\", linewidth = 0.2),\n    panel.grid.major = element_line(color = \"#ecf0f1\", linewidth = 0.4),\n\n    # Margin\n    plot.margin = margin(20, 20, 20, 20)\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n````\n:::\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n#| warning: false\n\n### |- p1: diverging bar chart ----\np1 <- ggplot(diverging_data, aes(x = drug_clean, y = harm_value, fill = harm_type)) +\n  # Geoms\n  geom_col(width = 0.7) +\n  geom_hline(yintercept = 0, color = \"black\", linewidth = 0.5) +\n  geom_text(\n    data = diverging_data %>% filter(harm_value > 0), aes(label = round(harm_value, 1)),\n    hjust = -0.5,\n    size = 3\n  ) +\n  geom_text(\n    data = diverging_data %>% filter(harm_value < 0), aes(label = abs(round(harm_value, 1))),\n    hjust = 1.5,\n    size = 3\n  ) +\n  # Annotations\n  annotate(\"text\",\n    x = 1.5, y = 15, label = \"Harm to users →\",\n    hjust = 0, color = colors$palette[1], fontface = \"bold\", size = 4\n  ) +\n  annotate(\"text\",\n    x = 1.5, y = -15, label = \"← Harm to others\",\n    hjust = 1, color = colors$palette[2], fontface = \"bold\", size = 4\n  ) +\n  # Scales\n  scale_fill_manual(values = colors$palette) +\n  scale_y_continuous(\n    labels = abs,\n    breaks = pretty(c(-50, 40), n = 10),\n    limits = c(-50, 40)\n  ) +\n  coord_flip(clip = \"off\") +\n  # Labs\n  labs(\n    x = NULL,\n    y = \"Harm Score\",\n    fill = NULL\n  ) +\n  # Theme\n  theme(\n    panel.grid.major.y = element_blank(),\n    panel.grid.minor = element_blank(),\n    axis.ticks.x = element_blank(),\n    # bold top-3\n    axis.text.y = element_text(face = ifelse(levels(diverging_data$drug_clean) %in%\n      tail(levels(diverging_data$drug_clean), 3),\n    \"bold\", \"plain\"\n    )),\n    axis.text.x = element_blank()\n  )\n\n### |- p2: total harm bar chart ----\np_total <- ggplot(drug_totals_actual, aes(x = fct_reorder(drug, total_harm, .desc = FALSE), y = total_harm)) +\n  # Geoms\n  geom_col(width = 0.7, fill = \"gray50\") +\n  geom_text(aes(label = round(total_harm, 1), y = total_harm + 2), hjust = 0, size = 3) +\n  # Scales\n  scale_y_continuous(\n    limits = c(0, max(drug_totals_actual$total_harm) + 5)\n  ) +\n  coord_flip(clip = \"off\") +\n  # Labs\n  labs(\n    x = NULL,\n    y = \"Total Harm\"\n  ) +\n  # Theme\n  theme(\n    axis.title = element_blank(),\n    axis.text.x = element_blank(),\n    axis.text.y = element_blank(),\n    axis.ticks.x = element_blank(),\n    panel.grid.minor = element_blank(),\n    panel.grid.major = element_blank(),\n    plot.margin = margin(l = -10, r = 5)\n  )\n\n### |- final combined plot ----\ncombined_plots <- p1 + p_total +\n  plot_layout(widths = c(2, 0.5))\n\ncombined_plots <- combined_plots +\n  plot_annotation(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    theme = theme(\n      plot.title = element_text(\n        size = rel(1.8),\n        family = fonts$title,\n        face = \"bold\",\n        color = colors$title,\n        lineheight = 1.1,\n        margin = margin(t = 5, b = 5)\n      ),\n      plot.subtitle = element_markdown(\n        size = rel(0.95),\n        family = fonts$subtitle,\n        color = alpha(colors$subtitle, 0.9),\n        lineheight = 1.2,\n        margin = margin(t = 5, b = 10)\n      ),\n      plot.caption = element_markdown(\n        size = rel(0.6),\n        family = fonts$caption,\n        color = colors$caption,\n        hjust = 0.5,\n        margin = margin(t = 05)\n      )\n    )\n  )\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n#| warning: false\n\n### |-  plot image ----  \nsave_plot_patchwork(\n  plot = combined_plots, \n  type = \"makeovermonday\", \n  year = current_year,\n  week = current_week,\n  width = 10, \n  height = 8\n  )\n```\n````\n:::\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] here_1.0.1      patchwork_1.3.0 glue_1.8.0      scales_1.3.0   \n [5] showtext_0.9-7  showtextdb_3.0  sysfonts_0.8.9  ggtext_0.1.2   \n [9] lubridate_1.9.3 forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4    \n[13] purrr_1.0.2     readr_2.1.5     tidyr_1.3.1     tibble_3.2.1   \n[17] ggplot2_3.5.1   tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       xfun_0.49          htmlwidgets_1.6.4  tzdb_0.5.0        \n [5] yulab.utils_0.1.8  vctrs_0.6.5        tools_4.4.0        generics_0.1.3    \n [9] curl_6.0.0         parallel_4.4.0     gifski_1.32.0-1    fansi_1.0.6       \n[13] pkgconfig_2.0.3    ggplotify_0.1.2    skimr_2.1.5        lifecycle_1.0.4   \n[17] compiler_4.4.0     farver_2.1.2       munsell_0.5.1      repr_1.1.7        \n[21] janitor_2.2.0      codetools_0.2-20   snakecase_0.11.1   htmltools_0.5.8.1 \n[25] yaml_2.3.10        crayon_1.5.3       pillar_1.9.0       camcorder_0.1.0   \n[29] magick_2.8.5       commonmark_1.9.2   tidyselect_1.2.1   digest_0.6.37     \n[33] stringi_1.8.4      labeling_0.4.3     rsvg_2.6.1         rprojroot_2.0.4   \n[37] fastmap_1.2.0      grid_4.4.0         colorspace_2.1-1   cli_3.6.4         \n[41] magrittr_2.0.3     base64enc_0.1-3    utf8_1.2.4         withr_3.0.2       \n[45] bit64_4.5.2        timechange_0.3.0   rmarkdown_2.29     bit_4.5.0         \n[49] hms_1.1.3          evaluate_1.0.1     knitr_1.49         markdown_1.13     \n[53] gridGraphics_0.5-1 rlang_1.1.6        gridtext_0.1.5     Rcpp_1.0.13-1     \n[57] xml2_1.3.6         renv_1.0.3         svglite_2.1.3      rstudioapi_0.17.1 \n[61] vroom_1.6.5        jsonlite_1.8.9     R6_2.5.1           fs_1.6.5          \n[65] systemfonts_1.1.0 \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n\nThe complete code for this analysis is available in [mm_2025_36.qmd](https://github.com/poncest/personal-website/blob/master/data_visualizations/MakeoverMonday/2025/mm_2025_36.qmd).\n\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n\n1.  Data:\n\n-   Makeover Monday 2025 Week 36: [Drug Harms in the UK](https://data.world/makeovermonday/2025w36-drug-harms-in-the-uk)\n\n2.  Article\n\n-   [Drug Harms in the UK](https://data.world/makeovermonday/2025w36-drug-harms-in-the-uk)\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}