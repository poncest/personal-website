{
  "hash": "b90f7831d4dafcb1a13c21faa88fe012",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Hydrogen Projects by Country and Status\"\nsubtitle: \"Focusing on the top 10 countries and highlighting operational projects\"\nauthor: \"Steven Ponce\"\ndate: \"2024-09-01\"\n\ncategories:\n  - \"#SWDchallenge\"\nimage: \"thumbnails/swd_2024_09.png\"\n\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n  \neditor_options: \n  chunk_output_type: console\n\nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: false\n\nshare:\n  permalink: \"https://stevenponce.netlify.app/data_visualizations.html\"\n  linkedin: true\n  twitter: true\n  email: true\n---\n\n\n\n\n![This stacked bar chart showcases the number of hydrogen projects in the top 10 countries, emphasizing operational projects. The countries included are Germany, the United States, Australia, Spain, France, the United Kingdom, the Netherlands, China, India, and Denmark. The bars are divided by project status, with operational projects highlighted in orange. The United Kingdom is also singled out with the annotation \"Total H2 Projects per Country,\" indicating its total of 110 projects. The data is from The Hydrogen Production Projects Database, and the visualization aims to underscore the distribution and status of hydrogen projects in these leading countries.](swd_2024_09.png){#fig-1}\n\n### <mark> __Steps to Create this Graphic__ </mark>\n\n#### 1. Load Packages & Setup \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(\n  tidyverse,   # Easily Install and Load the 'Tidyverse'\n  ggtext,      # Improved Text Rendering Support for 'ggplot2'\n  showtext,    # Using Fonts More Easily in R Graphs\n  janitor,     # Simple Tools for Examining and Cleaning Dirty Data\n  skimr,       # Compact and Flexible Summaries of Data\n  scales,      # Scale Functions for Visualization\n  lubridate,   # Make Dealing with Dates a Little Easier\n  glue,        # Interpreted String Literals\n  readxl,      # Read Excel Files\n  countrycode, # Convert Country Names and Country Codes\n  marquee,     # Markdown Parser and Renderer for R Graphics\n  ggforce      # Accelerating 'ggplot2'    \n)\n\n### |- figure size ---- \ncamcorder::gg_record( \n  dir    = here::here(\"temp_plots\"), \n  device = \"png\",\n  width  = 8,\n  height = 8,\n  units  = \"in\",\n  dpi    = 320)\n\n### |- resolution ---- \nshowtext_opts(dpi = 320, regular.wt = 300, bold.wt = 800)\n```\n:::\n\n\n\n#### 2. Read in the Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nworldwide_hydrogen_projects <- read_xlsx(\n  here::here(\"data/Hydrogen_production_projects_corrected.xlsx\"),\n  sheet = \"Projects\", skip = 3, trim_ws = TRUE\n  ) |>\n  clean_names() |>\n  glimpse()\n```\n:::\n\n\n\n#### 3. Examine the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(worldwide_hydrogen_projects)\nskim(worldwide_hydrogen_projects)\ncolnames(worldwide_hydrogen_projects)\n```\n:::\n\n\n\n#### 4. Tidy Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot_data <- worldwide_hydrogen_projects |>\n  filter(!is.na(country), !is.na(status)) |>\n  count(country, status) |>\n  # Lump less common countries into \"Other\"\n  mutate(country = fct_lump(country, n = 10, w = n)) |>\n  group_by(country) |>\n  mutate(total_projects = sum(n)) |>\n  ungroup() |>\n  filter(country != \"Other\") |>\n  # Convert ISO3 country codes to country names\n  mutate(country = countrycode(country, origin = 'iso3c', destination = 'country.name')) |>\n  arrange(desc(total_projects))\n```\n:::\n\n\n\n\n#### 5. Visualization Parameters \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |- plot aesthetics ---- \nbkg_col      <- colorspace::lighten('#f7f5e9', 0.05)    \ntitle_col    <- \"#3d3d3d\"           \nsubtitle_col <- \"#3d3d3d\"     \ncaption_col  <- \"gray30\"   \ntext_col     <- colorspace::darken(\"#8e8a7b\" , 0.2)    \n\n# Define colors to highlight Operational projects\nhighlight_colors <- c(\n  \"Operational\"       = \"#E69F00\",  # Highlight color\n  \"Concept\"           = \"grey80\",\n  \"DEMO\"              = \"grey70\",\n  \"FID/Construction\"  = \"grey60\",\n  \"Other\"             = \"grey50\",\n  \"Decomissioned\"     = \"grey40\",\n  \"Feasibility study\" = \"grey30\"\n)\n\n### |-  titles and caption ----\n# icons\ntt <- str_glue(\"#SWDchallenge: SEP 2024 &bull; Source: The Hydrogen Production Projects Database<br>\")\nli <- str_glue(\"<span style='font-family:fa6-brands'>&#xf08c;</span>\")  \ngh <- str_glue(\"<span style='font-family:fa6-brands'>&#xf09b;</span>\")\nmn <- str_glue(\"<span style='font-family:fa6-brands'>&#xf4f6;</span>\")\n\n# text\ntitle_text    <- str_glue(\"Hydrogen Projects by Country and Status\") \nsubtitle_text <- \"Focusing on the top 10 countries and highlighting {#E69F00 _**operational**_} projects\"\ncaption_text  <- str_glue(\"{tt} {li} stevenponce &bull; {mn} @sponce1(graphic.social) &bull; {gh} poncest &bull; #rstats #ggplot2\")\n\n### |-  fonts ----\nfont_add('fa6-brands', here::here('fonts/6.6.0/Font Awesome 6 Brands-Regular-400.otf'))\nfont_add_google(\"Oswald\", regular.wt = 400, family = \"title\")                 \nfont_add_google(\"Quattrocento Sans\", regular.wt = 400, family = \"subtitle\")  \nfont_add_google(\"Quattrocento Sans\", regular.wt = 400, family = \"text\")        \nfont_add_google(\"Noto Sans\", regular.wt = 400,family = \"caption\")\nshowtext_auto(enable = TRUE)  \n\n### |-  plot theme ----\ntheme_set(theme_minimal(base_size = 14, base_family = \"text\"))                \n\ntheme_update(\n  plot.title.position   = \"plot\",\n  plot.caption.position = \"plot\",\n  \n  legend.position       = \"top\",\n  legend.title          = element_text(size = rel(.85), hjust = 0.5),\n  legend.text           = element_text(size = rel(0.8)),\n  \n  plot.margin           = margin(t = 10, r = 15, b = 0, l = 15),       \n  plot.background       = element_rect(fill = bkg_col, color = bkg_col),\n  panel.background      = element_rect(fill = bkg_col, color = bkg_col),\n  \n  axis.title.x          = element_text(margin = margin(10, 0, 0, 0), size = rel(1), \n                                       color = text_col, family = 'text', face = 'bold'),\n  axis.title.y          = element_text(margin = margin(0, 10, 0, 0), size = rel(1), \n                                       color = text_col, family = 'text', face = 'bold'),\n  axis.text             = element_text(size = rel(0.75), color = text_col, family = 'text'),\n  axis.line.x           = element_line(color = \"#7F7F7F\", linewidth = 0.2),\n  \n  panel.grid.minor.y    = element_blank(),\n  panel.grid.major.y    = element_blank(),\n  \n  panel.grid.minor.x    = element_blank(),\n  panel.grid.major.x    = element_line(linetype = \"dotted\", linewidth = 0.1, color = 'gray40'),\n)\n```\n:::\n\n\n\n\n#### 6. Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  initial plot ----  \np <- plot_data |>\n  ggplot(aes(x = reorder(country, -total_projects), y = n, fill = status)) +\n  \n  # Geoms\n  geom_bar(stat = \"identity\", position = \"stack\", width = 0.7) +\n  \n  # Add total project labels at the end of each bar\n  geom_text(aes(label = total_projects), \n            y = plot_data$total_projects + 5,  \n            hjust = 0, color = text_col, size = 3.5) +\n  \n  # Add labels specifically for Operational projects\n  geom_text(aes(label = ifelse(status == \"Operational\", n, \"\")), \n            position = position_stack(vjust = 0.5), color = \"white\", size = 3.5) +\n  \n  # Add country label above Denmark\n  geom_text(aes(label = \"Country\", x = \"Denmark\", y = 0),\n            size = 5.5, color = text_col, family = \"text\", fontface = \"bold\", \n            hjust = 1.4, vjust = -1.5) +\n  \n  # Scales\n  scale_x_discrete() +\n  scale_y_continuous(limits = c(0, 205)) +\n  scale_fill_manual(\n    values = highlight_colors, \n    guide = guide_legend(nrow = 2)\n    ) +\n  coord_flip(clip = 'off') +\n\n  # Labs\n  labs(\n    x = \"\",\n    y = \"Number of Projects\",\n    fill = \"Project Status\",\n    title    = title_text,\n    subtitle = subtitle_text,\n    caption  = caption_text,\n  ) +\n  \n  # Theme\n  theme(\n    \n    plot.title    = element_text(\n      size        = rel(1.8),\n      family      = \"title\",\n      face        = \"bold\",\n      color       = title_col,\n      lineheight  = 1.1,\n      margin      = margin(t = 5, b = 5)\n    ),        \n    plot.subtitle = element_marquee(\n      size        = rel(1.1),\n      family      = 'subtitle',\n      color       = subtitle_col,\n      lineheight  = 1.4, \n      margin      = margin(t = 5, b = 1)\n    ),\n    plot.caption  = element_markdown(\n      size        = rel(.55), \n      family      = 'caption',\n      color       = caption_col,\n      lineheight  = 0.6,\n      hjust       = 0,\n      halign      = 0,\n      margin      = margin(t = 10, b = 10)\n    )\n  )\n\n### |-  annotated plot ----  \n\n# label data\nlabel_data <- tibble(\n  country = \"United Kingdom\",\n  total_projects = 119\n)\n\np <- p + \n  ggforce::geom_mark_circle(\n    data = label_data,\n    aes(\n      x = country, \n      y = total_projects, \n      label = \"\", \n      description = \"Total H2 Projects per Country\",\n      ),\n    expand = 0.03, \n    label.buffer = unit(-1, \"lines\"),\n    color = \"gray70\",\n    fill = \"transparent\",\n    label.fill = bkg_col,\n    label.fontsize = 8,\n    label.family = \"text\",\n    con.type = \"elbow\",\n    label.colour = 'gray20', \n    con.colour = 'gray60'\n  )\n```\n:::\n\n\n\n#### 7. Save\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  plot image ----  \nggsave(\n  filename = here::here(\"data_visualizations/SWD Challenge/2024/swd_2024_09.png\"),\n  plot = p,\n  width  =  8,\n  height =  8,\n  units  = \"in\",\n  dpi    = 320\n)\n \n### |-  plot thumbnail----  \nmagick::image_read(here::here(\"data_visualizations/SWD Challenge/2024/swd_2024_09.png\")) |> \n  magick::image_resize(geometry = \"400\") |> \n  magick::image_write(here::here(\"data_visualizations/SWD Challenge/2024/thumbnails/swd_2024_09.png\"))\n```\n:::\n\n\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.4.0    fastmap_1.2.0     cli_3.6.3        \n [5] htmltools_0.5.8.1 tools_4.4.0       rstudioapi_0.16.0 yaml_2.3.10      \n [9] rmarkdown_2.28    knitr_1.48        jsonlite_1.8.8    xfun_0.47        \n[13] digest_0.6.37     rlang_1.1.4       renv_1.0.3        evaluate_0.24.0  \n```\n\n\n:::\n:::\n\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/poncest/personal-website/)\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}