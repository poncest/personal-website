{
  "hash": "7d0e6a90c63f5cf97fa9e9d48ededc4c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Astronaut Mission Trends and Career Paths: A Journey from Nationality to Occupation\"\nsubtitle: |\n  An exploration of astronaut missions over time, highlighting key periods of activity\n  across different nationalities, and the flow of astronauts through various career stages\n  from nationality, mission type, gender, to occupation.\nauthor: \"Steven Ponce\"\ndate: \"2024-10-02\"\ncategories: [\"SWDchallenge\", \"Data Visualization\", \"R Programming\", \"2024\"]\nimage: \"thumbnails/swd_2024_10.png\"\n\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n  \neditor_options: \n  chunk_output_type: console\n\nexecute: \n  error: false\n  message: false\n  warning: false\n  eval: false\n\n# share:\n#   permalink: \"https://stevenponce.netlify.app/data_visualizations.html\"\n#   linkedin: true\n#   twitter: true\n#   email: true\n---\n\n![Dual visualization showing astronaut mission trends and career paths. The left panel is a line chart displaying the number of missions over time, segmented by nationality (Others, U.S.S.R./Russia, U.S.). Notable events like 'The Apollo 11 Moon Landing' and 'The First Space Shuttle Launch' are annotated. The right panel is an alluvial plot depicting the flow of astronauts from nationality to mission type, gender, and occupation, highlighting key career paths.](swd_2024_10.png){#fig-1}\n\n### <mark> __Steps to Create this Graphic__ </mark>\n\n#### 1. Load Packages & Setup \n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: load\n\npacman::p_load(\n  tidyverse,   # Easily Install and Load the 'Tidyverse'\n  ggtext,      # Improved Text Rendering Support for 'ggplot2'\n  showtext,    # Using Fonts More Easily in R Graphs\n  janitor,     # Simple Tools for Examining and Cleaning Dirty Data\n  skimr,       # Compact and Flexible Summaries of Data\n  scales,      # Scale Functions for Visualization\n  lubridate,   # Make Dealing with Dates a Little Easier\n  glue,        # Interpreted String Literals\n  ggalluvial,  # Alluvial Plots in 'ggplot2'\n  patchwork,   # The Composer of Plots\n  gghighlight  # Highlight Lines and Points in 'ggplot2'\n)\n\n### |- figure size ---- \ncamcorder::gg_record( \n  dir    = here::here(\"temp_plots\"), \n  device = \"png\",\n  width  = 12,\n  height = 8,\n  units  = \"in\",\n  dpi    = 320)\n\n### |- resolution ---- \nshowtext_opts(dpi = 320, regular.wt = 300, bold.wt = 800)\n```\n````\n:::\n\n\n#### 2. Read in the Data \n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: read\n\nastronaut_db <- read_csv(\n  here::here(\"data/astronauts.csv\")\n  ) |>\n  clean_names() |>\n  glimpse()\n```\n````\n:::\n\n\n#### 3. Examine the Data\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: examine\n\nglimpse(astronaut_db)\nskim(astronaut_db)\ncolnames(astronaut_db)\n```\n````\n:::\n\n\n#### 4. Tidy Data \n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: tidy\n\nastronaut_db_clean <- astronaut_db |>\n  mutate(\n    nationality_grouped = case_when(\n      nationality == \"U.S.\" ~ \"US\",\n      nationality == \"U.S.S.R/Russia\" ~ \"U.S.S.R/Russia\",\n      TRUE ~ \"Others\"\n    ),\n    mission_type = str_to_title(military_civilian),\n    gender = str_to_title(sex), \n    occupation = str_to_title(occupation),\n    occupation = case_when(\n      occupation == \"Flight Engineer\" ~ \"Flight Eng.\",\n      occupation == \"Psp\" ~ \"PSP\",\n      occupation == \"Msp\" ~ \"MSP\",\n      occupation == \"Spaceflight Participant\" ~ \"Spacefl. Part.\",\n      occupation == \"Other (Journalist)\" ~ \"Journalist\",\n      occupation %in% c(\"Other (Space Tourist)\", \"Space Tourist\") ~ \"Space Tourist (Other)\",\n      TRUE ~ as.character(occupation)\n    )\n  ) |>\n  select(year_of_mission, nationality_grouped, mission_type, gender, occupation) |>\n  filter(!is.na(year_of_mission))\n```\n````\n:::\n\n\n\n#### 5. Visualization Parameters \n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: params\n\n### |- plot aesthetics ---- \nbkg_col      <- colorspace::lighten('#f7f5e9', 0.05)    \ntitle_col    <- \"gray20\"           \nsubtitle_col <- \"gray20\"     \ncaption_col  <- \"gray30\"   \ntext_col     <- \"gray20\"    \ncol_palette  <- paletteer::paletteer_d(\"nbapalettes::cavaliers\")[c(1,2,3)] \n\n### |-  titles and caption ----\n# icons\ntt <- str_glue(\"#SWDchallenge: OCT 2024 &bull; Source: Astronaut database (tidytuesday 2020 wk 29)<br>\")  \nli <- str_glue(\"<span style='font-family:fa6-brands'>&#xf08c;</span>\")  \ngh <- str_glue(\"<span style='font-family:fa6-brands'>&#xf09b;</span>\")\nmn <- str_glue(\"<span style='font-family:fa6-brands'>&#xf4f6;</span>\")\n\n# text\ntitle_text   <- str_glue(\"Astronaut Mission Trends and Career Paths: A Journey from Nationality to Occupation\") \n\nsubtitle_text <- str_glue(\"An exploration of astronaut missions over time, highlighting key periods of activity \n                          across different nationalities, and the flow of <br>\n                          astronauts through various career stages from nationality, mission type, gender, to occupation.\")\n\ncaption_text <- str_glue(\"{tt} {li} stevenponce &bull; {mn} @sponce1(graphic.social) &bull; {gh} poncest &bull; #rstats #ggplot2\")\n\n### |-  fonts ----\nfont_add('fa6-brands', 'fonts/6.4.2/Font Awesome 6 Brands-Regular-400.otf')  \nfont_add_google(\"Oswald\", regular.wt = 400, family = \"title\")                 \nfont_add_google(\"Quattrocento Sans\", regular.wt = 400, family = \"subtitle\")  \nfont_add_google(\"Quattrocento Sans\", regular.wt = 400, family = \"text\")        \nfont_add_google(\"Noto Sans\", regular.wt = 400,family = \"caption\")\nshowtext_auto(enable = TRUE)  \n\n### |-  plot theme ----\ntheme_set(theme_minimal(base_size = 14, base_family = \"text\"))                \n\ntheme_update(\n  plot.title.position   = \"plot\",\n  plot.caption.position = \"plot\",\n  legend.position       = 'plot',\n  plot.background       = element_rect(fill = bkg_col, color = bkg_col),\n  panel.background      = element_rect(fill = bkg_col, color = bkg_col),\n  plot.margin           = margin(t = 10, r = 20, b = 10, l = 20),\n  axis.title.x          = element_text(margin = margin(10, 0, 0, 0), size = rel(1), \n                                       color = text_col, family = \"text\", face = \"bold\", hjust = 0.5),\n  axis.title.y          = element_text(margin = margin(0, 10, 0, 0), size = rel(1), \n                                       color = text_col, family = \"text\", face = \"bold\", hjust = 0.5),\n  axis.text             = element_text(size = rel(0.8), color = text_col, family = \"text\"),\n  axis.line.x           = element_line(color = \"gray40\", linewidth = .15),\n  panel.grid.minor.y    = element_blank(),\n  panel.grid.major.y    = element_line(linetype = \"dotted\", linewidth = 0.1, color = 'gray10'),\n  panel.grid.minor.x    = element_blank(),\n  panel.grid.major.x    = element_blank(),\n)\n```\n````\n:::\n\n\n\n#### 6. Plot\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: plot\n\n### |-  Plot 1 ----  \n\n#  Line Chart \nmission_summary <- astronaut_db_clean |>\n  group_by(year_of_mission, nationality_grouped) |>\n  summarise(num_missions = n(), .groups = \"drop\")\n\n# Annotations df \nannotations <- tibble(\n  year = c(1969, 1981),  \n  label = c(\n    \"Apollo 11 Moon Landing\", \n    \"First Space Shuttle Launch\"\n  ),\n  nationality_grouped = c(\"US\", \"US\"),  \n  y_positions = c(43, 32)  \n)\n\np1 <- mission_summary |>\n  ggplot(aes(x = year_of_mission, y = num_missions, \n             color = nationality_grouped, group = nationality_grouped)) +\n  \n  # Geoms\n  geom_line(linewidth = 1) + \n  geom_point(size = 1.5) + \n  gghighlight::gghighlight(\n    use_direct_label = FALSE,\n    unhighlighted_params = list(linewidth = 0.5, size = 0.8)\n  ) +\n  \n  # Annotations\n  geom_vline(data = annotations, aes(xintercept = year), \n             linetype = \"dashed\", color = \"darkred\", linewidth = 0.2) +\n  geom_text(data = annotations, aes(x = year, y = y_positions, label = label),\n            size = 2.5, color = \"grey30\", hjust = 0, nudge_x = 0.8) +  \n  \n  # Scales\n  scale_x_continuous() +\n  scale_y_continuous(limits = c(0, max(mission_summary$num_missions) + 5)) +  \n  scale_color_manual(values = col_palette) + \n  coord_cartesian(clip = 'off') +\n  \n  # Labs\n  labs(\n    title = \"Number of Missions Over Time\",\n    x = \"Year of Mission\",\n    y = \"Number of Missions\",\n    color = \"Nationality\"\n  ) +\n  \n  # Facet\n  facet_wrap(~ nationality_grouped, ncol = 1) +\n  \n  # Theme\n  theme(\n    plot.title = element_text(\n      size = rel(1),\n      hjust = 0.5,\n      family = \"title\",\n      color = title_col,\n      face = \"bold\",\n      lineheight = 0.85,\n      margin = margin(t = 5, b = 5)\n    )\n  )\n\n### |-  Plot 2 ----  \n\n#  Alluvial Plot \np2 <- astronaut_db_clean |>\n  count(nationality_grouped, mission_type, gender, occupation) |>\n  ggplot(aes(\n    axis1 = nationality_grouped, axis2 = mission_type, axis3 = gender, axis4 = occupation,\n    y = n)\n  ) +\n  \n  # Geoms\n  geom_alluvium(aes(fill = nationality_grouped), alpha = 0.6) +  \n  geom_stratum(width = 1/4, fill = bkg_col, linewidth = 0.4, colour = 'gray30') +  \n  \n  ggrepel::geom_text_repel(\n    aes(label = after_stat(stratum), family = \"text\"),\n    stat = \"stratum\", size = 3, direction = \"y\", nudge_x = -0.3, nudge_y = 1,\n    color = \"gray10\", segment.color = \"grey50\"\n  ) +\n  \n  # Scales\n  scale_x_discrete(limits = c(\"Nationality\", \"Mission Type\", \"Gender\", \"Occupation\"), \n                   expand = c(0.15, 0.05)) +\n  scale_fill_manual(values = col_palette) +  \n  \n  # Labs\n  labs(\n    title = \"Flow of Astronauts from Nationality to Occupation\",\n    x = \"\",\n    y = \"Count\"\n  ) +\n  \n  # Theme\n  theme(\n    plot.title = element_text(\n      size = rel(1),\n      hjust = 0.5,\n      family = \"title\",\n      color = title_col,\n      face = \"bold\",\n      lineheight = 0.85,\n      margin = margin(t = 5, b = 5)\n    )\n  )\n\n### |-  Combine the plots using patchwork ----\n\ncombined_plot <- (p1 | p2) +\n  patchwork::plot_layout(\n    ncol = 2,\n    widths = c(0.75, 1.25), \n    guides = \"collect\"\n  ) +\n  \n  # Labs\n  plot_annotation(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    \n    # Theme \n    theme = theme(\n      plot.title = element_markdown(\n        size = rel(1.4),\n        family = \"title\",\n        face = \"bold\",\n        color = title_col,\n        lineheight = 1.1,\n        margin = margin(t = 5, b = 5)\n      ),\n      plot.subtitle = element_markdown(\n        size = rel(1),\n        family = \"subtitle\",\n        color = subtitle_col,\n        lineheight = 1.1,\n        margin = margin(t = 5, b = 5)\n      ),\n      plot.caption = element_markdown(\n        size = rel(0.65),\n        family = \"caption\",\n        color = caption_col,\n        lineheight = 1.1,\n        hjust = 0.5,\n        halign = 1,\n        margin = margin(t = 5, b = 5)\n      )\n    )\n  )\n\n\n# Show the combined plot\ncombined_plot\n```\n````\n:::\n\n\n#### 7. Save\n\n\n::: {.cell}\n\n````{.cell-code}\n```{{r}}\n#| label: save\n\n### |-  plot image ----  \n\nlibrary(ggplotify)\n# Convert patchwork plot to grob \n# There was some issues between patchwork and ggsave\nplot_grob <- as.grob(combined_plot)\n\n# Save the plot again\nggsave(\n  filename = here::here(\"data_visualizations/SWD Challenge/2024/swd_2024_10.png\"),\n  plot   = plot_grob,\n  width  =  12,\n  height =  8,\n  units  = \"in\",\n  dpi    = 320\n)\n \n### |-  plot thumbnail----  \nmagick::image_read(here::here(\"data_visualizations/SWD Challenge/2024/swd_2024_10.png\")) |> \n  magick::image_resize(geometry = \"400\") |> \n  magick::image_write(here::here(\"data_visualizations/SWD Challenge/2024/thumbnails/swd_2024_10.png\"))\n```\n````\n:::\n\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nloaded via a namespace (and not attached):\n [1] htmlwidgets_1.6.4 compiler_4.4.0    fastmap_1.2.0     cli_3.6.4        \n [5] htmltools_0.5.8.1 tools_4.4.0       rstudioapi_0.17.1 yaml_2.3.10      \n [9] rmarkdown_2.29    knitr_1.49        jsonlite_1.8.9    xfun_0.49        \n[13] digest_0.6.37     rlang_1.1.6       renv_1.0.3        evaluate_1.0.1   \n```\n\n\n:::\n:::\n\n:::\n\n#### 9. GitHub Repository\n\n::: {.callout-tip collapse=\"true\"}\n\n##### Expand for GitHub Repo\n \n[Access the GitHub repository here](https://github.com/poncest/personal-website/)\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}