{
  "hash": "a65adc1cc45c7282f56980891006de00",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Retail Department Performance Analysis: Growth and Volatility\"\nsubtitle: \"Understanding stability patterns and growth trajectories across retail categories (Jan 2024 - Mar 2025)\"\ndescription: \"An in-depth analysis of retail department performance examining growth rates and volatility across multiple categories. This visualization highlights stability patterns and identifies departments with unpredictable performance, providing valuable insights for inventory management and business planning.\"\nauthor: \"Steven Ponce\"\ndate: \"2025-03-19\"\ncategories: [\"SWDchallenge\", \"Exercise\", \"Data Visualization\", \"R Programming\", \"2025\"]\ntags: [\n  \"retail analysis\", \"YoY growth\", \"volatility metrics\", \n\"ggplot2\", \"time series visualization\", \"scatter plot\", \n\"performance dashboard\", \"department comparison\", \"standard deviation\", \"business intelligence\"\n]\nimage: \"thumbnails/swd_2025_03-Ex_0056.png\"\nformat:\n  html:\n    toc: true\n    toc-depth: 5\n    code-link: true\n    code-fold: true\n    code-tools: true\n    code-summary: \"Show code\"\n    self-contained: true\neditor_options: \n  chunk_output_type: inline\nexecute: \n  freeze: true                                          \n  cache: true                                                   \n  error: false\n  message: false\n  warning: false\n  eval: true\nshare:\n  permalink: \"https://stevenponce.netlify.app/data_visualizations/SWD Challenge/2025/swd_2025_02-Ex_056.html\" \n  description: \"Explore my latest data visualization project analyzing retail department growth patterns and volatility. This #SWDchallenge entry examines performance trends across multiple retail categories, highlighting stability patterns and outliers from Jan 2024 to Mar 2025. #DataViz #RetailAnalytics #ggplot2\"\n  linkedin: true\n  twitter: true\n  email: true\n---\n\n\n\n### Original\n\nThe goal of this month's Storytelling with Data exercise is toresist the temptation to show all the data.\n\n![Original chart](https://stwd-prod-static-back.s3.amazonaws.com/media/exercise056_before.png){#fig-1}\n\n\nAdditional information can be found [HERE](https://community.storytellingwithdata.com/exercises/resist-the-temptation-to-show-all-the-data)\n\n\n### Makeover\n\n![Retail department performance visualization with two charts. Top chart shows year-over-year growth trends from Jan 2024 to Mar 2025, highlighting the three most volatile departments (Grocery, Hardware, and Toys) with Grocery showing the most dramatic fluctuations. Bottom chart plots standard deviation against mean growth rate for all departments, revealing that departments with higher volatility (like Grocery) don't necessarily have the highest average growth rates.](swd_2025_03-Ex_0056.png){#fig-1}\n\n\n### <mark> __Steps to Create this Graphic__ </mark>\n\n#### 1. Load Packages & Setup \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nif (!require(\"pacman\")) install.packages(\"pacman\")\npacman::p_load(\n  tidyverse,         # Easily Install and Load the 'Tidyverse'\n  ggtext,            # Improved Text Rendering Support for 'ggplot2'\n  showtext,          # Using Fonts More Easily in R Graphs\n  scales,            # Scale Functions for Visualization\n  glue,              # Interpreted String Literals\n  here,              # A Simpler Way to Find Your Files\n  janitor,           # Simple Tools for Examining and Cleaning Dirty Data\n  camcorder,         # Record Your Plot History,\n  ggrepel,           # Automatically Position Non-Overlapping Text Labels with 'ggplot2'\n  patchwork          # The Composer of Plots # The Composer of Plots # The Composer of Plots\n) \n\n### |- figure size ---- \ngg_record( \n  dir    = here::here(\"temp_plots\"), \n  device = \"png\",\n  width  = 8,\n  height = 10,\n  units  = \"in\",\n  dpi    = 320)\n# Source utility functions\nsuppressMessages(source(here::here(\"R/utils/fonts.R\")))\nsource(here::here(\"R/utils/social_icons.R\"))\nsource(here::here(\"R/utils/image_utils.R\"))\nsource(here::here(\"R/themes/base_theme.R\"))\n```\n:::\n\n\n\n#### 2. Read in the Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nraw_data <- read_csv(\n  here::here(\"data/swdexercise056.csv\")\n  ) |> \n  clean_names() \n```\n:::\n\n\n\n#### 3. Examine the Data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(raw_data)\n```\n:::\n\n\n\n#### 4. Tidy Data \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntidy_data <- raw_data |>\n  rename(month = column1, year = column2) |>\n  mutate(\n    date = as.Date(paste(year, month, \"01\", sep = \"-\"), \n                   format = \"%Y-%b-%d\")\n  ) |>\n  select(date, everything(), -month, -year) |>\n  pivot_longer(\n    cols = -date, \n    names_to = \"department\", \n    values_to = \"growth\"\n  ) |> \n  mutate(\n    year_month = format(date, \"%b %Y\"),\n    quarter = paste0(\"Q\", quarter(date)),\n    year_quarter = paste(year(date), quarter, sep = \"-\")\n  )\n\n# Compute summary statistics for each department\nsummary_stats <- tidy_data |>\n  group_by(department) |>\n  summarise(\n    mean_growth = mean(growth, na.rm = TRUE),\n    min_growth = min(growth, na.rm = TRUE),\n    max_growth = max(growth, na.rm = TRUE),\n    sd_growth = sd(growth, na.rm = TRUE),\n    range_growth = max_growth - min_growth,\n    cv_growth = sd_growth / abs(mean_growth),  \n    .groups = 'drop'\n  ) |>\n  arrange(desc(sd_growth))\n\n# Summary statistics \nstats_table <- summary_stats |>\n  select(department, mean_growth, sd_growth, min_growth, max_growth, range_growth) |>\n  mutate(across(where(is.numeric), ~ round(., 2)))\n\n# Identify the most volatile departments (using SD as criteria)\nvolatile_departments <- summary_stats |> \n  slice_max(order_by = sd_growth, n = 3) |> \n  pull(department)\n\n# Prepare the data for plotting\nhighlight_data <- tidy_data |> \n  filter(department %in% volatile_departments)\n```\n:::\n\n\n\n\n#### 5. Visualization Parameters \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  plot aesthetics ----\n# Get base colors with custom palette\ncolors <- get_theme_colors(\n  palette = c(\n    \"grocery\" = \"#D73027\",  \n    \"hardware\" = \"#F46D43\",  \n    \"toys\" = \"#FDAE61\"  \n  )\n)\n\ncolors2 <- get_theme_colors(\n  palette = c(\n    \"FALSE\" = \"gray50\",\n    \"TRUE\" = \"#D73027\"\n  )\n)\n\n### |-  titles and caption ----\ntitle_text <- str_glue(\"Retail Department Performance Analysis: Growth and Volatility\")\nsubtitle_text <- str_glue(\"Understanding stability patterns and growth trajectories across retail categories\\n(Jan 2024 - Mar 2025)\")\n\n# Create caption\ncaption_text <- create_swd_exe_caption(\n  year = 2025,\n  month = \"Mar\",\n  source_text =  \"Let's Practice! Exercise 5.6\"\n)\n\n### |-  fonts ----\nsetup_fonts()\nfonts <- get_font_families()\n\n### |-  plot theme ----\n\n# Start with base theme\nbase_theme <- create_base_theme(colors)\n\n# Add weekly-specific theme elements\nweekly_theme <- extend_weekly_theme(\n  base_theme,\n  theme(\n    # Text styling \n    plot.title = element_text(face = \"bold\", family = fonts$title, color = colors$title, size = rel(1.14), margin = margin(b = 10)),\n    plot.subtitle = element_text(family = fonts$subtitle, color = colors$text, size = rel(0.78), margin = margin(b = 20)),\n    \n    # Axis elements\n    axis.title = element_text(color = colors$text, size = rel(0.8)),\n    axis.text = element_text(color = colors$text, size = rel(0.7)),\n    \n    # Grid elements\n    panel.grid.minor = element_blank(),\n    panel.grid.major = element_line(color = \"grey95\", linewidth = 0.1),\n    \n    # Legend elements\n    legend.position = \"plot\",\n    legend.title = element_text(family = fonts$text, size = rel(0.8)),\n    legend.text = element_text(family = fonts$text, size = rel(0.7)),\n    \n    # Plot margins \n    plot.margin = margin(t = 10, r = 10, b = 10, l = 10),\n  )\n)\n\n# Set theme\ntheme_set(weekly_theme)\n```\n:::\n\n\n\n\n#### 6. Plot\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# P1. Line Chart ----\np1 <- ggplot() +\n  # Geoms\n  geom_hline(\n    yintercept = 0, color = \"gray30\", alpha = 0.5, linewidth = 0.5\n  ) +\n  geom_line(data = tidy_data, \n            aes(x = date, y = growth, group = department), \n            color = \"#CCCCCC\", linewidth = 0.2, alpha = 0.7\n  ) +\n  geom_line(data = highlight_data,           # Highlighted volatile departments\n            aes(x = date, y = growth, color = department), \n            linewidth = 1.2\n  ) +\n  geom_point(data = highlight_data,\n             aes(x = date, y = growth, color = department),\n             size = 2\n  ) +\n  geom_text_repel(\n    data = highlight_data |> \n      group_by(department) |> \n      filter(date == max(date)),\n    aes(x = date, y = growth, label = str_to_title(department), color = department),\n    hjust = -0.2, size = 4, fontface = \"bold\",\n    direction = \"y\", segment.color = \"gray50\",\n    box.padding = 0.5, point.padding = 0.3\n  ) +\n  \n  # Scales\n  scale_x_date(\n    date_breaks = \"2 months\",\n    date_labels = \"%b\\n%Y\",\n    expand = expansion(mult = c(0.01, 0.1))  \n  ) +\n  scale_y_continuous(\n    labels = function(x) paste0(x, \"%\"),\n    breaks = seq(-3, 7, by = 1)\n  ) +\n  scale_color_manual(values = colors$palette) +\n  # Labs\n  labs(\n    title = \"Department Year-over-Year Growth Trends\",\n    subtitle = paste(\"Highlighting the three most volatile departments based on standard deviation\"),\n    y = \"Growth vs Previous Year (%)\",\n    x = NULL,\n    caption = \"\"\n  ) +\n  # Theme\n  theme(\n    panel.grid.major.y = element_line(color = \"gray70\")\n  )\n\n# P2. Scatter Plot ----\np2 <- ggplot(summary_stats,\n       aes(x = mean_growth, y = sd_growth, label = department)) +\n  # Geoms\n  geom_point(aes(color = department %in% volatile_departments, \n                 size = range_growth),\n             alpha = 0.7) +\n  geom_text_repel(\n    size = 3.5,\n    box.padding = 0.5,\n    max.overlaps = 15,\n    segment.color = \"gray70\"\n  ) +\n  # Scales\n  scale_color_manual(values = colors2$palette) +\n  scale_size_continuous(range = c(2, 6)) +\n  labs(\n    title = \"Department Growth: Volatility vs. Average Performance\",\n    subtitle = \"Size represents the range between minimum and maximum growth values\",\n    x = \"Mean Growth Rate (%)\",\n    y = \"Standard Deviation (Volatility)\"\n  ) +\n # Theme\n  theme(\n    panel.grid.minor = element_blank(),\n    panel.grid.major = element_line(color = \"grey70\", linewidth = 0.1),\n  )\n\n# Combined Plot -----\ncombined_plot <- (p1 / p2) +\n  plot_layout(widths = c(1, 1))   \n\ncombined_plot <- combined_plot +\n  plot_annotation(\n    title = title_text,\n    subtitle = subtitle_text,\n    caption = caption_text,\n    theme = theme(\n      plot.title = element_text( \n        size = rel(1.4),\n        family = fonts$title,\n        face = \"bold\",\n        color = colors$title,\n        lineheight = 1.1,\n        margin = margin(t = 5, b = 5)\n      ),\n      plot.subtitle = element_text(\n        size = rel(0.95),  \n        family = fonts$subtitle,\n        color = colors$subtitle,\n        lineheight = 1.2,\n        margin = margin(t = 5, b = 10)\n      ),\n      plot.caption = element_markdown(\n        size   = rel(0.65),\n        family = fonts$caption,\n        color  = colors$caption,\n        hjust  = 0.5,\n        margin = margin(t = 10)\n      ),\n      plot.margin = margin(t = 20, r = 10, b = 20, l = 10),\n    ))\n```\n:::\n\n\n\n#### 7. Save\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n### |-  plot image ----  \n\nsource(here::here(\"R/image_utils.R\"))\nsave_plot_patchwork(\n  combined_plot, \n  type = 'swd', \n  year = 2025, \n  month = 03, \n  exercise = 056,\n  width = 8, \n  height = 10\n  )\n```\n:::\n\n\n\n\n#### 8. Session Info\n\n::: {.callout-tip collapse=\"true\"}\n##### Expand for Session Info\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nR version 4.4.1 (2024-06-14 ucrt)\nPlatform: x86_64-w64-mingw32/x64\nRunning under: Windows 11 x64 (build 22631)\n\nMatrix products: default\n\n\nlocale:\n[1] LC_COLLATE=English_United States.utf8 \n[2] LC_CTYPE=English_United States.utf8   \n[3] LC_MONETARY=English_United States.utf8\n[4] LC_NUMERIC=C                          \n[5] LC_TIME=English_United States.utf8    \n\ntime zone: America/New_York\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices datasets  utils     methods   base     \n\nother attached packages:\n [1] patchwork_1.3.0 ggrepel_0.9.6   camcorder_0.1.0 janitor_2.2.0  \n [5] here_1.0.1      glue_1.8.0      scales_1.3.0    showtext_0.9-7 \n [9] showtextdb_3.0  sysfonts_0.8.9  ggtext_0.1.2    lubridate_1.9.3\n[13] forcats_1.0.0   stringr_1.5.1   dplyr_1.1.4     purrr_1.0.2    \n[17] readr_2.1.5     tidyr_1.3.1     tibble_3.2.1    ggplot2_3.5.1  \n[21] tidyverse_2.0.0 pacman_0.5.1   \n\nloaded via a namespace (and not attached):\n [1] gtable_0.3.6       xfun_0.49          htmlwidgets_1.6.4  tzdb_0.4.0        \n [5] yulab.utils_0.1.8  vctrs_0.6.5        tools_4.4.0        generics_0.1.3    \n [9] curl_6.0.0         parallel_4.4.0     gifski_1.32.0-1    fansi_1.0.6       \n[13] pkgconfig_2.0.3    ggplotify_0.1.2    lifecycle_1.0.4    compiler_4.4.0    \n[17] farver_2.1.2       munsell_0.5.1      codetools_0.2-20   snakecase_0.11.1  \n[21] htmltools_0.5.8.1  yaml_2.3.10        crayon_1.5.3       pillar_1.9.0      \n[25] magick_2.8.5       commonmark_1.9.2   tidyselect_1.2.1   digest_0.6.37     \n[29] stringi_1.8.4      labeling_0.4.3     rsvg_2.6.1         rprojroot_2.0.4   \n[33] fastmap_1.2.0      grid_4.4.0         colorspace_2.1-1   cli_3.6.3         \n[37] magrittr_2.0.3     utf8_1.2.4         withr_3.0.2        bit64_4.5.2       \n[41] timechange_0.3.0   rmarkdown_2.29     bit_4.5.0          hms_1.1.3         \n[45] evaluate_1.0.1     knitr_1.49         markdown_1.13      gridGraphics_0.5-1\n[49] rlang_1.1.4        gridtext_0.1.5     Rcpp_1.0.13-1      xml2_1.3.6        \n[53] renv_1.0.3         svglite_2.1.3      rstudioapi_0.17.1  vroom_1.6.5       \n[57] jsonlite_1.8.9     R6_2.5.1           fs_1.6.5           systemfonts_1.1.0 \n```\n\n\n:::\n:::\n\n\n:::\n\n\n#### 9. GitHub Repository\n::: {.callout-tip collapse=\"true\"}\n##### Expand for GitHub Repo\n \nThe complete code for this analysis is available in [`swd_2025_02-Ex_056.qmd`](https://github.com/poncest/personal-website/tree/master/data_visualizations/SWD%20Challenge/2025/swd_2025_02-Ex_056.qmd).\nFor the full repository, [click here](https://github.com/poncest/personal-website/).\n:::\n\n#### 10. References\n::: {.callout-tip collapse=\"true\"}\n##### Expand for References\n \nData Sources:\n\n1. Data Sources:\n\n   - Storytelling with Data Exercise | resist the temptation to show all the data: [Download the data](https://community.storytellingwithdata.com/exercises/resist-the-temptation-to-show-all-the-data)\n\n\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}